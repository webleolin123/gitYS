<!DOCTYPE html>
<html  class="iframe-h">
<head>
    <meta charset="UTF-8">
    <title>决策概况</title>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport">
    <link class="favicon" href="./../../images/ico/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link class="favicon" href="./../../images/ico/favicon.ico" rel="icon" type="image/x-icon">
    <link class="favicon" href="./../../images/ico/favicon.ico" rel="bookmark" type="image/x-icon">
    <link href="../../js/layui/css/layui.css" rel="stylesheet"/>
    <link href="../../css/public.css?v1.01" rel="stylesheet"/>
    <link href="../../js/lib/font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <script src="../../js/lib/jquery.1.12.3.js"></script>

</head>
<style>
    .layui-table-cell {
        height: auto;
        line-height: 28px;
        padding: 0 15px;
        position: relative;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: normal;
        box-sizing: border-box;
    }

    .moniBoxXs .iconBoxMain .icon-box {
        width: 50px;
        height: 50px;
    }

    .moniBoxXs .iconBoxMain .icon-box i {
        line-height: 50px;
    }
</style>
<body class="iframe-h">

<div class="content-wrap">
    <div class="layui-row layui-col-space15">
        <!-- <div class="layui-col-xs2 layui-col-sm2 layui-col-md2">

            <div class="layui-card" >
                <div class="layui-card-header layui-card-header-custom"><span><i></i>企业列表</span><div class="columnSide"><i class="fa fa-toggle-left"></i></div></div>
                <div class="layui-card-body treeHeight" style="overflow-y: auto">
                    <div class="eleTree ele4" id="leftTree"  lay-filter="leftTree"></div>
                </div>
            </div>
        </div> -->
        <div class="layui-col-xs12 layui-col-sm12 layui-col-md12">
            <div class="layui-row layui-col-space10">
                <div class="layui-col-xs2">
                    <div class="layui-card">
                        <div class="layui-card-header layui-card-header-custom"><span><i></i>决策制度</span></div>
                        <div class="layui-card-body">
                            <div class="monitorBar">
                                <div class="layui-row">
                                    <div class="layui-col-xs12  moniBox moniBoxXs" style="height: 100px">
                                        <div class="iconBoxMain" style="margin-top: 20px">
                                            <div class="icon-box bg-green1"><i
                                                    class=" icon iconfont icon-SZYD-zhiduxinxi"></i></div>
                                            <div class="icon-des">
                                                <p class="p-number">
                                                    <b class="green1" id="countTotalRegulation" style="font-size: 28px;padding-right: 10px">-</b>
                                                    <span>项</span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs2">
                    <div class="layui-card">
                        <div class="layui-card-header layui-card-header-custom"><span><i></i>事项清单</span></div>
                        <div class="layui-card-body">
                            <div class="monitorBar">
                                <div class="layui-row">
                                    <div class="layui-col-xs12  moniBox moniBoxXs" style="height: 100px">
                                        <div class="iconBoxMain" style="margin-top: 20px">
                                            <div class="icon-box bg-green2"><i
                                                    class="icon iconfont icon-SZYD-shixiangqingdan"></i></div>
                                            <div class="icon-des">
                                                <p class="p-number">
                                                    <b class="green2" id="countTotalItem" style="font-size: 28px;padding-right: 10px">-</b>
                                                    <span>项</span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs6">
                    <div class="layui-card">
                        <div class="layui-card-header layui-card-header-custom"><span><i></i>党的十九大以来累计召开会议</span></div>
                        <div class="layui-card-body">
                            <div class="layui-row">
                                <div class="layui-col-xs3">
                                    <div class="monitorBar">
                                        <div class="layui-row ">
                                            <div class="layui-col-xs12 borderRight moniBox ">
                                                <div class="iconBoxMain">
                                                    <div class="icon-box bg-red" style="width: 40px;height: 40px"><i
                                                            class="icon iconfont icon-SZYD-juecehuiyi"
                                                            style="font-size: 20px;line-height: 40px"></i></div>
                                                    <div class="icon-des" style="padding-left: 5px">
                                                        <p class="p-text"><b class="red" id="countTotalMeeting"
                                                                             style="vertical-align: top;font-size: 20px; margin-right: 10px">-</b>次会议
                                                        </p>
                                                        <p class="p-text"><b class="red" id="countTotalSubject"
                                                                             style="vertical-align: top;font-size: 20px;margin-right: 10px">-</b>个议题
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--<div class="layui-col-xs12 borderRight moniBox">-->
                                            <!--<div class="iconBoxMain">-->
                                            <!--<div class="icon-box bg-red"><i class="icon iconfont icon-SZYD-shixiangqingdan"></i></div>-->
                                            <!--<div class="icon-des">-->
                                            <!--<p class="p-text">议题</p>-->
                                            <!--<p class="p-number">-->
                                            <!--<b class="red">15</b>-->
                                            <!--<span>个议题</span>-->
                                            <!--</p>-->
                                            <!--</div>-->
                                            <!--</div>-->
                                            <!--</div>-->
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-col-xs9 layadmin-carousel-custom ">
                                    <div class="layui-carousel" id="carousel">
                                        <div carousel-item>
                                            <div>
                                                <ul class="clearFix scrollBarItem">
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs2">
                    <div class="layui-card">
                        <div class="layui-card-header layui-card-header-custom"><span><i></i>异常情况</span></div>
                        <div class="layui-card-body ">

                            <div class="monitorBar">
                                <div class="layui-row">
                                    <div class="layui-col-xs12  moniBox moniBoxXs" style="height: 100px">
                                        <div class="iconBoxMain" style="margin-top: 20px">
                                            <div class="icon-box bg-green3"><i class="fa fa-warning"></i></div>
                                            <div class="icon-des" style="padding-left: 2px">
                                                <p class="p-number">
                                                    <b class="green3" id="countTotalException" style="font-size: 28px;padding-right: 10px">-</b>
                                                    <span>个</span>
                                                </p>
                                                <p class="p-number">
                                                    <span style="font-size: 12px">整改率</span>
                                                    <b id="sucjectExceptionModify" class="green3" style="font-size: 20px;padding-right: 0">-</b>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs4">
                    <div class="layui-card" >
                        <div class="layui-card-header layui-card-header-custom"><span><i></i>十九大至今决策会议情况</span></div>
                        <div class="layui-card-body">
                            <div id="chart1" style="height: 200px;width: 100%"></div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs4">
                    <div class="layui-card">
                        <div class="layui-card-header layui-card-header-custom"><span><i></i>十九大至今决策议题情况</span></div>
                        <div class="layui-card-body">
                            <div id="chart2" style="height: 200px;width: 100%"></div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs4">
                    <div class="layui-card" >
                        <div class="layui-card-header layui-card-header-custom"><span><i></i>最新会议情况</span></div>
                        <div class="layui-card-body">

                            <div class="infoList" id="meetingList" style="height: 200px;overflow: hidden">
                                <ul class="clearFix" style="padding-top: 10px;" >

                                </ul>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12">
                    <div class="layui-card">
                        <div class="layui-card-header layui-card-header-custom"><span><i></i>企业列表</span></div>
                        <div class="layui-card-body">
                            <form action="" class="layui-form layui-form-pane">
                                <div class="layui-row layui-col-space10">
                                    <div class="layui-col-xs4">
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">企业名称</label>
                                            <div class="layui-input-block">
                                                <input class="layui-input" placeholder="请输入企业名称" id="seName" name="seName" type="text">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="layui-col-xs4">
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">时间区间</label>
                                            <div class="layui-input-block">
                                                <select id="huyi1" name="huyi1">
                                                    <option value="">请选择</option>
                                                    <option value="1">最近一天</option>
                                                    <option value="2">最近一周</option>
                                                    <option value="3">最近一个月</option>
                                                    <option value="4">最近三个月</option>
                                                    <option value="5">最近六个月</option>
                                                    <option value="6">最近一年</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="layui-col-xs4">
                                        <div class="layui-input-item" style="text-align: center">
                                            <button class="layui-btn  " lay-filter="formSearch" lay-submit name="searchSubmit"><i class="fa fa-search"></i>查询
                                            </button>
                                            <button class="layui-btn layui-btn-primary  " lay-filter="reset"
                                                    name="reset" type="reset"><i class="fa fa-eraser"></i>重置
                                            </button>

                                        </div>
                                    </div>
                                </div>

                            </form>

                            <table id="table1" lay-filter="table1"></table>
                            <script id="tableToolBar" type="text/html">
                                <div class="layui-btn-container">
                                    <button class="layui-btn layui-btn-sm layui-btn-primary" lay-event="refresh" id="refreshBtn">
                                        <i class="layui-icon">&#xe669;</i> 刷新
                                    </button>
                                </div>
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script charset="utf-8" src="../../js/common/plugin.js"></script>
<script src="./../../js/layui/layui.js"></script>
<script charset="utf-8" src="../../js/lib/echarts-4.1.0.min.js"></script>
<script charset="utf-8" src="../../js/lib/echartTheme.js"></script>

<script>

    layui.config({
        base: '../../../src/js/',
        version: new Date().getTime()
    }).extend({
        custom:'common/custom'
    }).use(['layer', 'eleTree', 'table', 'form', 'laytpl', 'element', 'custom', 'carousel', 'common'], function () {
        var table=layui.table;
        var form=layui.form;
        var common=layui.common;
        var element = layui.element;
        var tree = layui.eleTree;
        var carousel = layui.carousel;
        var common = layui.common;
        element.init();
        var baseUrl='../../../';
        common.themeSet();
        common.toggleArea($('.toggle-btn'),$('.toggle-area'));
        // var eleTreeId=tree.render({
        //     elem: '#leftTree',
        //     defaultExpandAll: true,
        //     data:  [
        //         {
        //             id: 1,
        //             name: "集团",
        //             extendAttr:"enterprise",
        //             children: [
        //                 {
        //                     id: 2,
        //                     name: "集团1",
        //                     extendAttr:"organ"
        //                 },
        //                 {
        //                     id: 3,
        //                     name: "集团2",
        //                     extendAttr:"organ"
        //                 },
        //                 {
        //                     id: 4,
        //                     name: "集团3",
        //                     extendAttr:"organ"
        //                 },
        //                 {
        //                     id: 5,
        //                     name: "集团4",
        //                     extendAttr:"enterprise",
        //                     children:[
        //                         {
        //                             id: 6,
        //                             name: "集团4二级单位",
        //                             extendAttr:"organ"
        //                         },
        //                     ]
        //                 },
        //                 {
        //                     id: 6,
        //                     name: "集团5",
        //                     extendAttr:"enterprise"
        //                 },
        //                 {
        //                     id: 7,
        //                     name: "集团6",
        //                     extendAttr:"enterprise"
        //                 },
        //             ]
        //         },
        //         {
        //             id: 1,
        //             name: "运行分析",
        //             extendAttr:"enterprise",
        //             children: [
        //                 {
        //                     id: 2,
        //                     name: "集团7",
        //                     extendAttr:"organ"
        //                 },
        //                 {
        //                     id: 3,
        //                     name: "集团8",
        //                     extendAttr:"organ"
        //                 },
        //                 {
        //                     id: 4,
        //                     name: "集团9",
        //                     extendAttr:"organ"
        //                 },
        //                 {
        //                     id: 5,
        //                     name: "集团51",
        //                     extendAttr:"enterprise",
        //                     children:[
        //                         {
        //                             id: 6,
        //                             name: "集团15",
        //                             extendAttr:"organ"
        //                         },
        //                     ]
        //                 },
        //                 {
        //                     id: 6,
        //                     name: "集团-1",
        //                     extendAttr:"enterprise"
        //                 },
        //                 {
        //                     id: 7,
        //                     name: "集团-2",
        //                     extendAttr:"enterprise"
        //                 },
        //             ]
        //         }],
        //     showCheckbox: false,
        //     done:function(data){
        //
        //     }
        // });
        //点击弹出事件
        $("#countTotalRegulation").unbind("click").bind("click",function (e) {
            window.open(window.location.origin + '/src/page/custom/custom.html?H8C0B28E3E78NH0E44EGGD1J');
        });
        $("#countTotalItem").unbind("click").bind("click",function (e) {
            window.open(window.location.origin + '/src/page/custom/custom.html?JL7G9ME1KJ4IE4C62F99ACIE');
        });
       $("#countTotalMeeting").unbind("click").bind("click",function (e) {
            window.open(window.location.origin + '/src/page/custom/custom.html?EI9MM56686NDBNI5DG8HMM0I');
        });
       $("#countTotalSubject").unbind("click").bind("click",function (e) {
            window.open(window.location.origin + '/src/page/custom/custom.html?4DN85LCN4708B29LGK342CEB');
        });
       $("#countTotalException").unbind("click").bind("click",function (e) {
            window.open(window.location.origin + '/src/page/reportmgr/zgqk.html');
        });

        //第一行统计
        $.post(baseUrl + 'szydmgr/statistics/countTotalInfo', {}, function (data) {
            if (typeof data== "object" && typeof data.object == "object") {
                var obj = data.object;
                $("#countTotalRegulation").text(obj.regulationCount);
                $("#countTotalItem").text(obj.itemCount);
                $("#countTotalMeeting").text(obj.meetingCount);
                $("#countTotalSubject").text(obj.sucjectCount);
                $("#countTotalException").text(obj.sucjectException);
                $("#sucjectExceptionModify").text(obj.sucjectExceptionModify);
            }
        });



        $.post(baseUrl + 'szydmgr/statistics/selectSituationGroupRelevance', {}, function (data) {
            if (typeof data== "object" && typeof data.object == "object") {
                var obj = data.object;
                if (typeof data == "object" && typeof data.list == "object") {
                    var list = data.list;
                    var ul = $("#carousel ul").eq(0);
                    ul.html("");

                    for (var i = 0; i < list.length; i++) {
                        var d = "<li>\n" +
                            "<span class='span1'>"+list[i].relevanceName+"</span>\n" +
                            "<span class='span2'><b>"+list[i].meetingCount+"</b>次会议</span>\n" +
                            "<span class='span3'><b>"+list[i].sucjectCount+"</b>个议题</span>\n" +
                            "</li>";
                        ul.append(d);
                    }
                }
            }
        });


        $.post(baseUrl + 'szydmgr/statistics/selectNewMeetingInfoList', {}, function (data) {
            var ul = $('#meetingList ul');
            ul.html("");
            if (typeof data== "object" && typeof data.list == "object") {
                var list = data.list;

                for (var i = 0; i < list.length; i++) {
                    var b = "<li>" +
                        "<i class=\"icon iconfont icon-DEZJ-tongzhigonggao\"></i>" +
                        "<span>"+list[i].meetingTime+"，"+list[i].seName+"召开会议，"+list[i].meetingName+"</span>" +
                        "</li>";
                    ul.append(b);
                }

                $('#meetingList ul li').length>6&&common.listScroll($('#meetingList ul'));
            }
        });

        table.render(common.tableInitParams({
            elem: '#table1',
            height:'full-240',
            url: baseUrl + 'szydmgr/statistics/selectStatisticsList',
            method:'post',
            toolbar:'#tableToolBar',
            defaultToolbar:[],
            cols:  [
                [
                    {"field": "seName", "title": "企业名称", "rowspan": 2},
                    {"field": "regulationCount", "title": "决策制度", "rowspan": 2},
                    {"field": "itemCount", "title": "事项清单", "rowspan": 2},
                    {"align": "center", "title": "决策会议", "colspan": 5},
                    {"align": "center", "title": "决策议题", "colspan": 5},
                    {"align": "center", "title": "异常情况", "colspan": 2}
                ],
                [
                    {"field": "meetingCount", "title": "累计"},
                    {"field": "meetingDSHCount", "title": "董事会"},
                    {"field": "meetingDWZHCount", "title": "党组织"},
                    {"field": "meetingJLHCount", "title": "经理层办公会"},
                    {"field": "meetingOtherCount", "title": "其他"},
                    {"field": "subjectCount", "title": "累计"},
                    {"field": "subjectDCount", "title": "重大决策"},
                    {"field": "subjectHCount", "title": "重要人事任免"},
                    {"field": "subjectPCount", "title": "重大项目安排"},
                    {"field": "subjectFCount", "title": "大额资金运作"},
                    {"field": "sucjectExceptionCount", "title": "涉及议题数"},
                    {"field": "exceptionCount", "title": "异常数"}
                ]
            ],
            done: function () {
                common.buttonLimit();
            }
        }));

        //查询
        form.on('submit(formSearch)',function (obj) {
            var huyi1=obj.field.huyi1;
            var seName=obj.field.seName;
            //表格重载
            table.reload('table1',{
                page:{
                    curr:1
                },
                where:{
                    "huyi1":huyi1,
                    "seName":seName
                },

            });
            return false;
        });

        var eventHandle={
            tableReload:function () {
                table.reload('table1',{
                    page:{
                        curr:1
                    }
                });
            }
        };

        //轮播图
        carousel.render({
            elem: '#carousel'
            ,width: '100%' //设置容器宽度
            , height: '100'
            ,arrow: 'hover' //始终显示箭头
            , autoplay: true
            , trigger: 'hover'
        });

        //table监听事件
        table.on('toolbar(table1)',function (obj) {
            var checkStatus = table.checkStatus(obj.config.id);
            switch(obj.event){
                case 'refresh':
                    //刷新表格
                    eventHandle.tableReload();
                    break;
            }
        });


        //echart 数据导入区域
        var  colorList=['#afa3f5', '#00d488', '#3feed4', '#3bafff', '#f1bb4c', "rgba(250,250,250,0.5)"];
        var chart1 = echarts.init(document.getElementById('chart1'), 'custom');
        $.post(baseUrl + 'szydmgr/statistics/selectMSGSeasonAndRelevance',{},function (data) {
            var series = data.object.series;
            for (var i=0;i<series.length;i++) {

                $.extend( series[i],{
                    type: "line"
                })
            }

            chart1.setOption(
                {
                    grid: {
                        top: "25%",
                        bottom: "10%"
                    },
                    color:['#afa3f5', '#00d488', '#eea9c5', '#3bafff', '#c0f18a', "rgba(250,250,250,0.5)"],
                    tooltip: {
                        trigger: "axis",
                    },
                    legend: {
                        data: data.object.legend,
                        top: "5%",
                        textStyle: {
                            color: "#666",
                            fontsize:'12px'
                        }
                    },
                    xAxis: {
                        type : 'category',
                        data:data.object.Axis
                    },
                    yAxis: [
                        {
                            type: "value",
                        }
                    ],
                    series: series
                }
            );
        });


        var chart2 = echarts.init(document.getElementById('chart2'), 'custom');
        $.post(baseUrl + 'szydmgr/statistics/selectSSGSeasonAndRelevance', {}, function (data) {
            var series = data.object.series;
            for (var i=0;i<series.length;i++) {

                $.extend( series[i],{
                    type: 'bar',
                    label: {
                        normal: {
                            show: true,
                            position: 'insideRight'
                        }
                    },
                    barMaxWidth: 35
                })
            }
            chart2.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                        type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                    }
                },
                legend: {data:data.object.legend},
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: data.object.Axis
                },
                yAxis: {
                    type: 'value'

                },
                series: series
            });
        });

        common.columnSide();
        
        $(window).resize(function () {
            common.chartResize(['chart1', 'chart2'], [chart1, chart2]);
        });

    });
    $('.treeHeight').css({'height':$(document).height()-120+'px'});


</script>

<!--[if lt IE 9]>
<script src="../../js/lib/html5.min.js"></script>
<script src="../../js/lib/respond.js"></script>
<![endif]-->
</body>
</html>
