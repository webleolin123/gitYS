<!DOCTYPE html>
<html  class="iframe-h">
<head>
    <meta charset="UTF-8">
    <title>操作日志</title>
    <meta content="webkit" name="renderer"/>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link class="favicon" href="./../../images/ico/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link class="favicon" href="./../../images/ico/favicon.ico" rel="icon" type="image/x-icon">
    <link class="favicon" href="./../../images/ico/favicon.ico" rel="bookmark" type="image/x-icon">
    <link rel="stylesheet" href="../../js/layui/css/layui.css"/>
    <link href="../../css/public.css?v1.01" rel="stylesheet"/>
    <link href="../../js/lib/font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <script src="../../js/lib/jquery.1.12.3.js"></script>
    <script charset="utf-8" src="../../js/common/plugin.js"></script>

</head>
<!--添加按钮中的弹框-->
<div class="userLayer hide">
    <div style="padding: 15px 20px">
        <form class="layui-form layui-form-pane" name="userLayer">
          <div>
            <div class="layui-form-item">
                <label class="layui-form-label">操作类型</label>
                <div class="layui-input-block">
                    <input type="text" name="opType" readonly placeholder="" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">是否成功</label>
                <div class="layui-input-block">
                    <input type="text" name="isSuccess" readonly placeholder="" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">登录IP</label>
                <div class="layui-input-block">
                    <input type="text" name="loginIp" readonly placeholder="" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">操作时间</label>
                <div class="layui-input-block">
                    <input type="text" name="opDate" readonly placeholder="" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">操作用户名</label>
                <div class="layui-input-block">
                    <input type="text" name="opPersonCh" readonly placeholder="" autocomplete="off" class="layui-input">
                </div>
            </div>
             <div class="layui-form-item">
                <label class="layui-form-label">用户所属企业</label>
                <div class="layui-input-block">
                    <input type="text" name="opEnterpriseCh" readonly  lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                </div>
            </div>
             <div class="layui-form-item">
                <label class="layui-form-label">请求参数</label>
                <div class="layui-input-block">
                    <input type="text" name="requestParams" readonly  lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width:100%">操作描述</label>
                <div class="layui-input-block" style="margin-left:0;left:0">
                    <textarea name="opDec" readonly placeholder="" lay-verify="required" class="layui-textarea"></textarea>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width:100%">错误简述</label>
                <div class="layui-input-block" style="margin-left:0;left:0">
                    <textarea name="errorMsg" placeholder="" readonly  lay-verify="required" class="layui-textarea"></textarea>
                </div>
            </div>
            </div>
        </form>
    </div>
</div>
<body class="iframe-h">

<div class="content-wrap">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-xs12 layui-col-sm12 layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header layui-card-header-custom"><span><i></i>操作日志列表</span></div>
                <div class="layui-card-body">
                    <form action="" class="layui-form layui-form-pane">
                        <div class="layui-row layui-col-space10">
                            <div class="layui-col-md4">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">操作类型</label>
                                    <div class="layui-input-block">
                                        <select name="opType"  id="formSelect">
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-col-md4">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">登录IP</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="loginIp" placeholder="请输入" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                            </div>
                            <!-- <div class="layui-col-md-offset4">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">是否成功</label>
                                    <div class="layui-input-block">
                                        <input type="radio" name="isSuccess" value="成功" title="成功" checked>
                                        <input type="radio" name="isSuccess" value="失败" title="失败">
                                    </div>
                                </div>
                            </div> -->
                            <div class="toggle-area layui-col-space10">
                                <div class="layui-col-md4">
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">操作用户名</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="opPersonCh" placeholder="请输入" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                </div>
                                <div class="layui-col-md4">
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">用户所属企业</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="opEnterpriseCh" placeholder="请输入" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                </div>
                                <!-- <div class="layui-col-md4">
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">操作时间</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="opDate" id="opDate_find" placeholder="请输入" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                </div> -->
                                <div class="layui-col-md4">
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">开始时间</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="startTime" id="opStartTime" placeholder="请输入" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                </div>
                                <div class="layui-col-md4">
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">结束时间</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="endTime" id="opEndTime" placeholder="请输入" autocomplete="off" class="layui-input">
                                            </div>
                                        </div>
                                </div>
                            </div>
                            <div class="formSearch-btnArea">
                                <button class="layui-btn" lay-submit lay-filter="formSearch"><i class="fa fa-search"></i>查询</button>
                                <button type="reset" class="layui-btn layui-btn-primary"><i class="fa fa-eraser"></i>重置</button>
                                <a class="toggle-btn">
                                    <span>展开</span>
                                    <i class="fa fa-angle-up"></i>
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="layui-card">
                <div class="layui-card-body" style="padding-top: 0">
                        <table id="table1" lay-filter="table1"></table>
                    <script type="text/html" id="tableToolBar">
                    </script>

                    <script type="text/html" id="tableOper">
                        <a class="layui-btn layui-btn-xs" lay-event="check" permission-btn="editSysOperationlogAuth">查看</a>
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="./../../js/layui/layui.js"></script>
<script>

    layui.config({
        base: '../../../src/js/',
        version: new Date().getTime()
    }).extend({
    }).use(['layer','table','form','common','util','element','laydate'],function () {
        var util = layui.util;
        var table=layui.table;
        var form=layui.form;
        var common=layui.common;
        var laydate = layui.laydate;
        var baseUrl='../../../';
        var element = layui.element;
        element.init();
        common.themeSet();
        common.toggleArea($('.toggle-btn'),$('.toggle-area'));
        laydate.render({
            elem: '#opStartTime',
            type: 'date'
            ,trigger: 'click'
        });
        laydate.render({
            elem: '#opEndTime',
            type: 'date'
            ,trigger: 'click'
        });

        common.selectDataSet({
            elem: $('#formSelect'),
            url: 'sysmgr/dicts/selectDictListByPcode?dictPCode=LOG_OPERTYPE',
            responseList: 'list',
            optionText: 'sdName',
            optionValue: 'sdCode',
            success: function(){
                form.render("select");
            }
        });

        table.render(common.tableInitParams({
            elem: '#table1',
            url: baseUrl+'sysmgr/sysOperationlog/selectSysOperationlogPage',
            method:'post',
            height: 'full-180',
            toolbar:'',
            cols: [
                [
                    {"type":"numbers", "title":"序号"},
                    {field: 'opType', title: '操作类型', sort: true,templet:function (rowData) {
                           if(rowData['opType']===3){
                               return '查询'
                           }else if(rowData['opType']===0){
                               return '新增'
                           }else if(rowData['opType']===1){
                               return '删除'
                           }else if(rowData['opType']===2){
                               return '编辑'
                           }
                        }},
                    {field: 'opDec', title: '操作描述', width:220,sort:true},
                    {field: 'isSuccess', title: '是否成功', width:120,sort:true},
                    {field: 'loginIp', title: '登录IP', width:120,sort:true},
                    {field: 'opDate', title: '操作时间',  sort: true,templet:function (rowData) {
                            return util.toDateString(rowData['opDate']);
                        }},
                    {field: 'opPersonCh', title: '操作用户名', width:120,sort:true},
                    {field: 'opEnterpriseCh', title: '用户所属企业', width:220,sort:true},
                    {field: '', title: '操作', width: 150, toolbar:'#tableOper',fixed: 'right'},
                ]
            ],
            done: function () {
                common.buttonLimit();
            }
        }));

        table.on('tool(table1)', function(obj){
            var data = obj.data;
            switch(obj.event){
                case 'check'://查看
                    //原始数据导入
                    layer.open({
                        offset: '10px',
                        title:'查看操作日志',
                        maxmin: false,
                        type: 1,//页面层
                        area: ['580px','90%'],//高度自适应
                        shadeClose: false,
                        content: $('.userLayer').html(),//加载该区域的html
                        // btn:['<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭'],
                        success:function (obj) {

                            //初始化表格
                            form.render();

                            $(obj.selector).find('input[name=opType]').val(data.opType==0?'新增':data.opType==1?'删除':data.opType==1?'修改':'查询');
                            $(obj.selector).find('input[name=isSuccess]').val(data.isSuccess);
                            $(obj.selector).find('input[name=loginIp]').val(data.loginIp);
                            $(obj.selector).find('input[name=opDate]').val(util.toDateString(data['opDate']));
                            $(obj.selector).find('input[name=opPersonCh]').val(data.opPersonCh);
                            $(obj.selector).find('input[name=opEnterpriseCh]').val(data.opEnterpriseCh);
                            $(obj.selector).find('input[name=requestParams]').val(data.requestParams);
                            $(obj.selector).find('textarea[name=opDec]').val(data.opDec);
                            $(obj.selector).find('textarea[name=errorMsg]').val(data.errorMsg);

                            //form.render('select');

                        },
                        yes:function () {

                            layer.close(layer.index)
                        },
                    });
                    break;
            }

        });

        //表格查询
        form.on('submit(formSearch)',function (obj) {
            //表格重载
            table.reload('table1',{
                url: baseUrl+'sysmgr/sysOperationlog/selectSysOperationlogPage',
                method:'post',
                contentType:'application/json',
                page:{
                    curr:1
                },
                where:{
                    opType:obj.field.opType,
                    loginIp:obj.field.loginIp,
                    opPersonCh:obj.field.opPersonCh,
                    opEnterpriseCh:obj.field.opEnterpriseCh,
                    startTime:obj.field.startTime,
                    endTime:obj.field.endTime
                },

            });
            return false;
        });

        // common.buttonLimit($("#currentMenuSmId", window.parent.document).val());

    });

</script>

<!--[if lt IE 9]>
<script src="../../js/lib/html5.min.js"></script>
<script src="../../js/lib/respond.js"></script>
<![endif]-->
</body>
</html>
