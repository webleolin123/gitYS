<!DOCTYPE html>
<html class="iframe-h">

<head>
    <meta charset="UTF-8">
    <title>制度管理-新建</title>
    <meta content="webkit" name="renderer" />
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link class="favicon" href="./../../images/ico/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link class="favicon" href="./../../images/ico/favicon.ico" rel="icon" type="image/x-icon">
    <link class="favicon" href="./../../images/ico/favicon.ico" rel="bookmark" type="image/x-icon">
    <link rel="stylesheet" href="../../../js/layui/css/layui.css" />
    <link href="../../../css/public.css?v1.01" rel="stylesheet" />
    <link href="../../../js/lib/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <script src="../../../js/lib/jquery.1.12.3.js"></script>
    <style>
        .hytitle {
            font-size: 14px;
        }

        .hylabel {
            border: 1px solid transparent !important;
            background: transparent !important;
        }

        .hyinput {
            border: 1px solid transparent !important;
            border-bottom-color: red !important;
        }

        /*.layui-unselect {*/
        /*border-color: #f56c6c;*/
        /*border-top-style: none;*/
        /*border-right-style: none;*/
        /*border-left-style: none;*/
        /*}*/
        .layui-form-select .layui-edge {
            border-top-color: #f56c6c;
        }

        /*body{*/
        /*background:#f8f8f8;*/
        /*}*/
        .load-btn,
        .check-btn,
        .right-btn {
            position: absolute;
            top: 0;
            right: 0;
            border-radius: 3px;
        }

        .right70 {
            right: 70px;
        }

        .relative {
            position: relative;
        }

        .padRt64 {
            padding-right: 64px;
        }

        li {
            cursor: pointer;
        }

        .zsBga {
            color: purple;
            vertical-align: 1px;
            opacity: 0.5;
        }

        .eleTree.ele5,
        .eleTree.ele6,
        .eleTree.eleBill {
            height: 300px;
            width: 100%;
            display: none;
            position: absolute;
            top: 100%;
            background-color: #fff;
            z-index: 100;
            border: 1px solid #ccc;
        }

        /* 去除弹窗侧面张开按钮 */
        /*a.layui-layer-ico.layui-layer-max{*/
        /*display: none;*/
        /*}*/
        /*a.layui-layer-ico.layui-layer-max.layui-layer-maxmin{*/
        /*display:inline-block!important;*/
        /*}*/
        .layui-table-tool {
            min-height: 0px;
        }
    </style>

</head>


<!--议事规则-添加编辑-->
<script type="text/html" id="ysgz-add">
    <div class="layui-card-body">
        <form class="layui-form layui-form-pane form-theme3" lay-filter='formEdit' name="ysgz-add">
            <div class="layui-row layui-col-space10">
                <div class="layui-col-md12">
                    <div class="layui-form-item">
                        <label class="layui-form-label hylabel"><b class="red">*</b>决议类别：</label>
                            <div class="layui-input-block">
                                <select name="billId" lay-filter="regulationType"  id="regulationType1">
                                    <option value="">请选择</option>
                                </select>
                            </div>
                    </div>
                </div>
                <div class="layui-col-md12">
                    <div class="layui-form-item">
                        <label class="layui-form-label hylabel"><b class="red">*</b>表决规则：</label>
                        <div class="layui-input-block">
                            <select name="modeId" lay-filter="regulationType2"  id="regulationType2">
                                <option value="">请选择</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="layui-col-md12">
                    <div class="layui-form-item">
                        <label class="layui-form-label hylabel"><b class="red">*</b>审议结果：</label>
                        <div class="layui-input-block">
                            <select name="considerResultCode" lay-filter="regulationType3"  id="regulationType3">
                                <option value="">请选择</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12" style="margin-top:10px;">
                   <div style="text-align: center">
                       <button type="button" class="layui-btn" lay-submit lay-filter="ysgzAddSure" id="ysgzAddSure"><i class="fa fa-check-circle"></i>确定</button>
                       <button type="button" class="layui-btn layui-btn-primary ysgzBtnClose"><i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭</button>
                   </div>
                </div>
            </div>
        </form>
    </div>
</script>
<!--新增制度文本-->
<script type="text/html" id="regulationText-add">
    <div class="regulationText-add">
        <div class="layui-card-body">
            <form class="layui-form layui-form-pane  form-theme3" name="regulationText-add"
                  lay-filter="regulationText-add">
                <div class="layui-row layui-col-space15">
                    <input type="hidden" name="textId">
                    <input type="hidden" name="fileId">
                    <input type="hidden" name="fileId">
                    <input type="hidden" name="uploadTime">

                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel"><b class="red">*</b>文本类型：</label>
                            <div class="layui-input-block">
                                <input type="hidden" name="typeName">
                                <input type="hidden" name="typeCode">
                                <select name="regulationType" lay-filter="regulationType">
                                    <option value="">请选择</option>
                                    <option value="0">制度通知</option>
                                    <option value="1">制度正文</option>
                                    <option value="2">制度附件</option>
                                    <option value="3">制度附表</option>
                                    <option value="4">制度附录</option>
                                    <option value="5">制度流程</option>
                                    <option value="6">法律审核</option>
                                    <option value="7">其他</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">上传文件：</label>
                            <div class="layui-input-block">
                                <div style="display: inline-block">
                                    <button class="layui-btn layui-btn-normal" id="uploadFile" type="button">点击选择
                                    </button>
                                </div>
                                <!--<input type="text" name="fileName" placeholder="" class="layui-input"-->
                                <!--readonly="readonly"-->
                                <!--style="display: inline-block;width: 180px;margin-left: 20px;border: none !important">-->
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs12" id="fileNameArea" style="display: none">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">文件名称：</label>
                            <div class="layui-input-block">
                                <input type="text" name="fileName" placeholder="请输入文件名称" class="layui-input"
                                       style="width: 60%;display: inline-block">
                                <input type="text" name="fileType" class="layui-input" readonly="readonly"
                                       style="display: inline-block;width: 30%">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">备注：</label>
                            <div class="layui-input-block">
                                <textarea class="layui-textarea hyinput" name="ggMemo" placeholder="请输入"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <div class="layui-layer-btn layui-layer-btn-c">
                            <button class="layui-btn" id="saveRegulationText" lay-submit lay-filter="saveRegulationText"
                                    permission-btn="saveRegulationText"><i class="fa fa-check-circle"></i>确定
                            </button>
                            <button type="button" class="layui-btn layui-btn-primary btnClose"><i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</script>
<!-- 选择关联制度 -->
<script type="text/html" id="relationRegulationForm">
    <div style="padding: 10px">
        <div class="layui-row">
            <div class="layui-col-xs10">
                <div class="layui-form-item">
                    <label class="layui-form-label">制度名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="zdmc" placeholder="请输入" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-col-xs1">
                &nbsp;<button name="btnSearchRelation" class="layui-btn" lay-submit="" lay-filter="formSearch">查询
            </button>
            </div>
        </div>
        <div class="layui-row">
            <table id="relationRegulationTable" lay-filter="relationRegulationTable"></table>
        </div>
        <div class="layui-row layui-layer-btn layui-layer-btn-c">
            <button id="btnConfirmRegulation" class="layui-btn" lay-submit="" lay-filter="formSearch"><i class="fa fa-check-circle"></i>确定</button>
            <button class="layui-btn layui-btn-primary btnClose" lay-submit="" lay-filter="formSearch"><i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭</button>
        </div>
    </div>
</script>

<!--查看历史版本-添加-->
<script type="text/html" id="regulationHis">
    <div class="h-check-layer">
        <div class="layui-card-body">
            <form class="layui-form layui-form-pane form-theme3">
                <div class="layui-row layui-col-space15" name="regulationHisList">
                    <!-- <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">制度通知:</label>
                            <div class="layui-input-block">
                                <input autocomplete="off" class="layui-input hyinput" name="ytmc" placeholder="请输入"
                                       type="text"
                                       value="关于制度通知文档.pdf">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">制度正文:</label>
                            <div class="layui-input-block">
                                <input autocomplete="off" class="layui-input hyinput" name="ytmc" placeholder="请输入"
                                       type="text"
                                       value="关于制度通知文档.pdf">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">制度附件:</label>
                            <div class="layui-input-block">
                                <input autocomplete="off" class="layui-input hyinput" name="ytmc" placeholder="请输入"
                                       type="text"
                                       value="关于制度通知文档.pdf">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">制度附表:</label>
                            <div class="layui-input-block">
                                <input autocomplete="off" class="layui-input hyinput" name="ytmc" placeholder="请输入"
                                       type="text"
                                       value="关于制度通知文档.pdf">
                            </div>
                        </div>
                    </div> -->
                </div>
                <div class="layui-row layui-layer-btn layui-layer-btn-c">
                    <button class="layui-btn btnClose"><i class="fa fa-check-circle"></i>确定</button>
                    <button class="layui-btn layui-btn-primary btnClose"><i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭</button>
                </div>
            </form>
        </div>
    </div>
</script>

<body class="iframe-h">

    <div class="content-wrap">
        <div class="layui-row layui-col-space15">
            <form class="layui-form layui-form-pane form-theme3" lay-filter="basicForm" name="regulationForm"
                name="regulationForm">
                <!-- 基本信息 -->
                <div class="layui-card">
                    <div class="layui-card-header layui-card-header-custom">
                        <span><i></i>制度信息</span>
                    </div>
                    <div class="layui-card-body">
                        <div class="layui-row layui-col-space15">
                            <div class="layui-col-md15">
                                <div class="layui-form-item">
                                    <label class="layui-form-label hylabel"><b class="red">*</b>制度名称:</label>
                                    <div class="layui-input-block">
                                        <input name="regulationId" type="hidden" />
                                        <input autocomplete="off" class="layui-input hyinput"
                                            lay-verify="regulationName" name="regulationName" placeholder="请输入"
                                            type="text" value="">
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="layui-row layui-col-space15">
                            <div class="layui-col-md6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label hylabel"><b class="red">*</b>制定部门:</label>
                                    <div class="layui-input-block">
                                        <input name="formulateDeptId" type="hidden" />
                                        <input autocomplete="off" class="layui-input hyinput" lay-verify="formulateDept"
                                            name="formulateDept" placeholder="请选择" readonly="readonly" required=""
                                            type="text">
                                        <div class="eleTree ele5" id="ele5" lay-filter="formulateDept"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-col-md6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label hylabel"><b class="red">*</b>制度类别:</label>
                                    <div class="layui-input-block">
                                        <input name="regulationTypeId" type="hidden" />
                                        <input autocomplete="off" class="layui-input hyinput"
                                            lay-verify="regulationTypeName" name="regulationTypeName" placeholder="请选择"
                                            readonly="" required="" type="text" />
                                        <div class="eleTree ele6" id="ele6" lay-filter="regulationType"></div>
                                    </div>
                                </div>
                            </div>


                        </div>
                        <div class="layui-row layui-col-space15">
                            <div class="layui-col-md6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label hylabel">发文文号:</label>
                                    <div class="layui-input-block">
                                        <input autocomplete="off" class="layui-input hyinput" name="markNumber"
                                            type="text" value="">
                                    </div>
                                </div>
                            </div>
                            <div class="layui-col-md6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label hylabel">&#x3000;时效性:</label>
                                    <div class="layui-input-block">
                                        <select class="hyinput " name="valid">
                                            <!-- <option value="">请选择</option> -->
                                            <option value="1">有效</option>
                                            <option value="0">失效</option>

                                            <!-- <option value="2">特急</option> -->
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="layui-row layui-col-space15">
                            <div class="layui-col-md6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label hylabel"><b class="red">*</b>审批日期:</label>
                                    <div class="layui-input-block">
                                        <input class="layui-input hyinput" id="signDate" lay-verify="signDate"
                                            readonly="readonly" name="signDate" placeholder="请选择日期" type="text">
                                    </div>
                                </div>
                            </div>
                            <div class="layui-col-md6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label hylabel"><b class="red">*</b>实施日期:</label>
                                    <div class="layui-input-block">
                                        <input class="layui-input hyinput" id="implementDate" lay-verify="implementDate"
                                            readonly="readonly" name="implementDate" placeholder="请选择日期" type="text">
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="layui-row layui-col-space15">
                            <div class="layui-col-xs6 ">
                                <div class="layui-form-item">
                                    <label class="layui-form-label hylabel"><b class="red">*</b>生效日期:</label>
                                    <div class="layui-input-block">
                                        <input class="layui-input hyinput" id="effectiveDate" lay-verify="effectiveDate"
                                            readonly="readonly" name="effectiveDate" placeholder="请选择日期" type="text">
                                    </div>
                                </div>
                            </div>
                            <div class="layui-col-xs6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label hylabel">失效日期:</label>
                                    <div class="layui-input-block">
                                        <input class="layui-input hyinput" id="expireDate" name="expireDate"
                                            readonly="readonly" placeholder="请选择日期" type="text">
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="layui-row layui-col-space15">
                            <div class="layui-col-xs12">
                                <div class="layui-form-item">
                                    <label class="layui-form-label hylabel">主要内容:</label>
                                    <div class="layui-input-block">
                                        <textarea class="layui-textarea hyinput" name="ggMemo" value="备注11"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <!-- -----------退回情况------------ -->
                <div class="layui-collapse white-bg" style="margin-top: 10px">

                    <div class="layui-card">
                        <div class="layui-card-header layui-card-header-custom">
                            <span><i></i>退回情况</span>
                        </div>
                        <div class="layui-card-body">
                            <div class="layui-row layui-col-space15">
                                <div class="layui-col-md6">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label hylabel"><b class="red">*</b>退回操作单位:</label>
                                        <div class="layui-input-block">
                                            <input autocomplete="off" class="layui-input hyinput" name="auditSeName"
                                                type="text" value="">
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-col-md6">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label hylabel">退回操作部门:</label>
                                        <div class="layui-input-block">
                                            <input autocomplete="off" class="layui-input hyinput" name="auditOrgName"
                                                type="text" value="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-row layui-col-space15">
                                <div class="layui-col-xs12">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label hylabel"><b class="red">*</b>退回操作意见:</label>
                                        <div class="layui-input-block">
                                            <input autocomplete="off" class="layui-input hyinput" name="auditOpnion"
                                                type="text" value="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-row layui-col-space15">
                                <div class="layui-col-md6">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label hylabel">退回操作人:</label>
                                        <div class="layui-input-block">
                                            <input autocomplete="off" class="layui-input hyinput" name="auditSuName"
                                                type="text" value="">
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-col-md6">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label hylabel">退回操作时间:</label>
                                        <div class="layui-input-block">
                                            <input autocomplete="off" id="auditDatetime" lay-verify="auditDatetime"
                                                class="layui-input hyinput" name="auditDatetime" type="text" value="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-col-xs6 hide" id="peopleNumber">
                                <div class="layui-form-item">
                                    <label class="layui-form-label hylabel">人数占比:</label>
                                    <div class="layui-input-block">
                                        <input class="layui-input hyinput" name="auditDatetime" type="date">
                                    </div>
                                </div>
                            </div>


                        </div>



                    </div>
                </div>
        </div>
    </div>

    <!-- <div style="display: none">
                <div class="layui-card" style="position: absolute;width: 100%;top: 99%;">
                    <div class="layui-card-body">
                        <div class="layui-layer-btn layui-layer-btn-c">
                            <button class="layui-btn" lay-filter="saveRegulation" lay-submit> <i class="layui-icon">&#x1005;</i>保存</button>
                        </div>
                    </div>
                </div>
            </div> -->

    <input name="regulationPid" type="hidden">

    <div style="position: fixed;width: 100%;bottom: 17px;z-index: 999;" class="viewHiden hide">
        <div class="layui-card" style="margin-top: 10px">
            <div class="layui-card-body">
                <div class="layui-form-item" style="text-align: center;">
                    <button type="button" lay-filter="saveRegulation" lay-submit class="layui-btn"> <i class="layui-icon">&#x1005;</i>保存</button>
                    <button type="button" class="layui-btn layui-btn-danger" lay-submit
                        lay-filter="submitRegulation"><i class="layui-icon">&#xe605;</i>提交</button>
                    <button type="button" class="layui-btn layui-btn-primary btnClose"><i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭</button>
                </div>
            </div>
        </div>
    </div>
    </form>

    </div>
    <div class="layui-collapse white-bg hide" id="ysgz" style="margin-top: 10px;display: none;">
        <div class="layui-colla-item">
            <h2 class="layui-colla-title white-bg">议事规则</h2>
            <div class="layui-colla-content">
                <!-- 议事规则 -->
                <div class="layui-card">

                    <div class="layui-card-body">
                        <table class="layui-table" id="YsgzTable" lay-filter="YsgzTable"></table>
                        <script id="ysgzToolbar" type="text/html">
                            <div class="layui-btn-container">
                                <button class="layui-btn layui-btn-sm" lay-event="add">
                                    <i class="layui-icon">&#xe608;</i> 新增
                                </button>
                                <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete">
                                    <i class="layui-icon">&#xe640;</i> 删除
                                </button>
                            </div>
                        </script>
                        <script id="ysgzOper" type="text/html">
                            <a class="layui-btn layui-btn-xs edit" lay-event="edit">编辑</a>
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-collapse white-bg hide" id="regulationTextDiv" style="margin-top: 10px">
        <div class="layui-colla-item">
            <h2 class="layui-colla-title white-bg">制度文本</h2>
            <div class="layui-colla-content">
                <!-- 制度文本 -->
                <div class="layui-card">
                    <!-- <div class="layui-card-header">
                            <i class="iconfont icon-SZYD-xtsjzdgl"></i>
                            <span class="hytitle">制度文本</span>
                            <i class="layui-icon layui-icon-right"></i>
                    </div> -->

                    <div class="layui-card-body">

                        <table id="regulationTextTable" lay-filter="regulationTextTable"></table>
                        <script id="regulationTextToolBar" type="text/html">
                            <div class="layui-btn-container">
                                <button class="layui-btn layui-btn-sm" lay-event="add"
                                        permission-btn="saveRegulationText">
                                    <i class="layui-icon">&#xe608;</i> 新增
                                </button>
                                <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete"
                                        permission-btn="deleteRegulationText">
                                    <i class="layui-icon">&#xe640;</i> 删除
                                </button>
                            </div>
                        </script>

                        <script id="regulationTextOper" type="text/html">
                            <!-- <a class="layui-btn layui-btn-xs" lay-event="check">查看</a> -->
                        <a class="layui-btn layui-btn-xs" lay-event="download"
                            permission-btn="downloadRegulationText">下载</a>
                        <!-- <a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="upFile"><i
                                    class="layui-icon">&#xe619;</i>上移</a>
                            <a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="downFile"><i
                                    class="layui-icon">&#xe61a;</i>下移</a> -->
                        <!-- <a class="layui-btn layui-btn-xs" lay-event="edit" permission-btn="updateRegulationText">编辑</a>
                            <a class="layui-btn layui-btn-xs" lay-event="delete" permission-btn="deleteRegulationText">删除</a> -->
                        <a class="layui-btn layui-btn-xs viewHiden" permission-btn="regulationTextUp"
                            lay-event="upFile"><i class="layui-icon">&#xe619;</i>上移</a>
                        <a class="layui-btn layui-btn-xs viewHiden" permission-btn="regulationTextDown"
                            lay-event="downFile"><i class="layui-icon">&#xe61a;</i>下移</a>
                        </script>

                    </div>

                    <div class="layui-card-body">
                        <div class="layui-row layui-col-space18">
                            <div class="layui-col-md11">
                                <div class="layui-form-item">
                                    <label class="layui-form-label hylabel" style="margin-left: -45px">历史版本:</label>
                                    <div class="layui-input-block" style="margin-left: 90px">
                                        <input class="layui-input hyinput" name="regulationPname" placeholder="请选择"
                                            readonly="readonly" type="text">

                                    </div>
                                </div>
                            </div>
                            <div class="layui-col-md1">
                                <button class="layui-btn" permission-btn="" id="btnRelationRegulation">选择</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-collapse white-bg hide" id="regulationHisDiv" style="margin-top: 10px;margin-bottom: 100px">
        <div class="layui-colla-item">
            <h2 class="layui-colla-title white-bg">历史版本</h2>
            <div class="layui-colla-content">
                <!-- 历史版本 -->
                <div class="layui-card">

                    <div class="layui-card-body">
                        <ul class="layui-timeline" id="regulationHisList">
                            <!-- <li class="layui-timeline-item">
                                <i class="layui-icon layui-timeline-axis"></i>
                                <div class="layui-timeline-content layui-text">
                                    <h3 class="layui-timeline-title">中国有色矿业集团有限公司章程(2017修正)</h3>
                                    <p>
                                        XXXX号 / 失效 / 2017.11.04发布 /2017.11.04实施
                                    </p>
                                </div>
                                <button class="layui-btn layui-btn-radius right-btn history-check">查看</button>
                            </li>
                            <li class="layui-timeline-item">
                                <i class="layui-icon layui-timeline-axis"></i>
                                <div class="layui-timeline-content layui-text">
                                    <h3 class="layui-timeline-title">中国有色矿业集团有限公司章程(2015修正)</h3>
                                    <p>
                                        XXXX号 / 失效 / 2015.11.04发布 /2017.11.04实施
                                    </p>
                                </div>
                                <button class="layui-btn layui-btn-radius right-btn history-check">查看</button>
                            </li> -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>


    <script src="./../../../js/layui/layui.js"></script>
    <script>

        layui.config({
            base: '../../../src/js/',
            version: new Date().getTime()
        }).use(['eleTree', 'layer', 'table', 'form', 'laytpl', 'common', 'element', 'laydate', 'upload'], function () {

            var table = layui.table;
            var form = layui.form;
            var tree = layui.eleTree;
            var common = layui.common;
            var element = layui.element;
            var laydate = layui.laydate;
            var upload = layui.upload;
            var util = layui.util;

            var fileSortData;

            var regulationTextMap = {};
            var layerLoader;
            //按钮权限
            common.buttonLimit();
            element.init();
            var baseUrl = '../../../../';
            common.themeSet();
            var formEditData = {};


            var flowAuditId = common.getQueryVariable("flowAuditId");

            common.fetchPost('rulemgr/regulation/backViewByAuditId', { flowAuditId }, function (res) {
                res.object.auditDatetime = common.toDateString(res.object.auditDatetime,'yyyy-MM-dd HH:mm:ss')
                // res.object.approvalDate = common.toDateString(res.object.approvalDate,'yyyy-MM-dd')
                res.object.effectiveDate = common.toDateString(res.object.effectiveDate,'yyyy-MM-dd')
                res.object.expireDate = common.toDateString(res.object.expireDate,'yyyy-MM-dd')
                res.object.signDate = common.toDateString(res.object.signDate,'yyyy-MM-dd')
                res.object.implementDate = common.toDateString(res.object.implementDate,'yyyy-MM-dd')
                
                form.val('basicForm', res.object)
                $('.layui-card-body').click()
            }, function (err) {

            })

            function renderViewMode() {
                var view = common.getQueryVariable("view");
                if (view == "view") {
                    $("button").addClass("hide");
                    $("input,select,textarea").attr("disabled", "disabled");
                    $(".viewHiden").addClass("hide");
                    $(".viewShow").removeClass("hide");

                }
            }
            renderViewMode()

            // 日期时间选择器
            laydate.render({
                elem: '#signDate',
                type: 'date',
                //value: new Date(),
                format: 'yyyy-MM-dd'
                , trigger: 'click'
            });
            laydate.render({
                elem: '#implementDate',
                type: 'date',
                // value: new Date(),
                format: 'yyyy-MM-dd'
                , trigger: 'click'
            });
            laydate.render({
                elem: '#effectiveDate',
                type: 'date'
                , trigger: 'click'
                //value:'2018-08-25'
            })

            laydate.render({
                elem: '#expireDate',
                type: 'date',
                // value: '2019-07-25',
                format: 'yyyy-MM-dd'
                , trigger: 'click'
            });

            laydate.render({
                elem: '#auditDatetime',
                type: 'datetime',
                // value: '2019-07-25',
                format: 'yyyy-MM-dd HH:mm:ss'
                , trigger: 'click'
            });



            $('#regulationAddBtn').unbind('click').bind('click', function (e) {
                $("[lay-filter='saveRegulation']").click();
                return false;
            });

            form.on('checkbox(regulationAuditType)', function (data) {
                console.log(data);
                if (data.value === '2' && data.elem.checked === true) {
                    $("#uploadApprovalWayFile").removeAttr("disabled");
                } else {
                    $("#uploadApprovalWayFile").attr('disabled', "true");
                }
                // if(data.value == 2){
                //     $("#meetingTypes").attr('disabled',"true");
                //     form.render('select');
                //     $("#uploadApprovalWayFile").removeAttr("disabled");
                // }else{
                //     $("#uploadApprovalWayFile").attr('disabled',"true");
                //     $("#meetingTypes").removeAttr("disabled");
                //     form.render('select');
                // }
            });

            form.on('radio(auditFlag)', function (data) {
                if (data.value == 0) {
                    $("#uploadLawFile").attr('disabled', "true");
                } else {
                    $("#uploadLawFile").removeAttr("disabled");
                }
            });

            common.fetchGet('sysmgr/dicts/selectDictListByPcode?dictPCode=REGULATION_TEXT_TYPE', function (data) {
                if (data && data.list && data.list.length > 0) {
                    attendStatusList = data.list;
                    if (data.success) {
                        //regulationTextMap=data.list
                        $.map(data.list, function (item) {
                            regulationTextMap[item.sdCode] = item;
                        });
                    }
                }
            });
            var uploadLawFileObj = null, uploadApprovalWayFileObj = null;

            uploadLawFile();
            function uploadLawFile() {
                if (uploadLawFileObj) return;
                $('#uploadLawFile').unbind('click');
                var regulationId = common.getQueryVariable("regulationId") || $("input[name=regulationId]").val();
                if (regulationId) {
                    uploadLawFileObj = upload.render({
                        elem: '#uploadLawFile',
                        url: baseUrl + 'zuul/dfsmgr/file/fileUpload',
                        auto: true,
                        bindAction: "#saveLawFile",
                        data: { "resId": regulationId, "fiFileType": 'LAW' },
                        accept: 'file',
                        choose: function (obj) {
                            obj.preview(function (index, file, result) {
                                $("input[name=auditFlagFileName]").val(file.name);
                            });
                        },
                        done: function (res, index, upload) {
                            $("input[name='auditFlagFileId']").val(res.list[0].fiId);
                            $("input[name='auditFlagFileName']").val(res.list[0].fiOriginalName);
                            $("input[name='regulationId']").val(regulationId);
                            // $("[lay-filter='saveRegulation']").click();
                            return false;
                        }
                    });
                } else {
                    $('#uploadLawFile').bind("click", function () {
                        layer.msg("请先保存制度信息");
                    });
                }
            }

            // $('#deleteUploadLawFile').on("click",function () {
            //     $("input[name=auditFlagFileName]").val("");
            // });


            uploadApprovalWayFile();
            function uploadApprovalWayFile() {
                if (uploadApprovalWayFileObj) return;
                $('#uploadApprovalWayFile').unbind('click');
                var regulationId = common.getQueryVariable("regulationId") || $("input[name=regulationId]").val();
                if (regulationId) {
                    uploadApprovalWayFileObj = upload.render({
                        elem: '#uploadApprovalWayFile',
                        url: baseUrl + 'zuul/dfsmgr/file/fileUpload',
                        auto: true,
                        bindAction: "#saveApprovalWayFile",
                        data: { "resId": regulationId, "fiFileType": 'REPORT' },
                        accept: 'file',
                        choose: function (obj) {
                            obj.preview(function (index, file, result) {
                                $("input[name=auditReportFileName]").val(file.name);
                            });
                        },
                        done: function (res, index, upload) {
                            $("input[name='auditReportFileId']").val(res.list[0].fiId);
                            $("input[name='auditReportFileName']").val(res.list[0].fiOriginalName);
                            $("input[name='regulationId']").val(regulationId);
                            // $("[lay-filter='saveRegulation']").click();
                            return false;
                        }
                    });
                } else {
                    $('#uploadApprovalWayFile').bind("click", function () {
                        layer.msg("请先保存制度信息");
                    });
                }
            }

            $('#deleteUploadApprovalWayFile').on("click", function () {
                $("input[name=auditReportFileName]").val("");
            });


            var eleTreeHandle = {
                render: function () {
                    var el5, el6, elBill;
                    var regulationVoteLayer;
                    var fileUpload;
                    var regulationVoteTable, regulationTextTable, regulationHisTable;
                    var flowAuditId = common.getQueryVariable("flowAuditId");
                    common.fetchPost()
                    if (!regulationId) {
                        regulationId = $("input[name=regulationId]").val();
                        $("#meetingTypes").attr('disabled', "true");
                    }

                    if (regulationId) {
                        $('#downloadReportFile').removeClass("hide");
                        $('#downloadLawFile').removeClass("hide");
                        var sURL = "rulemgr/regulation/info?regulationId=" + regulationId;
                        common.fetchGet(sURL, function (res) {
                            if (res.object.regulationAuditType == 2) {

                                form.render('select');
                                $("#uploadApprovalWayFile").removeAttr("disabled");
                            }
                            if (res.object.auditFlag == 1) {
                                $("#uploadLawFile").removeAttr("disabled");
                            }
                            form.val("basicForm", res.object);
                            common.fetchPost('rulemgr/regulation/selectFileList', {
                                "fiFileType": "REPORT",
                                "resId": regulationId
                            }, function (res) {
                                if (res.list != null && res.list.length > 0) {
                                    $("input[name=auditReportFileId]").val(res.list[0].fiId);
                                    $("input[name=auditReportFileName]").val(res.list[0].fiName);
                                }
                            }, function () {
                            });
                            // =================================重要!!!!!!!!!!===========
                            // $("select[name=meetingTypeName]").val(res.object.meetingTypeId);
                            form.render();


                            eleTreeHandle.ysgzTableInit()







                            //制度文本表格渲染
                            regulationTextTable = table.render(common.tableInitParams({
                                elem: '#regulationTextTable',
                                url: baseUrl + 'rulemgr/regulation/selectFilePage',
                                where: { "resId": $("input[name=regulationId]").val(), "sdPcode": "REGULATION_TEXT_TYPE" },
                                method: 'post',
                                toolbar: '#regulationTextToolBar',
                                // defaultToolbar:['filter'],
                                height: 'full-200',
                                cols: [[
                                    { type: 'checkbox' },
                                    { type: 'numbers', title: '序号' },
                                    {
                                        field: 'sdName', title: '文本类型'
                                        // ,
                                        //     templet:function (rowData) {
                                        //         if (rowData['fiFileType']&&regulationTextMap[rowData['fiFileType']]) {
                                        //             return regulationTextMap[rowData['fiFileType']]['sdName']
                                        //         } else {
                                        //             return ''
                                        //         }
                                        //     }

                                    },
                                    {
                                        field: 'fiName',
                                        title: '文件名称',
                                        minWidth: 150,
                                        sort: true,
                                        templet: function (rowData) {
                                            return rowData.fiName + '.' + rowData.fiSuffix;
                                        }
                                    },
                                    { field: 'fiUploadTime', title: '上传时间', sort: true },
                                    { field: 'ggMemo', title: '备注' },
                                    { field: '', title: '操作', toolbar: '#regulationTextOper', fixed: 'right', width: 230 }
                                ]],
                                done: function (data) {
                                    eleTreeHandle.renderViewMode();
                                    fileSortData = common.arraySort(data.data ? data.data : [], 'ggSort');
                                }
                            }));

                            //渲染历史版本列表
                            if (res.object.regulationPid) {
                                eleTreeHandle.getHistoryRegulation(res);
                            }
                        });
                    } else {


                        //制度文本表格渲染
                        regulationTextTable = table.render(common.tableInitParams({
                            elem: '#regulationTextTable',
                            data: [],
                            toolbar: '#regulationTextToolBar',
                            // defaultToolbar:['filter'],
                            height: 'full-200',
                            cols: [[
                                { type: 'checkbox' },
                                { type: 'numbers', title: '序号' },
                                { field: 'typeName', title: '文本类型', sort: true },
                                { field: 'fileName', title: '文件名称', sort: true },
                                { field: 'uploadTime', title: '上传时间', sort: true },
                                { field: '', title: '操作', toolbar: '#regulationTextOper', fixed: 'right', width: 175 }
                            ]],
                            done: function (data) {
                                //文件排序，并且数据保存到全局
                                // fileSortData
                                fileSortData = common.arraySort(data.data ? data.data : [], 'ggSort');
                            }
                        }));
                    }

                    $("[name='formulateDept']").on("click", function (e) {
                        e.stopPropagation();
                        if (!el5) {
                            el5 = tree.render({
                                elem: '#ele5',
                                url: baseUrl + 'sysmgr/sysOrgan/selectSysOrganTreeBySeId',
                                method: "POST",
                                response: {                 // 对于后台数据重新定义名字
                                    statusName: "success",
                                    statusCode: "0",
                                    dataName: "list"
                                },
                                defaultExpandAll: true,
                                expandOnClickNode: false,
                                highlightCurrent: true
                            });
                        }
                        $(".ele5").toggle();
                    });
                    tree.on("nodeClick(formulateDept)", function (item) {
                        $("input[name='formulateDept']").val(item.data.parentData.data.id != item.data.currentData.id ? (item.data.parentData.data.name + '-' + item.data.currentData.name) : item.data.currentData.name);
                        $("input[name='formulateDeptId']").val(item.data.currentData.id);
                        $(".ele5").hide();
                    });

                    $(document).on("click", function () {
                        $(".ele5").hide();
                        $(".ele6").hide();
                        $(".eleBill").hide();
                    });
                    $("input[name='regulationTypeName']").on("click", function (e) {
                        e.stopPropagation();
                        if (!el6) {
                            el6 = tree.render({
                                elem: '#ele6',
                                url: baseUrl + 'rulemgr/regulationTypeAlias/getSelect',
                                method: 'get',
                                response: {                 // 对于后台数据重新定义名字
                                    statusName: "success",
                                    statusCode: "0",
                                    dataName: "list"
                                },
                                request: {
                                    name: "regulationName",
                                    key: "regulationTypeAliasId"
                                },
                                defaultExpandAll: true,
                                expandOnClickNode: false,
                                highlightCurrent: true
                            });
                        }
                        $(".ele6").toggle();
                    });

                    tree.on("nodeClick(regulationType)", function (item) {
                        $("input[name='regulationTypeName']").val(item.data.parentData.data.regulationTypeAliasId != item.data.currentData.regulationTypeAliasId ? (item.data.parentData.data.regulationName + '-' + item.data.currentData.regulationName) : item.data.currentData.regulationName);
                        $("input[name='regulationTypeId']").val(item.data.currentData.regulationTypeAliasId);
                        if (item.data.currentData.isYsgz === '0') {
                            $('#ysgz').css('display', 'none')
                        } else {
                            $('#ysgz').css('display', 'block')
                        }
                        $(".ele6").hide();
                    });

                    //获取会议类型列表
                    common.selectDataSet({
                        elem: $("select[name=meetingTypeName]"),
                        url: "meetingmgr/tiolMeetingType/getTiolMeetingTypeList",
                        responseList: "list",
                        method: "get",
                        optionText: "meetingTypeName",
                        optionValue: "meetingTypeId"
                    });
                    form.render();

                    // table.on("toolbar(regulationVoteTable)", function (obj) {
                    //     switch (obj.event) {
                    //         case "add":
                    //             if (regulationId) {
                    //                 regulationVoteLayer = layer.open({
                    //                     type: 1,
                    //                     content: $("#regulationVote-add").html(),
                    //                     area: ["800px", "430px"],
                    //                     success: function () {
                    //                         $("input[name=billName]").on("click", function (e) {
                    //                             e.stopPropagation();
                    //                             if (!elBill) {
                    //                                 elBill = tree.render({
                    //                                     elem: '#billTree',
                    //                                     url: '/catalog/tiolBillType/queryTiolBillTypeTree',
                    //                                     response: {                 // 对于后台数据重新定义名字
                    //                                         statusName: "success",
                    //                                         statusCode: "0",
                    //                                         dataName: "list"
                    //                                     },
                    //                                     defaultExpandAll: true,
                    //                                     expandOnClickNode: false,
                    //                                     highlightCurrent: true
                    //                                 });
                    //                             }

                    //                             $(".eleBill").toggle();
                    //                         });
                    //                         // 保存表决方式
                    //                         // form.on("submit(saveRegulationVote)", function (obj) {
                    //                         //     var data = obj.field;
                    //                         //     data.regulationId = $("input[name=regulationId]").val();
                    //                         //     data.modeId = $("select[name=voteMode] option:checked").val();
                    //                         //     data.modeName = $("select[name=voteMode] option:checked").text();
                    //                         //     //保存表决方式
                    //                         //     layerLoader =common.layerLoader();
                    //                         //     var sURL = "rulemgr/regulationVote/save";
                    //                         //     common.fetchPost(sURL, data, function (obj) {
                    //                         //         layer.close(layerLoader);
                    //                         //         table.reload("regulationVoteTable");
                    //                         //         layer.close(regulationVoteLayer);
                    //                         //     },function(obj){
                    //                         //         layer.msg(obj.resultMessage);
                    //                         //         layer.close(layerLoader);
                    //                         //     });

                    //                         //     return false;
                    //                         // });

                    //                         tree.on("nodeClick(billData)", function (obj) {
                    //                             $("input[name=billId]").val(obj.data.currentData.id);
                    //                             $("input[name=billName]").val(obj.data.currentData.name);
                    //                             $(".eleBill").hide();
                    //                         });

                    //                         $(".btnClose").on("click", function () {
                    //                             elBill = null;
                    //                             parent.layer.closeAll();
                    //                         });

                    //                         //获取表决方式列表
                    //                         common.selectDataSet({
                    //                             elem: $("select[name=voteMode]"),
                    //                             url: "rulemgr/regulationVoteAlias/getAll",
                    //                             responseList: "list",
                    //                             method: "get",
                    //                             optionText: "aliasName",
                    //                             optionValue: "aliasModeId"
                    //                         });

                    //                         form.render();
                    //                     }
                    //                 });
                    //             } else {
                    //                 layer.msg('请先保存制度');
                    //             }

                    //             break;
                    //         case "delete":
                    //             var checkStatus = table.checkStatus(obj.config.id);
                    //             if (checkStatus.data.length > 0) {
                    //                 var confirmLayer = layer.confirm("确定删除选中行?", {
                    //                     btn: ['<i class="fa fa-check-circle"></i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                    //                 },
                    //                     function (index, layero) {
                    //                         var sURL = "rulemgr/regulationVote/delete?ids=";
                    //                         var ids = [];
                    //                         for (var i = 0; i < checkStatus.data.length; i++) {
                    //                             ids.push(checkStatus.data[i].voteId);
                    //                         }

                    //                         common.fetchDelete(sURL + ids.join(","), function (res) {
                    //                             if (res.success) {
                    //                                 table.reload("regulationVoteTable");
                    //                                 layer.msg("删除成功");
                    //                                 layer.close(confirmLayer);
                    //                             } else {
                    //                                 layer.alert(res.resultMessage);
                    //                             }
                    //                         });
                    //                     });
                    //             }
                    //             break;
                    //     }
                    // });

                    // table.on("tool(regulationVoteTable)", function (obj) {
                    //     switch (obj.event) {
                    //         case "edit":
                    //             regulationVoteLayer = layer.open({
                    //                 type: 1,
                    //                 content: $("#regulationVote-add").html(),
                    //                 area: ["800px", "430px"],
                    //                 success: function () {
                    //                     $("input[name=billName]").on("click", function (e) {
                    //                         e.stopPropagation();
                    //                         if (!elBill) {
                    //                             elBill = tree.render({
                    //                                 elem: '#billTree',
                    //                                 url: '/catalog/tiolBillType/queryTiolBillTypeTree',
                    //                                 response: {                 // 对于后台数据重新定义名字
                    //                                     statusName: "success",
                    //                                     statusCode: "0",
                    //                                     dataName: "list"
                    //                                 },
                    //                                 defaultExpandAll: true,
                    //                                 expandOnClickNode: false,
                    //                                 highlightCurrent: true
                    //                             });
                    //                         }

                    //                         $(".eleBill").toggle();
                    //                     });

                    //                     form.on("submit(saveRegulationVote)", function (obj) {
                    //                         var data = obj.field;
                    //                         data.regulationId = $("input[name=regulationId]").val();
                    //                         data.modeId = $("select[name=voteMode] option:checked").val();
                    //                         data.modeName = $("select[name=voteMode] option:checked").text();
                    //                         //保存表决方式
                    //                         layerLoader = common.layerLoader();
                    //                         var sURL = "rulemgr/regulationVote/update";
                    //                         common.fetchPost(sURL, data, function (obj) {
                    //                             table.reload("regulationVoteTable");
                    //                             layer.close(layerLoader);
                    //                             layer.close(regulationVoteLayer);
                    //                         }, function (obj) {
                    //                             layer.msg(obj.resultMessage);
                    //                             layer.close(layerLoader);
                    //                         });

                    //                         return false;
                    //                     });

                    //                     tree.on("nodeClick(billData)", function (obj) {
                    //                         $("input[name=billId]").val(obj.data.currentData.id);
                    //                         $("input[name=billName]").val(obj.data.currentData.name);
                    //                         $(".eleBill").hide();
                    //                     });

                    //                     $(".btnClose").on("click", function () {
                    //                         elBill = null;
                    //                         parent.layer.closeAll();
                    //                     });

                    //                     //获取表决方式列表
                    //                     common.selectDataSet({
                    //                         elem: $("select[name=voteMode]"),
                    //                         url: "rulemgr/regulationVoteAlias/getAll",
                    //                         responseList: "list",
                    //                         method: "get",
                    //                         optionText: "aliasName",
                    //                         optionValue: "aliasModeId"
                    //                     });

                    //                     form.val("regulationVote-add", $.extend({}, obj.data, { voteMode: obj.data.modeId }));
                    //                     form.render("select");
                    //                 }
                    //             });
                    //             break;
                    //         case "delete":
                    //             var confirmLayer = layer.confirm("确定删除选中行?", {
                    //                 btn: ['<i class="fa fa-check-circle"></i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                    //             },
                    //                 function (index, layero) {
                    //                     var sURL = "rulemgr/regulationVote/delete?ids=";

                    //                     common.fetchDelete(sURL + obj.data.voteId, function (res) {
                    //                         if (res.success) {
                    //                             table.reload("regulationVoteTable");
                    //                             layer.msg("删除成功");
                    //                             layer.close(confirmLayer);
                    //                         } else {
                    //                             layer.alert(res.resultMessage);
                    //                         }
                    //                     });
                    //                 });
                    //             break;
                    //     }
                    // });
                    // 保存制度信息
                    form.on("submit(saveRegulation)", function (obj) {
                        var sURL = "rulemgr/regulation/save";
                        if ($("input[name=regulationId]").val() != "") {
                            sURL = "rulemgr/regulation/update";
                        }
                        var data = obj.field;
                        if (data.effectiveDate != "" && data.effectiveDate != undefined) {
                            data.effectiveDate = data.effectiveDate + " 00:00:00";
                        }
                        if (data.expireDate != "" && data.effectiveDate != undefined) {
                            data.expireDate = data.expireDate + " 23:59:59";
                        }

                        //审批方式
                        var regulationAuditType = $("input[name=regulationAuditType]:checked").val();

                        var auditFlag = $("input[name=auditFlag]:checked").val();
                        if (data.regulationId) {
                            if (regulationAuditType == 1 && (data.meetingTypeName == '请选择' || data.meetingTypeName == '')) {
                                layer.alert("审批方式为【会议】时,会议类型不能为空!");
                                return false;
                            }
                            if (regulationAuditType == 2 && !data.auditReportFileName) {
                                layer.alert("审批方式为【签报】时,附件不能为空!");
                                return false;
                            }
                            if (auditFlag == 1 && !data.auditFlagFileName) {
                                layer.alert("法律审核为【是】时,附件不能为空!");
                                return false;
                            }
                        }
                        // if(regulationAuditType==1){
                        //     data.auditReportFileId = "";
                        //     data.auditReportFileName="";
                        //     data.meetingTypeId = $("#meetingTypes").val();
                        //     data.meetingTypeName = $("select[name=meetingTypeName]").find("[value='" + data.meetingTypeId + "']").text();
                        //     if(data.meetingTypeName=='请选择'){
                        //     	data.meetingTypeName='';
                        //     }
                        // }else if(regulationAuditType==2){
                        //     data.auditReportFileId = $("input[name=auditReportFileId]").val();
                        //     data.auditReportFileName = $("input[name=auditReportFileName]").val();
                        //     data.meetingTypeName="";
                        //     data.meetingTypeId="";
                        // }
                        if (auditFlag == 0) {
                            data.auditFlagFileId = "";
                            data.auditFlagFileName = "";
                        } else {
                            data.auditFlagFileId = $("input[name=auditFlagFileId]").val();
                            data.auditFlagFileName = $("input[name=auditFlagFileName]").val();
                        }
                        data['isSubmit'] = '0'
                        layerLoader = common.layerLoader();

                        common.fetchPost(sURL, data, function (result) {
                            $("input[name=regulationId]").val(result.object.regulationId);
                            //eleTreeHandle.getHistoryRegulation(result);
                            layer.close(layerLoader);
                            layer.msg("保存成功");
                            eleTreeHandle.render();
                            $("#meetingTypes").removeAttr('disabled')
                            uploadApprovalWayFile();
                            uploadLawFile();

                        }, function (result) {
                            layer.close(layerLoader);
                            layer.msg(result.resultMessage);
                        });
                        return false;
                    });

                    // 提交制度信息
                    form.on("submit(submitRegulation)", function (obj) {
                        var sURL = "rulemgr/regulation/save";
                        if ($("input[name=regulationId]").val() != "") {
                            sURL = "rulemgr/regulation/update";
                        }
                        var data = obj.field;
                        if (data.effectiveDate != "" && data.effectiveDate != undefined) {
                            data.effectiveDate = data.effectiveDate + " 00:00:00";
                        }
                        if (data.expireDate != "" && data.effectiveDate != undefined) {
                            data.expireDate = data.expireDate + " 23:59:59";
                        }

                        //审批方式
                        var regulationAuditType = $("input[name=regulationAuditType]:checked").val();

                        var auditFlag = $("input[name=auditFlag]:checked").val();
                        if (data.regulationId) {
                            if (regulationAuditType == 1 && (data.meetingTypeName == '请选择' || data.meetingTypeName == '')) {
                                layer.alert("审批方式为【会议】时,会议类型不能为空!");
                                return false;
                            }
                            if (regulationAuditType == 2 && !data.auditReportFileName) {
                                layer.alert("审批方式为【签报】时,附件不能为空!");
                                return false;
                            }
                            if (auditFlag == 1 && !data.auditFlagFileName) {
                                layer.alert("法律审核为【是】时,附件不能为空!");
                                return false;
                            }
                        }
                        // if(regulationAuditType==1){
                        //     data.auditReportFileId = "";
                        //     data.auditReportFileName="";
                        //     data.meetingTypeId = $("#meetingTypes").val();
                        //     data.meetingTypeName = $("select[name=meetingTypeName]").find("[value='" + data.meetingTypeId + "']").text();
                        //     if(data.meetingTypeName=='请选择'){
                        //     	data.meetingTypeName='';
                        //     }
                        // }else if(regulationAuditType==2){
                        //     data.auditReportFileId = $("input[name=auditReportFileId]").val();
                        //     data.auditReportFileName = $("input[name=auditReportFileName]").val();
                        //     data.meetingTypeName="";
                        //     data.meetingTypeId="";
                        // }
                        if (auditFlag == 0) {
                            data.auditFlagFileId = "";
                            data.auditFlagFileName = "";
                        } else {
                            data.auditFlagFileId = $("input[name=auditFlagFileId]").val();
                            data.auditFlagFileName = $("input[name=auditFlagFileName]").val();
                        }
                        data['isSubmit'] = '1'
                        layerLoader = common.layerLoader();

                        common.fetchPost(sURL, data, function (result) {
                            $("input[name=regulationId]").val(result.object.regulationId);
                            //eleTreeHandle.getHistoryRegulation(result);
                            layer.close(layerLoader);
                            layer.msg("提交成功");
                            eleTreeHandle.render();
                            $("#meetingTypes").removeAttr('disabled')
                            uploadApprovalWayFile();
                            uploadLawFile();

                        }, function (result) {
                            layer.close(layerLoader);
                            layer.msg(result.resultMessage);
                        });
                        return false;
                    });

                    $(".btnClose").on("click", function () {
                        //window.parent.location.reload("table1");
                        parent.document.getElementById("refreshTable").click();
                        parent.layer.closeAll();
                    });

                    if ($("input[name=regulationId]").val() != "") {
                        //$("#regulationVoteDiv").removeClass("hide");
                        $("#regulationTextDiv").removeClass("hide");
                        $("#regulationHisDiv").removeClass("hide");
                    }

                    //制度文本工具栏按钮绑定事件
                    table.on("toolbar(regulationTextTable)", function (obj) {
                        switch (obj.event) {
                            case "add":
                                if (regulationId) {
                                    regulationTextLayer = layer.open({
                                        type: 1,
                                        content: $("#regulationText-add").html(),
                                        area: ["800px", "430px"],
                                        success: function (obj1) {
                                            var parent = $(obj1.selector);
                                            common.selectDataSet({
                                                elem: $("select[name=regulationType]"),
                                                url: "sysmgr/dicts/selectDictListByPcode?dictPCode=REGULATION_TEXT_TYPE",
                                                responseList: "list",
                                                method: "get",
                                                optionText: "sdName",
                                                optionValue: "sdCode"
                                            });

                                            parent.find('.btnClose').off().on('click', function () {
                                                layer.close(regulationTextLayer);
                                            });

                                            form.on("submit(saveRegulationText)", function (obj) {
                                                var data = obj.field;
                                                data.regulationId = regulationId;
                                                //保存表决方式
                                                // var sURL = "rulemgr/regulationText/save";
                                                // if($("input[name='textId']").val() != ""){
                                                //     sURL = "rulemgr/regulationText/update";
                                                // }

                                                // common.fetchPost(sURL, data, function(obj){
                                                // $("input[name='textId']").val(obj.object.textId);
                                                $("input[name='uploadTime']").val(util.toDateString(new Date()), 'yyyy-MM-dd HH:mm:ss');
                                                //重新设置资源ID
                                                // var fiFileType=$("select[name=regulationType]").val();
                                                // fileUpload.config.data = { "resId": data.regulationId,"fiFileType":fiFileType};
                                                fileUpload.config.data.resId = data.regulationId;
                                                fileUpload.config.data.fiFileType = data.regulationType;
                                                fileUpload.config.data.fname = obj.field.fileName;
                                                fileUpload.config.data.memo = obj.field.ggMemo;
                                                // fileUpload.config.data.memo = obj.field.ggMemo;
                                                //执行上传
                                                fileUpload.upload();
                                                //table.reload("regulationTextTable");
                                                //layer.close(regulationVoteLayer);
                                                // });
                                                return false;
                                            });

                                            // $(".btnClose").on("click", function(){
                                            //     layer
                                            // });

                                            form.on("select(regulationType)", function (obj) {
                                                $("input[name=typeCode]").val(obj.value);
                                                $("input[name=typeName]").val($(obj.elem).find("option:checked").text());
                                            });

                                            fileUpload = upload.render({
                                                elem: '#uploadFile',
                                                url: baseUrl + 'zuul/dfsmgr/file/fileUpload',
                                                auto: false,
                                                bindAction: "#saveRegulationTextFile",
                                                data: {
                                                    fname: function () {
                                                        return parent.find("input[name=fileName]").val()
                                                    },
                                                    memo: function () {
                                                        return parent.find('[name=ggMemo]').val()
                                                    }
                                                },
                                                accept: 'file',
                                                // acceptMime:"",
                                                size: '102400',
                                                choose: function (obj) {
                                                    obj.preview(function (index, file, result) {
                                                        parent.find("#fileNameArea").show();
                                                        var arr = file.name.split('.');

                                                        if (file.name.split('.').length > 2) {
                                                            var fileName = '';
                                                            $.map(arr, function (item, index) {
                                                                if (index !== (arr.length - 1)) {
                                                                    fileName += item;
                                                                }
                                                            });
                                                            parent.find("input[name=fileName]").val(fileName);
                                                        } else {
                                                            parent.find("input[name=fileName]").val(file.name.split('.')[0]);
                                                        }

                                                        parent.find("input[name=fileType]").val('.' + arr[arr.length - 1]);
                                                    });

                                                },
                                                before: function () {
                                                    layerLoader = common.layerLoader();
                                                },
                                                done: function (res, index, upload) {
                                                    //;
                                                    layer.close(layerLoader);
                                                    var sURL = "rulemgr/regulationText/update";
                                                    var data = {};
                                                    data.textId = $("input[name='textId']").val();
                                                    data.fileId = res.list[0].fiId;
                                                    data.fileName = res.list[0].fiName + "." + res.list[0].fiSuffix;
                                                    data.regulationId = $("input[name='regulationId']").val();
                                                    data.typeName = $("input[name='typeName']").val();
                                                    data.typeCode = $("input[name='typeCode']").val();
                                                    data.uploadTime = $("input[name='uploadTime']").val();
                                                    common.fetchPost(sURL, data, function (res) {
                                                        table.reload("regulationTextTable");
                                                        layer.close(regulationTextLayer);
                                                    });
                                                }
                                            });

                                            form.render("select");


                                        }
                                    });
                                } else {
                                    layer.msg('请先保存制度');
                                }

                                break;
                            case "delete":
                                var checkStatus = table.checkStatus(obj.config.id);
                                if (checkStatus.data.length > 0) {
                                    var confirmLayer = layer.confirm("确定删除选中行?", {
                                        btn: ['<i class="fa fa-check-circle"></i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                    },
                                        function (index, layero) {
                                            var sURL = "dfsmgr/file/deleteById?id=";
                                            var ids = [];
                                            for (var i = 0; i < checkStatus.data.length; i++) {
                                                ids.push(checkStatus.data[i].fiId);
                                            }

                                            common.fetchDelete(sURL + ids.join(","), function (res) {
                                                if (res.success) {
                                                    table.reload("regulationTextTable");
                                                    layer.msg("删除成功");
                                                    layer.close(confirmLayer);
                                                } else {
                                                    layer.alert(res.resultMessage);
                                                }
                                            });
                                        });
                                } else {
                                    layer.msg("请选择至少一行");
                                }
                                break;
                        }
                    });

                    //制度文本表格操作事件
                    table.on("tool(regulationTextTable)", function (obj) {
                        //;
                        switch (obj.event) {
                            case "edit":
                                var regulationTextLayer = layer.open({
                                    type: 1,
                                    content: $("#regulationText-add").html(),
                                    area: ["800px", "430px"],
                                    success: function (obj1) {
                                        var parent = $(obj1.selector);
                                        common.selectDataSet({
                                            elem: $("select[name=regulationType]"),
                                            url: "sysmgr/dicts/selectDictListByPcode?dictPCode=REGULATION_TEXT_TYPE",
                                            responseList: "list",
                                            method: "get",
                                            optionText: "sdName",
                                            optionValue: "sdCode"
                                        });

                                        form.on("submit(saveRegulationText)", function (obj) {
                                            var data = obj.field;
                                            var hasFile = obj.field.file;
                                            data.regulationId = $("input[name=regulationId]").val();
                                            //保存表决方式
                                            var sURL = "rulemgr/regulationText/update";
                                            layerLoader = common.layerLoader();
                                            common.fetchPost(sURL, data, function (obj) {
                                                $("input[name='uploadTime']").val(util.toDateString(new Date()), 'yyyy-MM-dd HH:mm:ss');
                                                if (hasFile) {
                                                    //重新设置资源ID
                                                    // var fiFileType=$("select[name=regulationType]").val();
                                                    // fileUpload.config.data = { "resId": data.regulationId,"fiFileType":fiFileType};

                                                    fileUpload.config.data.resId = data.regulationId;
                                                    fileUpload.config.data.fiFileType = data.regulationType;
                                                    fileUpload.config.data.fname = data.fileName;
                                                    fileUpload.config.data.memo = data.ggMemo;
                                                    //执行上传
                                                    fileUpload.upload();
                                                } else {
                                                    table.reload("regulationTextTable");
                                                    layer.close(regulationTextLayer);
                                                }
                                                layer.close(layerLoader);
                                            });

                                            return false;
                                        });

                                        $(".btnClose").on("click", function () {
                                            parent.layer.closeAll();
                                        });

                                        form.on("select(regulationType)", function (obj) {
                                            $("input[name=typeCode]").val(obj.value);
                                            $("input[name=typeName]").val($(obj.elem).find("option:checked").text());
                                        });

                                        fileUpload = upload.render({
                                            elem: '#uploadFile',
                                            url: baseUrl + 'zuul/dfsmgr/file/fileUpload',
                                            auto: false,
                                            bindAction: "#saveRegulationTextFile",
                                            data: {
                                                fname: function () {
                                                    return parent.find("input[name=fileName]").val()
                                                },
                                                memo: function () {
                                                    return parent.find('[name=ggMemo]').val()
                                                }
                                            },
                                            accept: 'file',
                                            choose: function (obj) {
                                                obj.preview(function (index, file, result) {
                                                    parent.find("#fileNameArea").show();
                                                    var arr = file.name.split('.');

                                                    if (file.name.split('.').length > 2) {
                                                        var fileName = '';
                                                        $.map(arr, function (item, index) {
                                                            if (index !== (arr.length - 1)) {
                                                                fileName += item;
                                                            }
                                                        });
                                                        parent.find("input[name=fileName]").val(fileName);
                                                    } else {
                                                        parent.find("input[name=fileName]").val(file.name.split('.')[0]);
                                                    }

                                                    parent.find("input[name=fileType]").val('.' + arr[arr.length - 1]);
                                                });
                                            },
                                            done: function (res, index, upload) {

                                                var sURL = "rulemgr/regulationText/update";
                                                var data = {};
                                                data.textId = $("input[name='textId']").val();
                                                data.fileId = res.list[0].fiId;
                                                data.fileName = res.list[0].fiName + "." + res.list[0].fiSuffix;
                                                data.regulationId = $("input[name='regulationId']").val();
                                                data.typeName = $("input[name='typeName']").val();
                                                data.typeCode = $("input[name='typeCode']").val();
                                                data.uploadTime = $("input[name='uploadTime']").val();
                                                common.fetchPost(sURL, data, function (res) {
                                                    table.reload("regulationTextTable");
                                                    layer.close(regulationTextLayer);
                                                });
                                            }
                                        });

                                        form.val("regulationText-add", obj.data);
                                        $("select[name=regulationType]").val(obj.data.typeCode);
                                        form.render("select");
                                    }
                                });
                                break;
                            case "delete":
                                var textId = obj.data.textId;
                                var sURL = "rulemgr/regulationText/delete?ids=";
                                var confirmLayer = layer.confirm("确定删除选中行?", {
                                    btn: ['<i class="fa fa-check-circle"></i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                },
                                    function (index, layero) {
                                        var sURL = "rulemgr/regulationText/delete?ids=";
                                        common.fetchDelete(sURL + textId, function (res) {
                                            if (res.success) {
                                                table.reload("regulationTextTable");
                                                layer.msg("删除成功");
                                                layer.close(confirmLayer);
                                            } else {
                                                layer.alert(res.resultMessage);
                                            }
                                        });
                                    });
                                break;
                            case "download":
                                var sURL = baseUrl + "dfsmgr/file/filesDownload?fid=" + obj.data.fiId;
                                window.location.href = sURL;
                                break;
                            case "upFile":

                                if (!fileSortData[common.arrayIndexOf(fileSortData, 'fiId', obj.data.fiId) - 1]) {
                                    layer.msg('无法上移');
                                    return false;
                                }


                                var upFileLayer = layer.confirm("确定上移文件?", {
                                    btn: ['<i class="fa fa-check-circle"></i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                }, function (index, layero) {
                                    $.when(
                                        common.fetchPost("dfsmgr/file/updateFileInfo", {
                                            fiId: obj.data.fiId,
                                            ggSort: obj.data.ggSort - 1
                                        }),//当前条
                                        common.fetchPost("dfsmgr/file/updateFileInfo", {
                                            fiId: fileSortData[common.arrayIndexOf(fileSortData, 'fiId', obj.data.fiId) - 1].fiId,
                                            ggSort: fileSortData[common.arrayIndexOf(fileSortData, 'fiId', obj.data.fiId) - 1].ggSort + 1
                                        })//上一条
                                    ).done(function (res1, res2) {
                                        if (res1.success && res2.success) {
                                            table.reload("regulationTextTable");
                                            layer.msg("上移成功");
                                            layer.close(upFileLayer);
                                        } else {
                                            layer.msg('上移失败');
                                        }
                                    });
                                });
                                break;
                            case "downFile":
                                if (!fileSortData[common.arrayIndexOf(fileSortData, 'fiId', obj.data.fiId) + 1]) {
                                    layer.msg('无法下移');
                                    return false;
                                }
                                var downFileLayer = layer.confirm("确定下移文件?", {
                                    btn: ['<i class="fa fa-check-circle"></i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                }, function (index, layero) {
                                    $.when(
                                        common.fetchPost("dfsmgr/file/updateFileInfo", {
                                            fiId: obj.data.fiId,
                                            ggSort: obj.data.ggSort + 1
                                        }),//当前条
                                        common.fetchPost("dfsmgr/file/updateFileInfo", {
                                            fiId: fileSortData[common.arrayIndexOf(fileSortData, 'fiId', obj.data.fiId) + 1].fiId,
                                            ggSort: fileSortData[common.arrayIndexOf(fileSortData, 'fiId', obj.data.fiId) + 1].ggSort - 1
                                        })//下一条
                                    ).done(function (res1, res2) {
                                        if (res1.success && res2.success) {
                                            table.reload("regulationTextTable");
                                            layer.msg("下移成功");
                                            layer.close(downFileLayer);
                                        } else {
                                            layer.msg('下移失败');
                                        }
                                    });
                                });
                                break;
                        }
                    });

                    $("#btnRelationRegulation").unbind('click').bind("click", function (e) {
                        var relationRegulationLayer = layer.open({
                            type: 1,
                            title: "选择关联制度",
                            area: ["1200px", "700px"],
                            content: $("#relationRegulationForm").html(),
                            success: function () {
                                table.render(common.tableInitParams({
                                    elem: '#relationRegulationTable',
                                    url: baseUrl + 'rulemgr/regulation/listHis',
                                    where: {
                                        "selfRegulationId": $("input[name=regulationId]").val(),
                                        "regulationTypeId": $("input[name=regulationTypeId]").val()
                                    },
                                    height: 490,
                                    cols: [
                                        [
                                            { type: 'checkbox' },
                                            { type: 'numbers', title: '序号' },
                                            { field: 'regulationName', title: '制度名称' },
                                            { field: 'regulationTypeName', title: '制度类型' },
                                            {
                                                field: 'implementDate', title: '实施日期'
                                                , templet: function (rowData) { return util.toDateString(rowData.implementDate, 'yyyy-MM-dd'); }
                                            },
                                            { field: 'formulateDept', title: '制定部门' }
                                        ]
                                    ]
                                }));

                                $("#btnConfirmRegulation").on("click", function (e) {
                                    var checkStatus = table.checkStatus("relationRegulationTable");
                                    if (checkStatus.data.length > 1) {
                                        layer.msg("只允许选择一个制度信息");
                                        return;
                                    }
                                    if (checkStatus.data.length == 0) {
                                        layer.msg("请选择");
                                        return;
                                    }
                                    $("input[name=regulationPid]").val(checkStatus.data[0].regulationId);
                                    $("input[name=regulationPname]").val(checkStatus.data[0].regulationName);
                                    layer.close(relationRegulationLayer);
                                });

                                //关闭窗口
                                $(".btnClose").on("click", function () {
                                    layer.close(relationRegulationLayer);
                                });
                            }
                        })
                        e.stopPropagation();
                        return false;
                    });
                },
                ysgzTableInit: function () {
                    // 议事规则表格渲染
                    table.render(common.tableInitParams({

                        elem: '#YsgzTable',
                        url: baseUrl + 'rulemgr/regulationVote/list',
                        where: { 'regulationId': $("input[name=regulationId]").val() },
                        method: 'post',
                        toolbar: '#ysgzToolbar',
                        height: 'full-300',
                        cols: [[
                            { type: 'checkbox' },
                            { type: 'numbers', title: '序号' },
                            { field: 'billName', title: '决议类别', sort: true },
                            { field: 'modeName', title: '表决规则', sort: true },
                            { field: 'considerResult', title: '审议结果', sort: true },
                            { title: '操作', toolbar: '#ysgzOper', fixed: 'right', width: 150 }
                        ]],
                        done: function (data) {
                            function getSelectOption(parent) {
                                common.fetchGet('sysmgr/dicts/selectDictListByPcode?dictPCode=resultType', function (data) {
                                    var optionHtml = '<option value="">请选择</option>'
                                    for (var i = 0; i < data.list.length; i++) {
                                        optionHtml += '<option value="' + data.list[i].sdId + '">' + data.list[i].sdName + '</option>'
                                    }

                                    parent.find('#regulationType1').html(optionHtml)
                                    form.render()
                                }, false, false);
                                common.fetchGet('rulemgr/regulationVoteAlias/getAll', function (data) {
                                    var optionHtml = '<option value="">请选择</option>'
                                    for (var i = 0; i < data.list.length; i++) {
                                        optionHtml += '<option value="' + data.list[i].aliasModeId + '">' + data.list[i].aliasName + '</option>'
                                    }

                                    parent.find('#regulationType2').html(optionHtml)
                                    form.render()
                                }, false, false);
                                common.fetchGet('sysmgr/dicts/selectDictListByPcode?dictPCode=PASSFLAG', function (data) {
                                    var optionHtml = '<option value="">请选择</option>'
                                    for (var i = 0; i < data.list.length; i++) {
                                        optionHtml += '<option value="' + data.list[i].sdId + '">' + data.list[i].sdName + '</option>'
                                    }

                                    parent.find('#regulationType3').html(optionHtml)
                                    form.render()
                                }, false, false);


                            }
                            table.on("toolbar(YsgzTable)", function (obj) {
                                switch (obj.event) {
                                    case 'add':
                                        var ysgzLayer = layer.open({
                                            title: "新增",
                                            type: 1,
                                            content: $("#ysgz-add").html(),
                                            area: ["800px", "370px"],
                                            success: function (obj1) {
                                                // 获取议事规则select选项

                                                getSelectOption($(obj1.selector))

                                                // 新增确定
                                                form.on("submit(ysgzAddSure)", function (obj) {
                                                    var field = obj.field
                                                    field['billName'] = $('#regulationType1').find("option:selected").text();

                                                    field['modeName'] = $('#regulationType2').find("option:selected").text();
                                                    field['considerResult'] = $('#regulationType3').find("option:selected").text();
                                                    field['regulationId'] = $("input[name=regulationId]").val();


                                                    common.fetchPost('rulemgr/regulationVote/save', field, function (res) {
                                                        table.reload("YsgzTable");
                                                    }, function (err) {
                                                        layer.alert(err.resultMessage);
                                                    })

                                                    layer.close(ysgzLayer);
                                                })

                                                // 监听关闭按钮
                                                $('.ysgzBtnClose').on('click', function () {
                                                    layer.close(ysgzLayer);
                                                });
                                            }
                                        })
                                        form.render('select')
                                        break;
                                    case 'delete':
                                        var checkStatus = table.checkStatus(obj.config.id), data = checkStatus.data; //获取选中的数据
                                        if (checkStatus.data.length > 0) {
                                            layer.confirm('确定删除?', { icon: 3, title: '提示', offset: '150px' }, function (index) {
                                                var ids = [];

                                                for (var i = 0; i < checkStatus.data.length; i++) {
                                                    ids.push(checkStatus.data[i]['voteId'])
                                                }
                                                var layerLoader = common.layerLoader();
                                                common.fetchDelete('rulemgr/regulationVote/delete?ids=' + ids.join(','), function (res) {
                                                    if (res.resultCode == 0) {
                                                        layer.close(layerLoader);
                                                        table.reload("YsgzTable");
                                                        layer.msg('删除成功');
                                                    } else {
                                                        layer.alert(res.resultMessage);
                                                    }
                                                }, function (res) {
                                                    layer.msg('删除失败');
                                                    layer.close(layerLoader);
                                                });

                                                layer.close(index);
                                            });
                                        } else {
                                            layer.msg('请选择删除列')
                                        }
                                        break;

                                }
                            })
                            table.on("tool(YsgzTable)", function (obj) {
                                switch (obj.event) {
                                    case 'edit':
                                        var ysgzLayer = layer.open({
                                            title: "编辑",
                                            type: 1,
                                            content: $("#ysgz-add").html(),
                                            area: ["800px", "400px"],
                                            success: function (obj1) {
                                                getSelectOption($(obj1.selector))
                                                form.render('select')
                                                // 渲染表格
                                                form.val("formEdit", obj.data);
                                                // 编辑确定
                                                form.on("submit(ysgzAddSure)", function (obj2) {
                                                    var field = obj2.field
                                                    field['billName'] = $('#regulationType1').find("option:selected").text();
                                                    field['modeName'] = $('#regulationType2').find("option:selected").text();
                                                    field['considerResult'] = $('#regulationType3').find("option:selected").text();
                                                    field['regulationId'] = $("input[name=regulationId]").val();
                                                    field['voteId'] = obj.data['voteId']


                                                    common.fetchPost('rulemgr/regulationVote/update', field, function (res) {
                                                        table.reload("YsgzTable");
                                                        layer.msg('修改成功');
                                                    }, function (err) {
                                                        layer.alert(err.resultMessage);
                                                    })

                                                    layer.close(ysgzLayer);
                                                })

                                                // 监听关闭按钮
                                                $('.ysgzBtnClose').on('click', function () {
                                                    layer.close(ysgzLayer);
                                                });
                                            }
                                        })
                                        break;
                                }
                            })
                        }
                    }))
                },

                //获取所有历史版本信息
                getHistoryRegulation: function (res) {
                    var pid = res.object.regulationPid;
                    var sHisURL = "rulemgr/regulation/getRegulationHistoryList?regulationPid=" + pid;
                    common.fetchGet(sHisURL, function (res) {
                        var str = "";
                        for (var i = 0; i < res.list.length; i++) {
                            var obj = res.list[i];
                            var markNumber = obj.markNumber != null ? obj.markNumber : "";
                            str += "<li class='layui-timeline-item'>";
                            str += "    <i class='layui-icon layui-timeline-axis'></i>";
                            str += "    <div class='layui-timeline-content layui-text'>";
                            str += "        <h3 class='layui-timeline-title'>" + obj.regulationName + "</h3>";
                            str += "        <p>";
                            str += "            " + markNumber + " / " + (obj.valid == 1 ? "生效" : "失效") + " / " + obj.signDate + "发布 /" + obj.implementDate + "实施";
                            str += "        </p>";
                            str += "    </div>";
                            str += "    <button class='layui-btn layui-btn-radius right-btn history-check' regulationHisId=" + obj.regulationId + ">查看</button>";
                            str += "</li>";
                            if (obj.regulationId == pid) {
                                $("input[name=regulationPid]").val(obj.regulationId);
                                $("input[name=regulationPname]").val(obj.regulationName);
                            }
                        }
                        $("#regulationHisList").empty();
                        $("#regulationHisList").append(str);

                        $(".history-check").on("click", function (e) {
                            var regulationHisId = $(e.target).attr("regulationHisId");

                            var sURL = "rulemgr/regulation/selectFilePage";
                            var data = { "resId": regulationHisId, "sdPcode": "REGULATION_TEXT_TYPE" };
                            common.fetchPost(sURL, data, function (res) {
                                var regulationHisList = res.page.list;
                                var strHtml = "";
                                for (var i = 0; i < regulationHisList.length; i++) {
                                    var regulationHis = regulationHisList[i];
                                    strHtml += "<div class='layui-col-md12'>";
                                    strHtml += "    <div class='layui-form-item'>";
                                    strHtml += "        <label class='layui-form-label hylabel'>" + regulationHis.sdName + ":</label>";
                                    strHtml += "        <div class='layui-input-block'>";
                                    strHtml += "            <input autocomplete='off' class='layui-input hyinput' placeholder='请输入' type='text' readonly value='" + regulationHis.fiOriginalName + "'>";
                                    strHtml += "        </div>";
                                    strHtml += "    </div>";
                                    strHtml += "</div>";
                                }

                                regulationHisLayer = layer.open({
                                    type: 1,
                                    area: ["800px", "400px"],
                                    content: $("#regulationHis").html(),
                                    success: function () {
                                        $("div[name=regulationHisList]").append(strHtml);

                                        $(".btnClose").on("click", function () {
                                            layer.close(regulationHisLayer);
                                            return false;
                                        });
                                    }
                                });
                            });
                        });
                    });
                },
                renderViewMode: function () {
                    var view = common.getQueryVariable("view");
                    if (view == "view") {
                        $("button").addClass("hide");
                        $("input,select,textarea").attr("disabled", "disabled");
                        $(".viewHiden").addClass("hide");
                        $(".viewShow").removeClass("hide");

                    }
                },
                domListen: function () {

                }
            }

            var reg = /^\s*$/;
            form.verify({
                regulationName: function (value, item) {
                    if (reg.test(value)) {
                        return "制度名称不能为空!";
                    }
                },
                formulateDept: function (value, item) {
                    if (reg.test(value)) {
                        return "制定部门不能为空!";
                    }
                },
                regulationTypeName: function (value, item) {
                    if (reg.test(value)) {
                        return "制度类别不能为空!";
                    }
                },
                signDate: function (value, item) {
                    if (reg.test(value)) {
                        return "审批日期不能为空!";
                    }
                },
                implementDate: function (value, item) {
                    if (reg.test(value)) {
                        return "实施日期不能为空!";
                    }
                },
                // expireDate: function(value,item){
                // 	if(reg.test(value)){
                // 		return "失效日期不能为空!";
                // 	}
                // },
                effectiveDate: function (value, item) {
                    if (reg.test(value)) {
                        return "生效日期不能为空!";
                    }
                }
            });


            // eleTreeHandle.render();
            //判断当前查看模式
            // eleTreeHandle.renderViewMode();


        });

    </script>

    <!--[if lt IE 9]>

<script src="../../js/lib/html5.min.js"></script>
<script src="../../js/lib/respond.js"></script>
<![endif]-->
</body>

</html>