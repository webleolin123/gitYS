<!DOCTYPE html>
<html class="iframe-h">

<head>
    <meta charset="UTF-8">
    <title>议案管理-新增/编辑</title>
    <meta content="webkit" name="renderer" />
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link class="favicon" href=" ./../../../images/ico/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link class="favicon" href=" ./../../../images/ico/favicon.ico" rel="icon" type="image/x-icon">
    <link class="favicon" href=" ./../../../images/ico/favicon.ico" rel="bookmark" type="image/x-icon">
    <link rel="stylesheet" href="../../../js/layui/css/layui.css" />
    <link href="../../../css/public.css?v1.01" rel="stylesheet" />
    <link href="../../../js/lib/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <script src="../../../js/lib/jquery.1.12.3.js"></script>
    <style>
        .hytitle {
            font-size: 16px;
        }

        .hylabel {
            border: 1px solid transparent !important;
            background: transparent !important;
        }

        .hyinput {
            border: 1px solid transparent !important;
            border-bottom-color: red !important;
        }

        .layui-unselect {
            border-color: #f56c6c;
            border-top-style: none;
            border-right-style: none;
            border-left-style: none;
        }

        .layui-table-cell .layui-unselect {
            border-color: #d2d2d2;
        }

        .layui-form-select .layui-edge {
            border-top-color: #f56c6c;
        }

        body {
            background: #f8f8f8;
        }

        .load-btn,
        .upload-btn,
        .check-btn,
        .right-btn {
            position: absolute;
            top: 0;
            right: 0;
            border-radius: 3px;
        }

        .right140 {
            /*right: 140px;*/
            right: 70px;
        }

        .right70 {
            right: 70px;
        }

        .relative {
            position: relative;
        }

        .padRt64 {
            padding-right: 64px;
        }

        li {
            cursor: pointer;
        }

        .zsBga {
            color: purple;
            vertical-align: 1px;
            opacity: 0.5;
            font-weight: normal;
        }

        .blueBg {
            padding: 5px;
            background: blue;
            opacity: 0.5;
            color: #fff;
        }

        .grayBg {
            padding: 5px;
            background: gray;
            opacity: 0.5;
            color: #fff;
        }

        .bg-gray {
            background-color: #FFB800 !important;
            color: black !important;
        }

        .eleTree.ele5,
        .eleTree.ele6 {
            height: auto;
            max-height: 240px;
            width: 100%;
            display: none;
            position: absolute;
            top: 100%;
            background-color: #fff;
            z-index: 100;
            border: 1px solid #ccc;
        }

        a.layui-layer-ico.layui-layer-max {
            display: none;
        }

        a.layui-layer-ico.layui-layer-max.layui-layer-maxmin {
            display: inline-block !important;
        }
    </style>
    <style>
        /* 表格工具位置样式重置 */
        .layui-table-tool-temp {
            padding-right: 0 !important;
        }

        .versionLabel {
            text-align: left;
            margin-top: 40px;
            padding-left: 20px;
        }
    </style>
    <style>
        .layui-table-body,
        .layui-table-body .layui-none {
            border-bottom: 1px solid #e6e6e6;
        }

        .layui-colla-content {
            padding-top: 0;
        }

        /* 统一图标尺寸 */
        .layui-btn .layui-icon {
            font-size: 12px !important;
        }
    </style>
    <style>
        /* .meetingTypeFlowUl{
            text-align: left;
        } */
        .meetingTypeFlowUl li {
            background-color: #D30001;
            color: white;
            position: relative;
            border: 1px solid #dfdfdf;
            display: inline-block;
            padding: 10px;
            /* width: 31%;
            margin-right: 1%; */
            cursor: pointer;
            list-style: none;
            font-weight: bolder;
        }

        .meetingTypeFlowUl li div {
            text-align: center
        }

        .hideClass {
            display: none !important;
        }
    </style>
</head>

<body class="iframe-h">

    <script type="text/html" id="meeting-file">
    <table id="meetingFile" lay-filter="meetingFile"></table>
</script>

    <!--列席人员选择-->
    <div class="set-attendanceForm hide">
        <div class="layui-card-body">
            <table id="attendanceTable" lay-filter="attendanceTable"></table>
            <script type="text/html" id="attendanceToolBar">
                <div class="layui-btn-container">
                    <button class="layui-btn layui-btn-sm" permission-btn="meetingMgrAttendanceAdd" lay-event="add">
                        <i class="layui-icon">&#xe608;</i> 新增
                    </button>
                    <button class="layui-btn layui-btn-sm  layui-btn-danger" permission-btn="meetingMgrAttendanceDel" lay-event="del">
                        <i class="layui-icon">&#xe640;</i> 删除
                    </button>
                </div>
            </script>
        </div>
    </div>
    <!--出席人员选择-->
    <div class="set-attendeeForm hide">
        <div class="layui-card-body">
            <table id="attendeeTable" lay-filter="attendeeTable"></table>
            <script type="text/html" id="attendeeToolBar">
            <div class="layui-btn-container">
                <button class="layui-btn layui-btn-sm" permission-btn="meetingMgrAttendeeAdd" lay-event="add">
                    <i class="layui-icon">&#xe608;</i> 新增
                </button>
                <button class="layui-btn layui-btn-sm  layui-btn-danger" permission-btn="meetingMgrAttendeeDel" lay-event="del">
                    <i class="layui-icon">&#xe640;</i> 删除
                </button>
                <button class="layui-btn layui-btn-sm" permission-btn="meetingMgrAttendeeChoose" lay-event="choose">
                    <i class="layui-icon">&#xe640;</i> 选择
                </button>
            </div>
        </script>
            <script type="text/html" id="attendeeTableOper">
            <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        </script>
        </div>
    </div>
    <!--汇报人员选择-添加-->
    <div class="setAdd-attendeeForm hide">
        <div class="layui-card-body">
            <form class="layui-form layui-form-pane" name="setAdd-attendeeForm">
                <input type="hidden" name="attendanceId" class="layui-input hyinput">
                <input type="hidden" name="subjectId">
                <div class="layui-row layui-col-space15">
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel"><b class="red">*</b>人员姓名</label>
                            <div class="layui-input-block">
                                <input type="text" id="attendanceName" required name="attendanceName" placeholder="请输入"
                                    autocomplete="off" class="layui-input hyinput">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel"><b class="red">*</b>职务名称</label>
                            <div class="layui-input-block">
                                <input type="text" id="positionName" required name="positionName" placeholder="请输入"
                                    autocomplete="off" class="layui-input hyinput">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel"><b class="red">*</b>人员排序</label>
                            <div class="layui-input-block">
                                <input type="number" name="ggSort"
                                    oninput="if( this.value.length > 22 )  this.value = this.value.slice(0,22)" required
                                    placeholder="请输入" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">备注</label>
                            <div class="layui-input-block">
                                <textarea name="remark" id="remark" placeholder="请输入"
                                    class="layui-textarea hyinput"></textarea>
                            </div>
                        </div>
                    </div>
                    <div style="display: none">
                        <div class="layui-card" style="margin-top: 10px">
                            <div class="layui-card-body">
                                <div class="layui-form-item" style="text-align: center;">
                                    <button class="layui-btn" lay-submit lay-filter="formAttendanceAdd"><i
                                            class="fa fa-check-circle"></i>确定</button>
                                    <button class="layui-btn" id="formAttendanceAddClose"><i
                                            class="icon iconfont icon-button-cha-2"
                                            style="margin-right: 3px"></i>关闭</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!--缺席人员选择-->
    <div class="set-absentForm hide">
        <div class="layui-card-body">
            <table id="absentTable" lay-filter="absentTable"></table>
            <script type="text/html" id="absentToolBar">
            <div class="layui-btn-container">
                <button class="layui-btn layui-btn-sm" permission-btn="meetingMgrAttendeeAdd" lay-event="add">
                    <i class="layui-icon">&#xe608;</i> 新增
                </button>
                <button class="layui-btn layui-btn-sm  layui-btn-danger" permission-btn="meetingMgrAttendeeDel" lay-event="del">
                    <i class="layui-icon">&#xe640;</i> 删除
                </button>
                <button class="layui-btn layui-btn-sm" permission-btn="meetingMgrAttendeeChoose" lay-event="choose">
                    <i class="layui-icon">&#xe640;</i> 选择
                </button>
            </div>
        </script>
            <script type="text/html" id="absentTableOper">
            <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        </script>
        </div>
    </div>
    <!--缺席人员选择-添加-->
    <div class="setAdd-absentForm hide">
        <div class="layui-card-body">
            <form class="layui-form layui-form-pane" name="setAdd-absentForm">
                <input type="hidden" name="attendeeId" class="layui-input hyinput">
                <div class="layui-row layui-col-space15">
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">缺席人</label>
                            <div class="layui-input-block">
                                <input type="text" name="attendeeName" placeholder="请输入" autocomplete="off"
                                    class="layui-input hyinput">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">缺席原因</label>
                            <div class="layui-input-block">
                                <input type="text" name="reason" placeholder="请输入" autocomplete="off"
                                    class="layui-input hyinput">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">委托人</label>
                            <div class="layui-input-block">
                                <input type="text" name="assignor" placeholder="请输入" autocomplete="off"
                                    class="layui-input hyinput">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">备注</label>
                            <div class="layui-input-block">
                                <textarea name="remark" placeholder="请输入" class="layui-textarea hyinput"></textarea>
                            </div>
                        </div>
                    </div>
                    <div style="display: none">
                        <div class="layui-card" style="margin-top: 10px">
                            <div class="layui-card-body">
                                <div class="layui-form-item" style="text-align: center;">
                                    <button class="layui-btn" lay-submit lay-filter="formAbsentAdd"> <i
                                            class="layui-icon">&#x1005;</i>保存</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!--常设列席选择-->
    <div class="set-attenderForm hide">
        <div class="layui-card-body">
            <table id="attenderTable" lay-filter="attenderTable"></table>
            <script type="text/html" id="attenderToolBar">
            <div class="layui-btn-container">
                <button class="layui-btn layui-btn-sm" permission-btn="meetingMgrAttenderAdd" lay-event="add">
                    <i class="layui-icon">&#xe608;</i> 新增
                </button>
                <button class="layui-btn layui-btn-sm  layui-btn-danger" permission-btn="meetingMgrAttenderDel" lay-event="del">
                    <i class="layui-icon">&#xe640;</i> 删除
                </button>
                <button class="layui-btn layui-btn-sm" permission-btn="meetingMgrAttenderChoose" lay-event="choose">
                    <i class="layui-icon">&#xe640;</i> 选择
                </button>
            </div>
        </script>
            <script type="text/html" id="attenderTableOper">
            <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        </script>
        </div>
    </div>
    <!--常设列席选择-添加-->
    <div class="setAdd-attenderForm hide">
        <div class="layui-card-body">
            <form class="layui-form layui-form-pane" name="setAdd-attenderForm">
                <input type="hidden" name="attenderId" class="layui-input hyinput">
                <div class="layui-row layui-col-space15">
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">常设列席人</label>
                            <div class="layui-input-block">
                                <input type="text" id="attenderSuName" name="attenderSuName" placeholder="请输入"
                                    autocomplete="off" class="layui-input hyinput">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md12">
                        <div class="layui-form-item">
                            <label class="layui-form-label hylabel">岗位</label>
                            <div class="layui-input-block">
                                <input type="text" id="attenderJob" name="attenderJob" placeholder="请输入"
                                    autocomplete="off" class="layui-input hyinput">
                            </div>
                        </div>
                    </div>
                    <div style="display: none">
                        <div class="layui-card" style="margin-top: 10px">
                            <div class="layui-card-body">
                                <div class="layui-form-item" style="text-align: center;">
                                    <button class="layui-btn" lay-submit lay-filter="formAttenderAdd"> <i
                                            class="layui-icon">&#x1005;</i>保存</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!--编辑出席人员 layer-->
    <div class="attendee-edit-layer hide">
        <div class="moduleBox">
            <table class="layui-hide" id="attendee-edit-table" lay-filter="attendee-edit-table"></table>
            <script type="text/html" id="attendee-edit-table-tool-bar">
            <div class="layui-btn-container">
                <button class="layui-btn layui-btn-sm" lay-event="add">
                    <i class="layui-icon">&#xe608;</i> 新增
                </button>
                <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="del" >
                    <i class="layui-icon">&#xe640;</i> 删除
                </button>
                <button class="layui-btn layui-btn-sm layui-btn-primary" style="float:right" permission-btn="" lay-event="down">
                    <i class="layui-icon">&#xe61a;</i>向下
                </button>
                <button class="layui-btn layui-btn-sm layui-btn-primary" style="float:right" permission-btn="" lay-event="up">
                    <i class="layui-icon">&#xe619;</i>向上
                </button>
                <!-- <button class="layui-btn layui-btn-sm layui-btn-primary" lay-event="delete">
                    <i class="fa fa-share-alt"></i> 选择
                </button> -->
            </div>
        </script>
            <script type="text/html" id="attendee-edit-table-oper">
            <div class="layui-btn-container">
                <button class="layui-btn layui-btn-xs" lay-event="edit">编辑</button>
            </div>
        </script>
        </div>
    </div>
    <!--编辑出席人员情况 layer-->
    <div class="attendeeStatusLayer hide">
        <div class="moduleBox">
            <form class="layui-form form-theme3">
                <div class="layui-form-item">
                    <label class="layui-form-label "><b class="red">*</b>人员姓名:</label>
                    <div class="layui-input-block">
                        <input type="text" class="layui-input" lay-verify="required" placeholder="请输入人员姓名">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label "><b class="red">*</b>职务名称:</label>
                    <div class="layui-input-block">
                        <input type="text" class="layui-input" lay-verify="required" placeholder="请输入职务名称">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label "><b class="red">*</b>出席排序:</label>
                    <div class="layui-input-block">
                        <input type="text" class="layui-input" lay-verify="required">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label "><b class="red">*</b>参会状态:</label>
                    <div class="layui-input-block">
                        <select name="canhuiStatus" lay-filter="canhuiStatus">
                            <option value="">请选择</option>
                            <option value="1">出席</option>
                            <option value="2">缺席</option>
                            <option value="3">委托</option>
                            <option value="4">回避</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item zhuchiArea" style="display: none">
                    <label class="layui-form-label "><b class="red">*</b>召集主持:</label>
                    <div class="layui-input-block">
                        <input type="radio" name="radioZhuchi" title="召集人" checked>
                        <input type="radio" name="radioZhuchi" title="主持人">
                    </div>
                </div>
                <div class="layui-form-item quexiArea" style="display: none">
                    <label class="layui-form-label "><b class="red">*</b>缺席原因:</label>
                    <div class="layui-input-block">
                        <select>
                            <option value="">请输入缺席原因或选择常见缺席原因</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item weituoArea" style="display: none">
                    <label class="layui-form-label "><b class="red">*</b>委托人名:</label>
                    <div class="layui-input-block">
                        <input type="text" class="layui-input" lay-verify="required" placeholder="请输入委托人名">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label ">备注:</label>
                    <div class="layui-input-block">
                        <textarea name="" class="layui-textarea" placeholder="请输入备注信息"></textarea>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!--会议类型选择-->
    <script type="text/html" class="meetingTypeSelectLayer hide">
        <div class="moduleBox">
            <form class="layui-form layui-form-pane" name="preMeetingTypeFormLayer" lay-filter="preMeetingTypeForm">
                <div class="layui-card">
                    <div class="layui-card-body">
                        <div class="layui-row layui-col-space15">
                            <div class="layui-col-md12">
                                <div class="layui-form-item">
                                    <label class="layui-form-label hylabel"><b class="red">*</b>上会类型:</label>
                                    <div class="layui-input-block">
                                        <select name="meetingType" lay-verify="required" id="meetingType" lay-filter="meetingTypeFilter"></select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
</script>
    <!--前置审核-添加-->
    <script type="text/html" id="hyzl-add">
    <div class="layui-card-body">
        <div class="layui-form layui-form-pane" name="motionAuditFrom" lay-filter="motionAuditFrom">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-xs12" id="auditTypeArea">
                    <div class="layui-form-item">
                        <label class="layui-form-label hylabel"><b class="red">*</b>审核类型：</label>
                        <div class="layui-input-block">
                            <select name="auditType" id="auditType" lay-verify="required"
                                    lay-filter="auditType"></select>
                        </div>
                    </div>
                </div>

                <div class="layui-col-xs12">
                    <div class="layui-form-item">
                        <label class="layui-form-label hylabel"><b class="red">*</b>文件上传: </label>
                        <!-- <div class="layui-input-block">
                            <div style="display: inline-block">
                                <button class="layui-btn layui-btn-normal" id="motionAuditUpload" type="button">点击选择
                                </button>
                            </div>
                        </div> -->
                        <div class="layui-input-block" style="padding-right: 77px">
                            <input type="text" name="fileName"  placeholder="请选择文件" autocomplete="off" class="layui-input hyinput" readonly>
                        </div>
                        <div style="position: absolute;top: 10px; right: 7px">
                            <button class="layui-btn" id="motionAuditUploadLayer"><i class=" fa fa-share-alt"></i>选择</button>
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12" id="fileNameArea" style="display: none">
                    <div class="layui-form-item">
                        <label class="layui-form-label hylabel">文件名称：</label>
                        <div class="layui-input-block">
                            <input type="text" name="fileName" placeholder="请输入文件名称" class="layui-input" lay-verify="required"
                                   style="width: 60%;display: inline-block">
                            <input type="text" name="fileType" class="layui-input" readonly="readonly"
                                   style="display: inline-block;width: 30%">
                        </div>
                    </div>
                </div>
                <!--前置审核ID-->
                <input type="hidden" name="motionAuditId">
                <input type="hidden" name="auditTypeName">
                <input type="hidden" name="maFile">
                <input type="hidden" name="maFileName">
            </div>
            <div class="layui-card" style="margin-top: 10px">
                <div class="layui-card-body">
                    <div class="layui-form-item" style="text-align: center;">
                        <button class="layui-btn" lay-submit lay-filter="addMotionAudit" id="addMotionAudit">
                            <i class="layui-icon">&#xe605;</i> 保存
                        </button>
                        <button class="layui-btn layui-btn-primary" id="closeAddMotionAudit" lay-filter="closeAddMotionAudit">
                                 取消
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>
    <!--议案附件上传-->
    <script id="hyzl-add1" type="text/html">
    <div class="layui-card-body">
        <div class="layui-form layui-form-pane" name="motionAuditFrom" lay-filter="motionAuditFrom">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-xs12" id="auditTypeArea">
                    <div class="layui-form-item">
                        <label class="layui-form-label hylabel"><b class="red">*</b>审核类型：</label>
                        <div class="layui-input-block">
                            <select name="auditType" id="auditType" lay-verify="required" lay-filter="auditType" lay-search >
                            </select>
                        </div>
                    </div>
                </div>

                <div class="layui-col-xs12">
                    <div class="layui-form-item">
                        <label class="layui-form-label hylabel">上传文件：</label>
                        <!-- <div class="layui-input-block">
                            <div style="display: inline-block">
                                <button class="layui-btn layui-btn-normal" id="motionAuditUpload" type="button">点击选择
                                </button>
                            </div>
                        </div> -->
                        <div class="layui-input-block" style="padding-right: 77px">
                                <input type="text" name="fileName"  placeholder="请选择文件" autocomplete="off" class="layui-input hyinput" readonly>
                            </div>
                            <div style="position: absolute;top: 10px; right: 7px">
                                <button class="layui-btn" id="yacl_motionAuditUploadLayer"><i class=" fa fa-share-alt"></i>选择</button>
                            </div>
                        </div>
                </div>
                <div class="layui-col-xs12" id="fileNameArea" style="display: none">
                    <div class="layui-form-item">
                        <label class="layui-form-label hylabel">文件名称：</label>
                        <div class="layui-input-block">
                            <input type="text" name="fileName" placeholder="请输入文件名称" class="layui-input"
                                   style="width: 60%;display: inline-block">
                            <input type="text" name="fileType" class="layui-input" readonly="readonly"
                                   style="display: inline-block;width: 30%">
                        </div>
                    </div>
                </div>

                <!--前置审核ID-->
                <input type="hidden" name="motionAuditId">
                <input type="hidden" name="auditTypeName">
                <input type="hidden" name="maFile">
                <input type="hidden" name="maFileName">
            </div>
            <div class="layui-card" style="margin-top: 10px">
                <div class="layui-card-body">
                    <div class="layui-form-item" style="text-align: center;">
                        <button class="layui-btn" id="addMotionAudit1">
                                <i class="layui-icon">&#x1005;</i>保存</button>
                        <button class="layui-btn layui-btn-primary" id="closeAddMotionAudit1" lay-filter="closeAddMotionAudit">
                                <i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>
    <!-- 页面主体 -->
    <div class="content-wrap">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-xs12 hide">
                <ul class="clearFix gloBg meetingTypeFlowUl">
                </ul>
            </div>
            <div class="layui-col-xs12">
                <div class="gloBg">
                    <div class="mainTitle" id="mainTitle">议案</div>
                </div>
            </div>
            <div class="layui-col-xs12 layui-col-sm12 layui-col-md12" id="motionMain" style="padding-top: 0;">
                <!-- 议案信息 -->
                <div class="layui-form layui-form-pane" name="motionaLayer" lay-filter="motionaForm">
                    <input type="hidden" name="motionId">
                    <div class="layui-card">
                        <div class="layui-card-header layui-card-header-custom">
                            <span>
                                <i></i>议案信息
                            </span>
                        </div>
                        <!-- 暂时保存 -->
                        <input type="hidden" name="curSeId" id="curSeId">
                        <input type="hidden" name="meetingId" id="meetingId">
                        <input type="hidden" name="exceptionFlag" id="exceptionFlag">
                        <input type="hidden" name="formOperType" id="formOperType">
                        <input type="hidden" name="releaseTime" id="releaseTime">
                        <div class="layui-card-body">
                            <!-- 议案名称 -->
                            <div class="layui-row layui-col-space15">
                                <div class="layui-col-xs12">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label hylabel"><b class="red">*</b>议案名称:</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="motionName" lay-verify="required" placeholder="请输入"
                                                autocomplete="off" class="layui-input hyinput" value="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 提出部门 议案类别-->
                            <div class="layui-row layui-col-space15">
                                <div class="layui-col-xs6">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label hylabel"><b class="red">*</b>提出部门:</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="soName" required="" lay-verify="required"
                                                placeholder="请选择" readonly="" autocomplete="off"
                                                class="layui-input hyinput">
                                            <div class="eleTree ele5" lay-filter="data5"></div>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" name="soId">
                                <div class="layui-col-xs6">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label hylabel"><b class="red">*</b>议案类别:</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="motionTypeName" required="" lay-verify="required"
                                                placeholder="请选择" readonly="" autocomplete="off"
                                                class="layui-input hyinput">
                                            <div class="eleTree ele6" lay-filter="data6"></div>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" name="motionType">
                            </div>
                            <!-- 上会类型 审议类型-->
                            <div class="layui-row layui-col-space15">
                                <div class="layui-col-xs6">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label hylabel"><b class="red">*</b>上会类型:</label>
                                        <div class="layui-input-block">
                                            <select name="meetingTypeId" lay-verify="required" id="meetingTypeId"
                                                lay-filter="meetingTypeFilter"></select>
                                        </div>
                                        <input type="hidden" name="meetingTypeName">
                                    </div>
                                </div>
                                <div class="layui-col-xs6">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label hylabel"><b class="red">*</b>审议类型:</label>
                                        <div class="layui-input-block">
                                            <select name="deliberationCode" lay-verify="required" id="deliberationCode"
                                                lay-filter="deliberationFilter"></select>
                                        </div>
                                        <input type="hidden" name="deliberationName">
                                    </div>
                                </div>
                            </div>
                            <!-- 创建日期 三重一大-->
                            <div class="layui-row layui-col-space15">
                                <div class="layui-col-xs6">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label hylabel"><b class="red">*</b>创建日期:</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="motionCreateTime" readonly
                                                class="layui-input hyinput" id="cjsj" lay-verify="required"
                                                placeholder="请选择">
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-col-xs6 hide isRel">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label hylabel" style="width:150px;"><b
                                                class="red">*</b>三重一大:</label>
                                        <div class="layui-input-block">
                                            <input type="radio" name="tiolFlag" value="0" lay-filter="tiolFlag"
                                                title="否" checked>
                                            <input type="radio" name="tiolFlag" value="1" lay-filter="tiolFlag"
                                                title="是">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 主要内容 -->
                            <div class="layui-row layui-col-space15">
                                <div class="layui-col-xs12">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label hylabel">主要内容:</label>
                                        <div class="layui-input-block">
                                            <textarea placeholder="建议200个字,最长仅支持2000字" name="motionContemt"
                                                class="layui-textarea hyinput"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 提案表 -->
                            <div class="layui-row layui-col-space15">
                                <div class="layui-col-md12">
                                    <div class="layui-form-item" style="position: relative">
                                        <label class="layui-form-label hylabel">&#x3000;<b class="red">*</b>提案表:</label>
                                        <div class="layui-input-block" style="padding-right: 160px">
                                            <input type="hidden" name="motionDatum" id="motionDatum">
                                            <input type="text" name="motionDatumName" lay-verify="motionDatum"
                                                id="motionDatumName" placeholder="请点击上传按钮上传提案表" autocomplete="off"
                                                class="layui-input hyinput" readonly>
                                        </div>
                                        <div style="position: absolute;top: 1px; right: 0">
                                            <button class="layui-btn" id="tbUploadBtn_new" style="padding: 0 14px;"><i
                                                    class="layui-icon">&#xe62f;</i>上传</button>
                                            <button class="layui-btn layui-btn-warm" id="tbDelBtn_new"
                                                style="margin-left: 10px;"><i class="layui-icon">&#xe640;</i>删除</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 汇报人员 -->
                            <div class="layui-row layui-col-space15">
                                <div class="layui-col-md12">
                                    <div class="layui-form-item relative">
                                        <label class="layui-form-label hylabel"><b class="red">*</b>汇报人员:</label>
                                        <div class="layui-input-block" style="padding-right: 160px">
                                            <input type="text" name="msSpeaker" lay-verify="msSpeaker" id="msSpeaker"
                                                placeholder="请点击编辑按钮进行修改,点击选择按钮重选" autocomplete="off"
                                                class="layui-input hyinput" readonly>
                                        </div>
                                        <div style="position: absolute;top: 1px; right: 0">
                                            <button class="layui-btn layui-btn-warm" id="hbPersonEditBtn_new"><i
                                                    class="fa fa-pencil"></i>编辑</button>
                                            <button class="layui-btn" id="hbPersonChooseBtn_new"><i
                                                    class=" fa fa-share-alt"></i>选择</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 列席人员 -->
                            <div class="layui-row layui-col-space15">
                                <div class="layui-col-md12">
                                    <div class="layui-form-item relative">
                                        <label class="layui-form-label hylabel"><b class="red">*</b>列席人员:</label>
                                        <div class="layui-input-block" style="padding-right: 160px">
                                            <input type="text" name="attendanceListStr" lay-verify="attendanceListStr"
                                                id="attendanceListStr" placeholder="请点击编辑按钮进行修改,点击选择按钮重选"
                                                autocomplete="off" class="layui-input hyinput" readonly>
                                        </div>
                                        <div style="position: absolute;top: 1px; right: 0">
                                            <button class="layui-btn layui-btn-warm" id="lxPersonEditBtn_new"><i
                                                    class="fa fa-pencil"></i>编辑</button>
                                            <button class="layui-btn" id="lxPersonChooseBtn_new"><i
                                                    class=" fa fa-share-alt"></i>选择</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!--议案材料-->
                <div class="layui-collapse white-bg" style="margin-top: 10px;">
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title white-bg">议案材料</h2>
                        <div class="layui-colla-content ">
                            <div class="layui-card">
                                <div class="layui-card-body" style="position: relative;">
                                    <div class="layui-col-xs1 layui-col-sm1 layui-col-md1"
                                        style="width: 130px;position: absolute;top: 0;">
                                        <div class="versionLabel">最终版本:</div>
                                    </div>
                                    <div class="layui-col-xs12 layui-col-sm12 layui-col-md12"
                                        style="padding-left: 115px;">
                                        <table id="motionDatumList" lay-filter="motionDatumList"></table>
                                    </div>
                                    <script type="text/html" id="motionDatumListToolBar">
                                    <div class="layui-btn-container">
                                        <button class="layui-btn layui-btn-sm" type="button"
                                                lay-event="motionDatumupload">
                                            <i class="layui-icon">&#xe608;</i>新增
                                        </button>
                                        <button class="layui-btn layui-btn-sm layui-btn-danger" permission-btn="" lay-event="delete">
                                            <i class="layui-icon">&#xe640;</i> 删除
                                        </button>
                                        <button class="layui-btn layui-btn-sm layui-btn-primary" style="float:right" permission-btn="" lay-event="downFile">
                                            <i class="layui-icon">&#xe61a;</i>向下
                                        </button>
                                        <button class="layui-btn layui-btn-sm layui-btn-primary" style="float:right" permission-btn="" lay-event="upFile">
                                            <i class="layui-icon">&#xe619;</i>向上
                                        </button>
                                    </div>
                                </script>
                                    <script type="text/html" id="motionDatumListOper">
                                    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="preview">预览</a>
                                </script>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 前置审核 -->
                <div class="layui-collapse white-bg" style="margin-top: 10px;">
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title white-bg">前置审核</h2>
                        <div class="layui-colla-content ">
                            <div class="layui-card">
                                <div class="layui-card-body" style="position: relative;">
                                    <div class="layui-col-xs1 layui-col-sm1 layui-col-md1"
                                        style="width: 130px;position: absolute;top: 0;">
                                        <div class="versionLabel">最终版本:</div>
                                    </div>
                                    <div class="layui-col-xs12 layui-col-sm12 layui-col-md12"
                                        style="padding-left: 115px;">
                                        <table id="addMotionAuditList" lay-filter="addMotionAuditList"></table>
                                    </div>
                                    <script type="text/html" id="hyzlListToolBar">
                                    <div class="layui-btn-container">
                                        <button class="layui-btn layui-btn-sm" lay-event="add">
                                            <i class="layui-icon">&#xe608;</i> 新增
                                        </button>
                                        <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="del">
                                            <i class="layui-icon">&#xe640;</i> 删除
                                        </button>
                                        <button class="layui-btn layui-btn-sm layui-btn-primary" style="float:right" permission-btn="" lay-event="downFile">
                                            <i class="layui-icon">&#xe61a;</i>向下
                                        </button>
                                        <button class="layui-btn layui-btn-sm layui-btn-primary" style="float:right" permission-btn="" lay-event="upFile">
                                            <i class="layui-icon">&#xe619;</i>向上
                                        </button>
                                    </div>
                                </script>

                                    <script type="text/html" id="hyzlListOper">
                                    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="preview">预览</a>
                                </script>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--关联议案-->
                <div class="layui-collapse white-bg" style="margin-top: 10px;">
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title white-bg">关联议案</h2>
                        <div class="layui-colla-content ">
                            <div class="layui-card">
                                <div class="layui-card-body" style="position: relative;">
                                    <div class="layui-col-xs1 layui-col-sm1 layui-col-md1"
                                        style="width: 130px;position: absolute;top: 0;">
                                        <div class="versionLabel">关联议案</div>
                                    </div>
                                    <div class="layui-col-xs12 layui-col-sm12 layui-col-md12"
                                        style="padding-left: 115px;">
                                        <table id="glyaList" lay-filter="glyaList"></table>
                                    </div>
                                    <script type="text/html" id="yalListToolBar">
                                    <div class="layui-btn-container">
                                        <button class="layui-btn layui-btn-sm" lay-event="check">
                                            <i class="layui-icon">&#xe608;</i> 关联
                                        </button>
                                        <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="del">
                                            <i class="layui-icon">&#xe640;</i> 删除
                                        </button>
                                    </div>
                                </script>
                                    <script type="text/html" id="glyaListOper">
                                    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="check">查看</a>
                                </script>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--退回情况-->
                <div class="layui-collapse white-bg hideClass" style="margin-top: 10px;" id="returnLayer">
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title white-bg">退回情况</h2>
                        <div class="layui-colla-content ">
                            <div class="layui-card">
                                <div class="layui-card-body" style="position: relative;">
                                    <div class="layui-col-xs1 layui-col-sm1 layui-col-md1"
                                        style="width: 130px;position: absolute;top: 0;">
                                        <div class="versionLabel">退回列表</div>
                                    </div>
                                    <div class="layui-col-xs12 layui-col-sm12 layui-col-md12"
                                        style="padding-left: 115px;">
                                        <table id="returnList" lay-filter="returnList"></table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="position: fixed;width: 100%;bottom: 12px;">
        <div class="layui-card" style="margin-top: 10px">
            <div class="layui-card-body">
                <div class="layui-form-item" style="text-align: center;">
                    <button class="layui-btn layui-btn-sm layui-btn-danger unEdit" id="saveMotionAll"
                        permission-btn="addMotion_DraftBoxEdit">
                        <i class="layui-icon">&#x1005;</i>保存
                    </button>
                    <button class="layui-btn layui-btn-sm submit unEdit" id="submitYa" type="button"
                        permission-btn="submitMotion_DraftBoxEdit">
                        <i class="layui-icon">&#xe605;</i>提交
                    </button>
                    <button class="layui-btn layui-btn-sm" id="closeBtn">
                        </i><i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- 退回弹窗 -->
    <script id="nsh-back" type="text/html">
    <div class="layui-card-body">
        <div class="layui-card-header layui-card-header-custom">
            <span>
                <i></i>退回信息
            </span>
        </div>
        <form class="layui-form layui-form-pane" name="motionAuditFrom" lay-filter="motionAuditFrom">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-xs12">
                    <div class="layui-form-item">
                        <label class="layui-form-label hylabel"><b class="red">*</b>退回意见</label>
                        <div class="layui-input-block">
                            <textarea name="opnion" id="opnion" required placeholder="请输入" class="layui-textarea hyinput"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-card" style="margin-top: 10px">
                <div class="layui-card-body">
                    <div class="layui-form-item" style="text-align: center;">
                        <button class="layui-btn" id="addMotionAudit1"><i class="fa fa-check-circle"></i>确定</button>
                        <button class="layui-btn layui-btn-primary" id="closeAddMotionAudit1" lay-filter="closeAddMotionAudit"><i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</script>
    <!--脚垫-->
    <div style="height: 80px;"></div>
    <script type="text/html" id="switchTpl">
    <!-- 这里的 checked 的状态只是演示 -->
    <input type="checkbox" name="{{d.attendanceName}}" value="{{d.attendanceId}}" lay-skin="switch" lay-text="是|否"
        lay-filter="sexDemo" {{ d.isReport == '1' ? 'checked' : '' }}>
    </script>
    <script src="./../../../js/layui/layui.js"></script>
    <script>
        $.reloadParentPage = function () {//获取父页面dom
            if ($(top.window.document).find('#refresh')[0]) {
                $(top.window.document).find('#refresh').trigger('click');
            } else {
                // $($(top.window.document).find('#mainTabContent .layui-show').find('.iframe')[0].contentWindow.document).find(toModule.toModuleDom).click();
                $($(top.window.document).find('#menuContent').find('.iframe')[0].contentWindow.document).find('#refresh').click();
            }
        }
        layui.config({
            base: '../../../../src/js/',
            version: new Date().getTime()
        }).use(['eleTree', 'layer', 'table', 'form', 'laytpl', 'common', 'element', 'laydate', 'upload'], function () {

            var table = layui.table;
            var form = layui.form;
            var tree = layui.eleTree;
            var common = layui.common;
            var element = layui.element;
            var laydate = layui.laydate;
            var upload = layui.upload;
            var laytpl = layui.laytpl;
            var motionObj = null;
            var meetingTypeId;
            var fileSortData, fileSortData1, attendanceSortData;
            var motionId = common.getQueryVariable("motionId") || $("[name='motionId']").val();//流动的motionId
            var fixedMotion = motionId;//保存父页面传来的motionId
            var motionIdFlag = false;
            var isHide = false;

            element.init();
            var baseUrl = '../../../../';
            common.themeSet();
            //页面刚进来，需要先选择会议类型，获取对应会议类型ID Code Name
            var meetingTypeId,
                meetingTypeCode,
                meetingTypeName,
                meetingIdForm = common.getQueryVariable('dataObj') || common.uuid('', 32);
            var newMotionId = common.getQueryVariable('newMotionId');
            var newMotionReadyId = common.getQueryVariable('newMotionReadyId');

            var nextMotionObj = sessionStorage.getItem('newMotionObj');
            if (nextMotionObj) {
                nextMotionObj = JSON.parse(nextMotionObj);//赋值完就清空
                sessionStorage.clear('newMotionObj');
            }
            var curStatusType = common.getQueryVariable('statusType');
            sessionStorage.setItem('hasCaoGao', '0');
            sessionStorage.setItem('newMotionSave', '0');
            sessionStorage.clear('curStatusType');
            sessionStorage.clear('flowStatusId');
            var curIndex;
            //操作类型，add:新增；edit：编辑
            var formOperType = common.getQueryVariable('formOperType');
            var flowStatusId = common.getQueryVariable('flowStatusId');
            //是否异常
            var exceptionFlag = false;
            var editFlowStatusId = common.getQueryVariable('flowStatusId');
            //------------------------预留layer节点报错
            var addMotionAuditIndex = null;
            var addMotionRelatedCourse = null;
            var formMotionCloseIndex = window.parent.layer.index;

            // --------------------------------初始化END--------------------------------

            //按钮权限
            common.buttonLimit($("#currentMenuSmId", window.parent.document).val(), function (res) {
                //输入所有可操作的按钮集合
                var list = res['list'] ? res['list'] : [];

            });
            //table监听事件
            var motionAuditUpload = null;
            var motion_Info = {};
            var motionAudit_info = {};
            // ------------------------------------功能实现

            var uploadFileObj = null;
            var mId = "";
            var uploadHandle = {
                fileDownloadUrl: function (fid) {
                    window.open(baseUrl + "dfsmgr/file/filesDownload?fid=" + fid);
                },
                fileDelUrl: function (fid, fun) {
                    common.fetchDelete("/dfsmgr/file/deleteById?id=" + fid, function (res) {
                        if (res.success) {
                            layer.msg('删除成功');
                            fun();
                        } else {
                            layer.msg('删除失败');
                        }
                    });
                }
            }
            var eventHandle = {
                nextMotionReadyRender: function (newMotionReadyId) {
                    common.fetchPost('motionmgr/motiona/nextMotion?motionId=' + fixedMotion + '&newMotionId=' + newMotionReadyId,
                        {}, function (data) {
                            if (data.success) {
                                sessionStorage.setItem('hasCaoGao', '1');
                                eventHandle.nextMotionRender();
                            } else {
                                layer.msg("新建下个会接口信息获取失败:" + data.resultMessage);
                                $('.meetingTypeFlowUl').find('li.defaultClickIndex').trigger('click');
                            }
                        }, function (err) {
                            $('.meetingTypeFlowUl').find('li.defaultClickIndex').trigger('click');
                            layer.msg('新建下个会接口信息获取失败：' + err.resultMessage);//失败后提示
                            return false;
                        });
                },
                nextMotionRender: function () {
                    //会议类型弹窗选择
                    eventHandle.meetingTypeSelectLayer();
                    //点击事件
                    $('.meetingTypeFlowUl li').off().on('click', function (e) {
                        e.stopPropagation();
                        var $tar = $(this);
                        var hasClass = $tar.hasClass('bg-gray');
                        if (!hasClass) {//不包含
                            return false;
                        }
                        motionId = $tar.attr('data-motionId');
                        var statusType = $tar.attr('data-statusType');
                        // if(statusType=="3"){
                        //     layer.msg('当前状态不可编辑');//不可编辑的状态 3（已上会）  议案可编辑状态：0（草稿）、1（已提交）、4（已退回）
                        //     return false;
                        // }
                        var flowStatusId = $tar.attr('data-flowStatusId');
                        sessionStorage.setItem('curStatusType', statusType);
                        sessionStorage.setItem('flowStatusId', flowStatusId);
                        $tar.removeClass('bg-gray').siblings().addClass('bg-gray');
                        curIndex = $tar.index();
                        eventHandle.getMotiona(motionId);
                    });
                    //有数据 默认高亮设置
                    var len = $('.meetingTypeFlowUl li').length;
                    $('.meetingTypeFlowUl').find('li').eq(len - 1).trigger('click');
                    //议案材料
                    //eventHandle.motionAboutTableFlush(motionId);
                    //前置审核
                    // eventHandle.qzshTableInit();
                    //关联议案
                    //eventHandle.glyaTableInit();
                    //退回情况
                    //eventHandle.returnTableInit();
                },
                getMotiona: function (motionId) {// 议案信息导入
                    var layerLoader = common.layerLoader();
                    common.fetchPost('motionmgr/motiona/findMotiona', { motionId: motionId }, function (data) {
                        layer.close(layerLoader);
                        if (data.success) {
                            eventHandle.loadFormValue(data.object);
                            eventHandle.reloadGlyaTable();
                            motionObj = data.object;
                            eventHandle.initRel(motionObj);
                        } else {
                            layer.msg("查询议案信息失败:" + data.resultMessage);
                            return false
                        }

                        //议案材料
                        eventHandle.motionAboutTableFlush(motionId);
                        //前置审核
                        eventHandle.qzshTableInit(motionId);
                        //关联议案
                        eventHandle.glyaTableInit();
                        //退回情况
                        eventHandle.returnTableInit();

                    }, function () {
                        layer.close(layerLoader);
                        layer.msg('查询议案信息失败');//失败后提示
                    });
                },
                getMeetingTypeFlow: function (motionId) {//获取会议类型流程信息
                    motionId = motionId || null
                    common.fetchPost('motionmgr/motiona/selectRelMotionList', {
                        motionId: motionId
                    }, function (res) {
                        var data = res.list || [];
                        var html = '';
                        if (data.length > 0) {
                            for (var i = 0; i < data.length; i++) {
                                if (data[i].statusType === "0") {
                                    sessionStorage.setItem('hasCaoGao', '1');
                                }
                                html +=
                                    '<li class="bg-gray ' + (data[i].motionId == motionId ? 'defaultClickIndex' : '') + '" data-motionId="' + data[i].motionId + '" data-meetingTypeId="' +
                                    data[i].meetingTypeId + '" data-statusType="' + data[i].statusType + '" data-flowStatusId="' + ((data[i].tails && data[i].tails.flowStatusId) ? data[i].tails.flowStatusId : '') + '">' +
                                    '    <div class="yaMeetingType">' +
                                    '        <span name="meetingTypeName">' + (data[i].meetingTypeName ? data[i].meetingTypeName : '') + '</span>议案' +
                                    '    </div>' +
                                    '    <div class="curStatus">' +
                                    '        <span name="statusTypeName">(' + ((data[i].tails && data[i].tails.statusTypeName) ? data[i].tails.statusTypeName : '') + ')</span>' +
                                    '    </div>' +
                                    '</li>';
                            }
                            var hasCaoGao = sessionStorage.getItem('hasCaoGao');
                            if (curStatusType == '1' && hasCaoGao !== "1") {//当前议案为已提交 并且当前会议流程无草稿议案
                                html +=
                                    '<li class="curStatusType" data-motionId="" data-meetingTypeId="">' +
                                    '    <div class="yaMeetingType">' +
                                    '        <span name="meetingTypeName"><i class="layui-icon">&#xe654;</i></span>' +
                                    '    </div>' +
                                    '    <div class="curStatus">' +
                                    '        <span name="statusTypeName">(新增下个会)</span>' +
                                    '    </div>' +
                                    '</li>';
                            }

                            $('.meetingTypeFlowUl').empty().html(html);

                            $('.meetingTypeFlowUl').parent().show();
                            if (newMotionId) {
                                //获取下个会复制信息并导入
                                eventHandle.nextMotionRender();
                            }
                            else {
                                $('.meetingTypeFlowUl li').off().on('click', function (e) { //点击事件
                                    e.stopPropagation();
                                    var $tar = $(this);
                                    var hasClass = $tar.hasClass('bg-gray');
                                    if (!hasClass) {//不包含
                                        return false;
                                    }
                                    if ($tar.hasClass('defaultClickIndex')) {
                                        $('.unEdit').show();
                                        $('button').not("[id^=closeBtn]").show();
                                        $('input').removeAttr('disabled');
                                        $('select').removeAttr('disabled');
                                        isHide = true;
                                        form.render();
                                    } else {
                                        $('input').attr('disabled', 'disabled');
                                        $('select').attr('disabled', 'disabled');
                                        $('.unEdit').hide();
                                        $('button').not("[id^=closeBtn]").hide();
                                        isHide = false;
                                        form.render();
                                    }
                                    var statusType = $tar.attr('data-statusType');
                                    // if(statusType=="3"){
                                    //     layer.msg('当前状态不可编辑');//不可编辑的状态 3（已上会）  议案可编辑状态：0（草稿）、1（已提交）、4（已退回）
                                    //     return false;
                                    // }
                                    var flowStatusId = $tar.attr('data-flowStatusId');
                                    sessionStorage.setItem('curStatusType', statusType);
                                    sessionStorage.setItem('flowStatusId', flowStatusId);
                                    $tar.removeClass('bg-gray').siblings().addClass('bg-gray');
                                    curIndex = $tar.index();

                                    var curMeetingTypeName = $tar.find('[name=meetingTypeName]').text();
                                    var curMotionId = $tar.attr('data-motionId');
                                    motionId = $tar.attr('data-motionId');
                                    if (curStatusType == "1") {
                                        var hasClass = $tar.hasClass('curStatusType');
                                        if (hasClass) {
                                            //获取下个会复制信息并导入
                                            if (newMotionReadyId) {//编辑中的新建下个会
                                                eventHandle.nextMotionReadyRender(newMotionReadyId);
                                            }
                                            else {//点击下个会进入
                                                eventHandle.nextMotionRender();
                                            }
                                        }
                                        else {
                                            $('#mainTitle').text(curMeetingTypeName + '议案').show();
                                            eventHandle.getMotiona(curMotionId);
                                            //eventHandle.qzshTableReload();
                                        }
                                    }
                                    else {
                                        $('#mainTitle').text(curMeetingTypeName + '议案').show();
                                        eventHandle.getMotiona(curMotionId);
                                        //eventHandle.qzshTableReload();
                                    }
                                });
                                $('.meetingTypeFlowUl').find('li.defaultClickIndex').trigger('click');
                            }
                        }
                        else {
                            $('.meetingTypeFlowUl').parent().hide();
                        }
                    });
                },
                motionAboutTableInit: function (data) {
                    table.render(common.tableInitParams({//议案材料
                        elem: '#motionDatumList',
                        // url: baseUrl + 'dfsmgr/file/getFileByResId?id=' + mId+'&type=SUBJECT',
                        id: "motionDatumList",
                        // method: 'post',
                        // where: {
                        //     type: "related"
                        // },
                        data: data,
                        defaultToolbar: [],
                        toolbar: '#motionDatumListToolBar',
                        height: 'full-200',
                        height: false,
                        page: false,
                        cols: [
                            [
                                { type: 'checkbox' },
                                { type: "numbers", align: 'center', title: "序号" },
                                {
                                    field: 'fiName', title: '文件名称', align: 'center', minWidth: 120, sort: true,
                                    //  templet: function (rowData) {
                                    //     return rowData.fiName + '.' + rowData.fiSuffix;
                                    // }
                                },
                                { field: '', title: '操作', align: 'center', width: 80, toolbar: '#motionDatumListOper', fixed: 'right' }
                            ]
                        ],
                        done: function (data) {
                            fileSortData = common.arraySort(data.data ? data.data : [], 'ggSort');
                            if (isHide) {
                                //$('.unEdit').show();
                                $('.versionLabel').css('margin-top', '45px')
                                form.render();
                            } else {
                                //$('.unEdit').hide();
                                $('.layui-table-tool').remove();
                                $('.versionLabel').css('margin-top', 25)
                                form.render();
                            }
                        },
                        error: function (res, curr, count) {
                        }
                    }));
                },
                errTableInit: function (data) {
                    table.render(common.tableInitParams({//议案材料
                        text: {
                            none: '请求异常,请联系管理员'
                        },
                        elem: '#motionDatumList',
                        // url: baseUrl + 'dfsmgr/file/getFileByResId?id=' + mId+'&type=SUBJECT',
                        id: "motionDatumList",
                        // method: 'post',
                        // where: {
                        //     type: "related"
                        // },
                        data: data,
                        defaultToolbar: [],
                        toolbar: '#motionDatumListToolBar',
                        height: 'full-200',
                        height: false,
                        page: false,
                        cols: [
                            [
                                { type: 'checkbox' },
                                { type: "numbers", align: 'center', title: "序号" },
                                {
                                    field: 'fiName', title: '文件名称', align: 'center', minWidth: 120, sort: true,
                                    //  templet: function (rowData) {
                                    //     return rowData.fiName + '.' + rowData.fiSuffix;
                                    // }
                                },
                                { field: '', title: '操作', align: 'center', width: 80, toolbar: '#motionDatumListOper', fixed: 'right' }
                            ]
                        ],
                        done: function (data) {
                            fileSortData = common.arraySort(data.data ? data.data : [], 'ggSort');

                        },
                        error: function (res, curr, count) {
                        }
                    }));
                },
                motionAboutTableFlush: function (motionId) {
                    try {
                        var data = [];
                        var loadingIndex = layer.load();
                        common.fetchGet('../../../../dfsmgr/file/getFileByResId?id=' + motionId + '&type=SUBJECT', function (res) {
                            layer.close(loadingIndex);
                            if (res.success && res.list) {
                                data = res.list || [];
                            } else {
                                parent.layer.msg('议案材料列表获取失败', {
                                    time: 3000, //3s后自动关闭
                                });
                            }
                            eventHandle.motionAboutTableInit(data);
                        },
                            function (err) {
                                layer.close(loadingIndex);
                                if (err.resultMessage) {
                                    parent.layer.alert(err.resultMessage);
                                }
                                else {
                                    parent.layer.msg('议案材料列表获取失败');
                                }
                                eventHandle.errTableInit([]);
                                return false;
                            });
                    } catch (e) {
                        eventHandle.errTableInit([]);
                        parent.layer.msg('议案材料列表获取失败,请联系系统管理员');
                    }
                },
                glyaTableInit: function () {
                    table.render(common.tableInitParams({//关联议案
                        elem: '#glyaList',
                        url: baseUrl + 'motionmgr/motiona/selectMotionOnMeetingMotionPage',
                        id: "glyaList",
                        method: 'post',
                        where: {
                            motionId: motionId,
                            type: "related"
                        },
                        toolbar: '#yalListToolBar',
                        height: 'full-200',
                        defaultToolbar: [],
                        height: false,
                        page: false,
                        cols: [
                            [
                                { type: 'checkbox' },
                                { type: "numbers", title: "序号", align: 'center' },
                                { field: 'motionName', title: '议案名称', minWidth: 120, align: 'center', sort: true },
                                { field: 'motionTypeName', title: '议案类别', width: 150, align: 'center', sort: true },
                                { field: 'soName', title: '提出部门', width: 150, align: 'center', sort: true },
                                { field: 'motionCreateTime', title: '提交日期', width: 120, align: 'center', sort: true },
                                { field: '', title: '操作', width: 80, align: 'center', toolbar: '#glyaListOper', fixed: 'right' },
                            ]
                        ]
                    }));
                },
                returnTableInit: function () {
                    common.fetchPost('motionmgr/motiona/selectBackRecordPage', {
                        motionId: motionId
                    }, function (res) {
                        var data = res.list || [];
                        if (data.length > 0) {
                            table.render(common.tableInitParams({//退回情况
                                elem: '#returnList',
                                // url: baseUrl + 'motionmgr/motiona/selectBackRecordPage',
                                id: "returnList",
                                // method:'post',
                                // where: {
                                //     motionId: motionId
                                // },
                                data: data,
                                height: 'full-200',
                                defaultToolbar: [],
                                height: false,
                                page: true,
                                cols: [[
                                    { type: 'numbers', align: 'center', title: '序号', width: 80 },
                                    {
                                        field: 'auditOrgName', align: 'center', minWidth: 120, title: '退回操作部门',
                                        templet: function (rowData) {
                                            return rowData["auditOrgName"] ? rowData["auditOrgName"] : '-';
                                        }
                                    },
                                    {
                                        field: 'auditSuName', align: 'center', minWidth: 120, title: '退回操作人',
                                        templet: function (rowData) {
                                            return rowData["auditSuName"] ? rowData["auditSuName"] : '-';
                                        }
                                    },
                                    {
                                        field: 'auditOpnion', align: 'center', minWidth: 120, title: '退回意见',
                                        templet: function (rowData) {
                                            return rowData["auditOpnion"] ? rowData["auditOpnion"] : '-';
                                        }
                                    },
                                    {
                                        field: 'auditDatetime', align: 'center', width: 120, title: '退回时间',
                                        templet: function (rowData) {
                                            return rowData["auditDatetime"] ? (common.timestampToTime(rowData["auditDatetime"])) : '-';
                                        }
                                    }
                                ]]
                            }));
                            $('#returnLayer').removeClass('hideClass');
                        }
                        else {
                            $('#returnLayer').addClass('hideClass');
                        }
                    }, function (err) {
                        layer.msg('退回情况信息获取失败:' + err.resultMessage);
                        return false;
                    });
                },
                reloadGlyaTable: function () {
                    table.reload('glyaList', {
                        where: {
                            motionId: $("[name='motionId']").val(),
                            type: "related"
                        }
                    });
                },
                loadFormValue: function (object) {
                    form.val("motionaForm", object);
                    if (object.tails.attendanceListStr) {
                        $("[name='attendanceListStr']").val(object.tails.attendanceListStr);
                    }
                    $("#motionMain div.white-bg").show();
                },
                setReport: function (reportIds, reportNames, motionId) {
                    common.fetchPost('motionmgr/tiolAttendance/setReport', { attendanceIds: reportIds.join(','), motionId: motionId }, function (data) {
                        if (data.success) {
                            $("[name='msSpeaker']").val(reportNames.toString());
                        } else {
                            layer.msg('编辑议案列席人失败');//失败后提示
                        }
                    }, function () {
                        layer.msg('编辑议案列席人失败');//失败后提示
                    });
                },
                chooseTiolAttendances: function (list) {
                    var motionId = $("[name='motionId']").val();
                    common.fetchPost('motionmgr/tiolAttendance/chooseTiolAttendances', { attendanceList: list, motionId: motionId }, function (data) {
                        if (data.success) {
                        } else {
                            layer.msg('选择议案列席人失败');//失败后提示
                        }
                    }, function () {
                        layer.msg('保存议案列席人信息失败');//失败后提示
                    });
                },
                meetingTypeSelectLayer: function () {
                    var meetingTypeSelectLayer = layer.open({
                        title: '上会类型',
                        area: ['400px', '500px'],
                        btn: ['<i class="layui-icon">&#xe605;</i>确定'],
                        content: $('.meetingTypeSelectLayer').html(),
                        type: '1',
                        closeBtn: 0,
                        btnAlign: 'c',
                        success: function (obj) {
                            var parent = $(obj.selector);
                            common.selectDataSet({
                                elem: parent.find('[name=meetingType]'),
                                url: 'meetingmgr/tiolMeetingType/getTiolMeetingTypeSelect',
                                responseList: 'list',
                                method: 'get',//默认为get
                                optionText: 'meetingTypeName',
                                optionValue: 'meetingType',
                                success: function (data) {
                                    form.render('select');
                                }
                            });
                        },
                        yes: function (index, layero) {
                            var parent = $(layero.selector);
                            if (!parent.find('[name=meetingType]').val()) {
                                layer.msg('请选择会议类型');
                                return false;
                            }
                            var select = parent.find('[name=meetingType]');
                            var meetingTypeValue = select.val();//值
                            meetingTypeName = parent.find('[name=meetingType]').find('option:checked').text();//显示的内容
                            meetingTypeId = meetingTypeValue.split("_")[0];
                            meetingTypeCode = meetingTypeValue.split("_")[1];

                            $("#meetingTypeId").val(meetingTypeId);
                            $("#meetingTypeCode").val(meetingTypeCode);
                            $("#meetingTypeName").val(meetingTypeName);
                            $("#meetingId").val(meetingIdForm);
                            $("#formOperType").val(formOperType);
                            $('#mainTitle').text(meetingTypeName + '议案').show();
                            if (newMotionId) {
                                $('.meetingTypeFlowUl').find('.newNextMeeting').attr('data-meetingTypeId', meetingTypeId);
                                $('.meetingTypeFlowUl').find('.newNextMeeting [name=meetingTypeName]').text(meetingTypeName);
                            }
                            form.render('select');

                            layer.close(meetingTypeSelectLayer);
                        }
                    });
                },
                uploadFile: function (uploadLawFileObj, motionId) {
                    if (uploadLawFileObj) return;
                    $('#tbUploadBtn_new').unbind('click');
                    if (!motionId) motionId = $("[name='motionId']").val();
                    uploadLawFileObj = upload.render({
                        elem: '#tbUploadBtn_new',
                        url: baseUrl + 'zuul/dfsmgr/file/fileUpload',
                        auto: true,
                        // bindAction: "#saveLawFile",
                        data: { "resId": motionId, "fiFileType": 'motionTableType' },
                        accept: 'file',
                        exts: 'pdf',
                        before: function (obj) { //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
                            layer.load(); //上传loading
                        },
                        done: function (res, index, upload) {
                            layer.closeAll('loading'); //关闭loading
                            $("#motionDatum").val(res.list[0].fiId);
                            $("#motionDatumName").val(res.list[0].fiName + '.' + res.list[0].fiSuffix);
                            return false;
                        },
                        error: function (index, upload) {
                            layer.msg('上传失败');
                            layer.closeAll('loading'); //关闭loading
                        }
                    });
                },
                qzshTableInit: function (motionId) {//前置审核列表
                    table.render(common.tableInitParams({//前置审核
                        elem: '#addMotionAuditList',
                        id: 'addMotionAuditList',
                        url: baseUrl + 'motionmgr/motiona/findModifyMotionAuditList',
                        method: 'post',
                        where: {
                            motionId: motionId
                        },
                        defaultToolbar: [],
                        toolbar: '#hyzlListToolBar',
                        height: 'full-200',
                        height: false,
                        page: false,
                        cols: [
                            [
                                { type: 'checkbox' },
                                { type: 'numbers', align: 'center', title: '序号' },
                                {
                                    field: 'auditTypeName', align: 'center', title: '审核类型', width: 200
                                },
                                { field: 'maFileName', align: 'center', title: '文件名称', minWidth: 120, sort: true },
                                { field: '', title: '操作', align: 'center', width: 80, toolbar: '#hyzlListOper', fixed: 'right' },
                            ]
                        ],
                        done: function (data) {
                            fileSortData1 = common.arraySort(data.data ? data.data : [], 'ggSort');
                        }
                    }));
                },
                qzshTableReload: function () {
                    mId = $("[name='motionId']").val();
                    table.reload('addMotionAuditList', {
                        url: baseUrl + 'motionmgr/motiona/findModifyMotionAuditList',
                        method: 'post',
                        where: {
                            motionId: mId
                        },
                        page: 1
                    });
                },
                initRender: function () {
                    // 日期时间选择器
                    laydate.render({
                        elem: '#cjsj'
                        , trigger: 'click'
                    });
                    //提出部门
                    var el5, el6;

                    if (!el5) {
                        common.fetchPost('sysmgr/sysOrgan/selectSysOrganTreeBySeId', {}, function (data) {
                            if (data.success) {
                                el5 = tree.render({
                                    elem: '.ele5',
                                    data: data.list,
                                    defaultExpandAll: true,
                                    expandOnClickNode: false,
                                    highlightCurrent: true
                                });
                            } else {
                                layer.msg('查询部门树失败');
                            }

                        }, function () {
                            layer.msg('查询部门树失败');//失败后提示
                        });
                        //议案类别
                        if (!el6) {
                            var curSeId = '';
                            if (motionObj) {
                                curSeId = motionObj.ggCreateEid;
                            } else {
                                var userInfo = JSON.parse(common.getCookie('userInfo'));
                                curSeId = userInfo.seId;
                            }
                            common.fetchPost('catalog/tiolBillType/queryTiolBillTypeTree', { seId: curSeId }, function (data) {
                                if (data.success) {
                                    el6 = tree.render({
                                        elem: '.ele6',
                                        data: data.list,
                                        defaultExpandAll: false,
                                        expandOnClickNode: false,
                                        highlightCurrent: true
                                    });
                                } else {
                                    layer.msg('议案类别树错误');
                                }

                            }, function () {
                                layer.msg('议案类别树失败');//失败后提示
                            });
                        }
                        $("[name='motionTypeName']").on("click", function (e) {
                            e.stopPropagation();
                            $(".ele5").hide();
                            $(".ele6").toggle();
                        });

                        tree.on("nodeClick(data6)", function (d) {
                            if (d.data.currentData.children && d.data.currentData.children.length > 0) {
                                layer.msg('请选择议案类别子节点');//失败后提示
                                return;
                            }

                            $("[name='motionTypeName']").val(d.data.parentData.data.id != d.data.currentData.id ? (d.data.parentData.data.name + '-' + d.data.currentData.name) : d.data.currentData.name);
                            $("[name='motionType']").val(d.data.currentData.id);
                            $(".ele6").hide();
                            if (d.data.currentData.tails.isRel) {
                                $(".isRel").show();
                                $("input[name=tiolFlag][value='0']").prop('checked', 'checked');
                                form.render('radio');
                            } else {
                                $(".isRel").hide();
                                $("input[name=tiolFlag][value='0']").prop('checked', 'checked');
                                form.render('radio');
                            }
                        });
                    }

                    $("[name='soName']").on("click", function (e) {
                        e.stopPropagation();
                        $(".ele6").hide();
                        $(".ele5").toggle();
                    });
                    tree.on("nodeClick(data5)", function (d) {
                        $("[name='soName']").val(d.data.parentData.data.id != d.data.currentData.id ? (d.data.parentData.data.name + '-' + d.data.currentData.name) : d.data.currentData.name);
                        $("[name='soId']").val(d.data.currentData.id);
                        $(".ele5").hide();
                    });
                    $(document).on("click", function () {
                        $(".ele5").hide();
                        $(".ele6").hide();
                    });
                    // 会议类型
                    common.selectDataSet({
                        elem: $('#meetingTypeId'),
                        url: 'meetingmgr/tiolMeetingType/getTiolMeetingTypeList',
                        responseList: 'list',
                        method: 'get',//默认为get
                        optionText: 'meetingTypeName',
                        optionValue: 'meetingTypeId',
                        success: function (data) {
                            form.render('select');
                        }
                    });
                    // 审议类型
                    common.selectDataSet({
                        elem: $('#deliberationCode'),
                        url: 'sysmgr/dicts/selectDictListByPcode?dictPCode=subjectType',
                        responseList: 'list',
                        optionText: 'sdName',
                        optionValue: 'sdCode',
                        success: function () {
                            form.render("select");
                        }
                    });
                },
                domEvent: function () {//事件监听
                    //新建议案
                    $('#addNewYa').unbind('click').bind('click', function () {//跳转当前页面
                        window.location.replace(baseUrl + '/src/page/ys/yagl/yaAdd.html');
                    });
                    //退回
                    $('#returnBtn').unbind('click').bind('click', function () {//请求退回接口
                        var curStatusType = sessionStorage.getItem('curStatusType');
                        if (curStatusType == "2") {
                            layer.msg('当前议案已挂会，不可退回');
                            return false;
                        }
                        layer.confirm('确定退回当前议案?', { icon: 3, title: '提示', offset: '150px' }, function (index) {
                            layer.close(index);
                            var index_back = layer.open({
                                offset: '10px',
                                title: '退回',
                                maxmin: false,
                                area: ['580px'],//高度自适应
                                type: 1,//页面层
                                shadeClose: false,
                                btnAlign: 'c',
                                content: $('#nsh-back').html(),//加载该区域的html
                                success: function (obj) {
                                    var $selector = $(obj.selector);
                                    $selector.find('#addMotionAudit1').on('click', function () {
                                        var opnion = $selector.find('#opnion').val();
                                        if (opnion == "") {
                                            layer.msg('退回意见必填');
                                            return false;
                                        }
                                        var motionIds = [];
                                        var flowStatusId = sessionStorage.getItem('flowStatusId');
                                        motionIds.push(motionId + "_" + flowStatusId);
                                        common.fetchPost("motionmgr/motiona/backMotionByIds", { motionIds: motionIds, opnion: opnion }, function (res) {
                                            if (res.success) {
                                                layer.close(index_back);
                                                parent.layer.closeAll();
                                                parent.layer.msg('退回成功');
                                                $.reloadParentPage();
                                            } else {
                                                layer.msg('退回失败:' + res.resultMessage);
                                                return false;
                                            }
                                        }, function (err) {
                                            layer.msg('退回失败:' + err.resultMessage);
                                            return false;
                                        });
                                        return false;
                                    });
                                    $selector.find('#closeAddMotionAudit1').on('click', function () {
                                        layer.close(index_back);
                                        return false
                                    });

                                }
                            });
                        });
                    });
                    //保存表单
                    $('#saveMotionAll').unbind('click').bind('click', function () {
                        // 主要参数设置
                        var url;//请求地址
                        var params = {};//请求参数
                        var motionId = $("[name='motionId']").val();
                        if (motionId && motionIdFlag) {
                            url = 'motionmgr/motiona/modify';
                        } else {
                            url = 'motionmgr/motiona/addMotion';
                        }
                        // 获取议案信息
                        params = check(params);
                        if (!params) {
                            return false;
                        }
                        // 议案id    
                        params.motionId = motionId;                       
                        //发送请求
                        var layerLoader = common.layerLoader();                      
                        common.fetchPost(url, params, function (res) {
                            layer.close(layerLoader);
                            if (res.success) {
                                if (newMotionId || newMotionReadyId) {//下个会草稿保存
                                    sessionStorage.setItem('newMotionSave', '1');
                                }
                                motionIdFlag = true;
                                motion_Info = res.object;
                                eventHandle.loadFormValue(res.object);
                                eventHandle.motionAboutTableFlush(motionId);
                                // parent.layer.closeAll();
                                $.reloadParentPage();
                                parent.layer.msg('保存议案信息成功');
                            }
                            else {
                                layer.alert(res.resultMessage || '保存议案信息失败')
                            }
                        }, function (err) {
                            layer.close(layerLoader);
                            layer.alert(err.resultMessage || '保存议案信息失败');
                        });
                        return false;
                    });
                    //关闭
                    $('#closeBtn').unbind('click').bind('click', function () {
                        parent.layer.closeAll();
                    });
                    //提交议案
                    $('#submitYa').unbind('click').bind('click', function () {
                        // 主要参数设置
                        var url;//请求地址
                        var params = {};//请求参数
                        var motionIdArr = [];
                        var motionId = $("[name='motionId']").val();
                        var motionIdArrLegalReview = [];//存放需要经过法律审核的议案id，传给后端用来校验是否上传前置审核材料
                        var motionTypeId = $("[name='motionType']").val();
                        //判断该议案所属议案类别是否需要法律审核
                        common.fetchPost('catalog/tiolBillType/selectTiolBillTypeList', { billId: motionTypeId }, function (data) {
                            if (data.success && data.list.length > 0) {
                                if (data.list[0].legalReview == '1') {
                                    motionIdArrLegalReview.push(motionId);
                                }
                            }
                        });
                        if (motionId && motionIdFlag) {
                            url = 'motionmgr/motiona/modify';
                        } else {
                            url = 'motionmgr/motiona/addMotion';
                        }
                        // 获取议案信息
                        params = check(params);
                        if (!params) {
                            return false;
                        }
                        // 议案id    
                        params.motionId = motionId;
                        //发送请求
                        var layerLoader = common.layerLoader();
                        //先执行保存操作再执行提交操作
                        common.fetchPost(url, params, function (res) {
                            layer.close(layerLoader);
                            if (res.success) {
                                motionIdArr.push(motionId);
                                common.fetchPost('motionmgr/motiona/submitMotionByIds', { motionIds: motionIdArr, motionIdsLegalReview: motionIdArrLegalReview }, function (data) {
                                    if (data.success) {
                                        eventHandle.loadFormValue(res.object);
                                        eventHandle.motionAboutTableFlush(motionId);
                                        $.reloadParentPage();
                                        parent.layer.closeAll();
                                        parent.layer.msg('提交成功');
                                        $('#addNewYa').trigger('click');
                                    } else {
                                        layer.alert(data.resultMessage || '提交失败');
                                    }

                                }, function (data) {
                                    layer.alert('提交失败');
                                });
                            }
                            else {
                                layer.alert(res.resultMessage || '保存议案信息失败');
                            }
                        }, function (err) {
                            layer.close(layerLoader);
                            layer.alert(err.resultMessage || '保存议案信息失败');
                        });
                        return false;
                    });

                    //保存校验
                    function check(params) {
                        // 议案名称    
                        params.motionName = $('[name=motionName]').val();
                        if (params.motionName == '') {
                            layer.msg('议案名称必填');
                            return false
                        }
                        // 提出部门    
                        params.soName = $('[name=soName]').val();
                        if (params.soName == '') {
                            layer.msg('提出部门必填');
                            return false
                        }
                        // 提出部门id    
                        params.soId = $('[name=soId]').val();
                        if (params.soId == '') {
                            layer.msg('提出部门id不存在');
                            return false
                        }
                        // 议案类别    
                        params.motionTypeName = $('[name=motionTypeName]').val();
                        if (params.motionTypeName == '') {
                            layer.msg('议案类别必填');
                            return false
                        }
                        // 议案类别id    
                        params.motionType = $('[name=motionType]').val();
                        if (params.motionType == '') {
                            layer.msg('议案类别id不存在');
                            return false
                        }
                        // 上会类型    
                        params.meetingTypeName = $('input[name=meetingTypeName]').val();
                        if (params.meetingTypeName == '') {
                            layer.msg('上会类型必填');
                            return false
                        }
                        // 上会类型id    
                        params.meetingTypeId = $('[name=meetingTypeId]').val();
                        if (params.meetingTypeId == '') {
                            layer.msg('上会类型id不存在');
                            return false
                        }
                        // 审议类型    
                        params.deliberationName = $('[name=deliberationName]').val();
                        if (params.deliberationName == '') {
                            layer.msg('审议类型必填');
                            return false
                        }
                        // 审议类型编码    
                        params.deliberationCode = $('[name=deliberationCode]').val();
                        if (params.deliberationCode == '') {
                            layer.msg('审议类型编码不存在');
                            return false
                        }
                        // 创建日期    
                        params.motionCreateTime = $('[name=motionCreateTime]').val();
                        if (params.motionCreateTime == '') {
                            layer.msg('创建日期必填');
                            return false
                        }
                        // 三重一大    
                        params.tiolFlag = $('[name=tiolFlag]:checked').val();
                        if (params.tiolFlag == '') {
                            layer.msg('三重一大必填');
                            return false
                        }
                        // 主要内容    
                        params.motionContemt = $('[name=motionContemt]').val();
                        // 提案表文件名   
                        params.motionDatumName = $('[name=motionDatumName]').val();
                        if (params.motionDatumName == '') {
                            layer.msg('提案表必填');
                            return false
                        }
                        // 提案表文件id    
                        params.motionDatum = $('[name=motionDatum]').val();
                        if (params.motionDatum == '') {
                            layer.msg('提案表必填');
                            return false
                        }
                        // 汇报人员    
                        params.msSpeaker = $('[name=msSpeaker]').val();
                        if (params.msSpeaker == '') {
                            layer.msg('汇报人员必填');
                            return false
                        }
                        //列席人员
                        var attendanceListStr = $('[name=attendanceListStr]').val();
                        if (attendanceListStr == '') {
                            layer.msg('列席人员必填');
                            return false
                        }
                        return params;
                    }
                    //上会类型
                    form.on('select(meetingTypeFilter)', function (data) {
                        var meetingTypeName = '';
                        if (data.value != "") {
                            meetingTypeName = $(data.elem).find("[value='" + data.value + "']").text()
                            $("[name='meetingTypeName']").val(meetingTypeName);
                        } else {
                            $("[name='meetingTypeName']").val('');
                        }
                        $('.meetingTypeFlowUl').find('li').eq(curIndex).attr('data-meetingTypeId', data.value);
                        $('.meetingTypeFlowUl').find('li [name=meetingTypeName]').eq(curIndex).text(meetingTypeName);
                        $('#mainTitle').text(meetingTypeName + '议案').show();
                    });
                    //三重一大选项
                    form.on('select(hyinput)', function (data) {
                        if (data.value == 1 && !$("[name='reportSuperior']").val()) {
                            $("[name='reportSuperior']").val("1");
                            form.render('select');
                        }
                    });
                    // 议案信息下
                    form.on('select(deliberationFilter)', function (data) {
                        if (data.value != "") {
                            $("[name='deliberationName']").val($(data.elem).find("[value='" + data.value + "']").text());
                        } else {
                            $("[name='deliberationName']").val('');
                        }
                    });
                    //审议类型选择
                    form.on('select(auditType)', function (data) {
                        var auditTypeName = $(data.elem).find("[value='" + data.value + "']").text();
                        $("[name='auditTypeName']").val(auditTypeName);
                    });
                    //三重一大项选择
                    form.on('radio(tiolFlag)', function (data) {
                        $("input[name=reportSuperior][value='0']").removeProp("checked");
                        $("input[name=reportSuperior][value='1']").removeProp("checked");
                        data.value == 0 && $("input[name=reportSuperior][value='0']").prop('checked', 'checked');
                        data.value == 1 && $("input[name=reportSuperior][value='1']").prop('checked', 'checked');
                        form.render('radio');
                    });
                    // 提案表附件
                    // 附件上传
                    eventHandle.uploadFile(uploadFileObj, motionId);
                    // 附件删除
                    $('#tbDelBtn_new').on("click", function () {
                        var $current = $("#motionDatum");
                        var fileId = $current.val();
                        var fileName = $("#motionDatumName").val();
                        if (fileName == "" && !fileId) {
                            return false;
                        }
                        else {
                            layer.confirm("确定删除【 " + fileName + "】文件?", { icon: 3, title: '提示', offset: '150px' }, function (index) {
                                layer.close(index);
                                common.fetchDelete("/dfsmgr/file/deleteById?id=" + fileId, function (res) {
                                    if (res.success) {
                                        //清空值
                                        $current.val('');
                                        $("#motionDatumName").val('');
                                        //提示
                                        layer.msg('删除成功');
                                    } else {
                                        layer.msg('删除失败');
                                    }
                                });
                            });
                        }
                    });
                    // 汇报人员
                    // 编辑
                    $('#hbPersonEditBtn_new').off('click').on('click', function () {
                        var motionId = $("[name='motionId']").val();
                        var reportIds = [];
                        var reportNames = [];
                        var index_qx = layer.open({
                            offset: '10px',
                            title: '编辑汇报人员',
                            area: ['80%', '90%'],//高度自适应
                            type: 1,//页面层
                            shadeClose: false,
                            btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭'],
                            btnAlign: 'c',
                            yes: function () {
                                eventHandle.setReport(reportIds, reportNames, motionId);
                                var list = layui.table.cache['attendee-edit-table'];
                                var attendanceListStr = "";
                                for (var i = 0; i < list.length; i++) {
                                    attendanceListStr += "," + list[i]['attendanceName'];
                                }
                                $("[name='attendanceListStr']").val(attendanceListStr.slice(1));
                                // $("#msSpeaker").val(attendanceListStr.slice(1));
                                layer.close(index_qx);
                                return false;
                            },
                            content: $('.attendee-edit-layer').html(),
                            success: function (obj) {
                                table.render(common.tableInitParams({
                                    elem: $(obj.selector).find('#attendee-edit-table'),
                                    id: "attendee-edit-table",
                                    url: baseUrl + 'motionmgr/tiolAttendance/selectTiolAttendanceList',
                                    where: {
                                        subjectId: motionId
                                    },
                                    method: 'post',
                                    page: false,
                                    toolbar: '#attendee-edit-table-tool-bar',
                                    height: 'full-200',
                                    defaultToolbar: [],
                                    cols: [
                                        [
                                            { type: 'checkbox' },
                                            { type: 'numbers', title: '序号' },
                                            { field: 'attendanceName', title: '列席人员', minWidth: 120 },
                                            { field: 'positionName', title: '职位', minWidth: 120 },
                                            { field: 'isReport', title: '汇报人', width: 80, templet: '#switchTpl', unresize: true },
                                            { field: 'remark', title: '备注', minWidth: 120 },
                                            { field: '', title: '操作', width: 80, toolbar: '#attendee-edit-table-oper', fixed: 'right' }
                                        ]
                                    ],
                                    done: function (res, curr, count) {
                                        var list = res.data;
                                        attendanceSortData = common.arraySort(list ? list : [], 'ggSort');
                                        reportIds = [];
                                        reportNames = [];
                                        for (var i = 0; i < list.length; i++) {
                                            if (list[i].isReport == '1') {
                                                reportIds.push(list[i]['attendanceId']);
                                                reportNames.push(list[i]['attendanceName']);
                                            }
                                        }
                                    }
                                }));
                                form.on('submit(formAttendanceAdd)', function (obj) {
                                    var val = obj.field.attendanceName;
                                    if (val) {
                                        obj.field.subjectId = motionId;
                                        common.fetchPost('motionmgr/tiolAttendance/saveTiolAttendanceInfo', obj.field, function (data) {
                                            if (data.success) {
                                                layer.msg('保存列席人信息成功');
                                                attendanceTableReload();
                                            } else {
                                                layer.msg("保存列席人信息失败:" + data.resultMessage);
                                            }

                                        }, function () {
                                            layer.msg('保存列席人信息失败');//失败后提示
                                        });
                                    }
                                    return false;
                                });
                                function attendanceTableReload() {
                                    table.reload('attendee-edit-table', {
                                        where: { subjectId: motionId }
                                    });
                                }

                                table.on('toolbar(attendee-edit-table)', function (obj) {
                                    var checkStatus = table.checkStatus(obj.config.id);
                                    // var data = obj.data;
                                    var data = obj.config;
                                    switch (obj.event) {
                                        case 'add':
                                            var index_add = layer.open({
                                                offset: '10px',
                                                title: '<i class="iconfont icon-SZYD-xitongcaidanguanli"></i>新增人员',
                                                maxmin: false,
                                                area: ['580px'],//高度自适应
                                                type: 1,//页面层
                                                shadeClose: false,
                                                btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭'],
                                                btnAlign: 'c',
                                                yes: function () {
                                                    $("[lay-filter='formAttendanceAdd']").click();
                                                    layer.close(index_add);
                                                    return false;
                                                },
                                                btn2: function () {
                                                    layer.close(index_add);
                                                },
                                                content: $('.setAdd-attendeeForm').html(),//加载该区域的html
                                                success: function (obj) {
                                                    form.render();
                                                }
                                            });
                                            break;
                                        case 'del':
                                            //点击删除按钮

                                            if (checkStatus.data.length > 0) {
                                                layer.confirm('确定删除选中列?', { icon: 3, title: '提示', offset: '150px' }, function (index) {
                                                    // layer.msg('已删除');
                                                    // return false;
                                                    var attendanceIdArr = [];

                                                    for (var i = 0; i < checkStatus.data.length; i++) {
                                                        attendanceIdArr.push(checkStatus.data[i]['attendanceId'])
                                                    }

                                                    var layerLoader = common.layerLoader();
                                                    common.fetchDelete('motionmgr/tiolAttendance/deleteTiolAttendanceByIds?attendanceIds=' + attendanceIdArr.join(','), function () {
                                                        layer.close(layerLoader);
                                                        //成功之后刷新tree 以及表格
                                                        attendanceTableReload();
                                                        layer.msg('删除出席人成功');
                                                    }, function () {
                                                        layer.close(layerLoader);
                                                    });
                                                    layer.close(index);
                                                });
                                            } else {
                                                layer.msg('请选择删除列')
                                            }
                                            break;
                                        case 'choose':
                                            var index_add = layer.open({
                                                offset: '10px',
                                                title: '<i class="iconfont icon-SZYD-xitongcaidanguanli"></i>选择出席人员',
                                                maxmin: false,
                                                area: ['580px', '90%'],//高度自适应
                                                type: 1,//页面层
                                                shadeClose: false,
                                                btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消'],
                                                btnAlign: 'c',
                                                yes: function () {
                                                    var seId = $("#curSeId")[0].value;
                                                    var checkStatus = table.checkStatus("memberTableReload");
                                                    var memberTypeIdArr = [];
                                                    for (var i = 0; i < checkStatus.data.length; i++) {
                                                        memberTypeIdArr.push(checkStatus.data[i]['memberTypeId'])
                                                    }
                                                    var meetingId = $("#meetingId")[0].value;
                                                    var layerLoader = common.layerLoader();
                                                    common.fetchPost('meetingmgr/tiolAttendee/saveTiolAttendeeInfoRel', { "memberTypeIds": memberTypeIdArr.join(','), "meetingId": meetingId, participantsType: "ATTENDEE" }, function () {
                                                        layer.close(layerLoader);
                                                        //成功之后刷新tree 以及表格
                                                        table.reload('memberTableReload', {
                                                            page: {}
                                                            , where: {
                                                                meetingId: meetingIdForm,
                                                                meetingTypeId: meetingTypeId,
                                                                seId: seId,
                                                                memberAttendeeType: 'attendee'
                                                            }
                                                        });
                                                        //成功之后刷新tree 以及表格
                                                        table.reload('attendeeTableReload', {
                                                            page: {}
                                                            , where: {
                                                                meetingId: meetingIdForm,
                                                                participantsType: "ATTENDEE"
                                                            }
                                                        });
                                                        layer.msg('关联成功');
                                                    }, function () {
                                                        layer.close(layerLoader);
                                                    });

                                                    layer.close(index_add);
                                                    return false;
                                                },
                                                btn2: function () {
                                                    layer.close(index_add);
                                                },
                                                content: $('.memberTable').html(),//加载该区域的html
                                                success: function (obj) {
                                                    var seId = $("#curSeId")[0].value;
                                                    table.render(common.tableInitParams({
                                                        elem: $(obj.selector).find('#memberTable'),
                                                        url: baseUrl + 'meetingmgr/tiolCompanyMember/selectTiolCompanyMemberPageSelect',
                                                        // contentType:'text/plain',
                                                        id: 'memberTableReload',
                                                        method: 'post',
                                                        where: { "meetingTypeId": meetingTypeId, "seId": seId, memberAttendeeType: 'attendee', meetingId: meetingIdForm, },
                                                        // request:null,
                                                        // toolbar:'#memberToolBar',
                                                        // data:resAdd,
                                                        height: 'full-200',
                                                        defaultToolbar: [],
                                                        cols: [
                                                            [
                                                                { type: 'checkbox' },
                                                                { type: 'numbers', title: '序号' },
                                                                { field: 'memberName', title: '姓名' },
                                                                { field: 'jobName', title: '职位' },
                                                                { field: 'startDate', title: '开始时间' },
                                                                { field: 'endDate', title: '结束时间' }
                                                            ]
                                                        ],
                                                        done: function () {

                                                        }
                                                    }));
                                                }
                                            });
                                            break;
                                        case 'up':
                                            var checkStatus = table.checkStatus(obj.config.id);
                                            if (checkStatus.data.length == 1) {
                                                if (!attendanceSortData[common.arrayIndexOf(attendanceSortData, 'attendanceId', checkStatus.data[0].attendanceId) - 1]) {
                                                    layer.msg('无法上移');
                                                    return false;
                                                }

                                                var upAttendanceLayer = layer.confirm("确定上移人员?", {
                                                    btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                                }, function (index, layero) {
                                                    common.fetchPost('motionmgr/tiolAttendance/upAttendances', checkStatus.data[0], function (res) {
                                                        if (res.success) {
                                                            layer.msg("上移成功");
                                                            attendanceTableReload();
                                                        } else {
                                                            layer.alert(res.resultMessage);
                                                        }
                                                    }, function () {
                                                    });
                                                });
                                            } else {
                                                layer.msg("请选择一行");
                                            }
                                            break;
                                        case 'down':
                                            var checkStatus = table.checkStatus(obj.config.id);
                                            if (checkStatus.data.length == 1) {
                                                if (!attendanceSortData[common.arrayIndexOf(attendanceSortData, 'attendanceId', checkStatus.data[0].attendanceId) + 1]) {
                                                    layer.msg('无法下移');
                                                    return false;
                                                }

                                                var downAttendanceLayer = layer.confirm("确定下移人员?", {
                                                    btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                                }, function (index, layero) {
                                                    common.fetchPost('motionmgr/tiolAttendance/downAttendances', checkStatus.data[0], function (res) {
                                                        if (res.success) {
                                                            layer.msg("下移成功");
                                                            attendanceTableReload();
                                                        } else {
                                                            layer.alert(res.resultMessage);
                                                        }
                                                    }, function () {
                                                    });
                                                });
                                            } else {
                                                layer.msg("请选择一行");
                                            }
                                            break;
                                    }
                                });
                                table.on('tool(attendee-edit-table)', function (obj) {
                                    var rowData = obj.data;
                                    switch (obj.event) {
                                        case 'edit'://编辑
                                            var index_edit = layer.open({
                                                title: '编辑人员',
                                                type: 1,//页面层
                                                area: ['580px'],
                                                shadeClose: false,
                                                btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭'],
                                                btnAlign: 'c',
                                                content: $('.setAdd-attendeeForm').html(),//加载该区域的html
                                                success: function (obj) {
                                                    var parent = $(obj.selector);
                                                    parent.find('input[name=attendanceId]').val(rowData.attendanceId);
                                                    parent.find('input[name=subjectId]').val(rowData.subjectId);
                                                    parent.find('input[name=attendanceName]').val(rowData.attendanceName);
                                                    parent.find('input[name=positionName]').val(rowData.positionName);
                                                    parent.find('input[name=ggSort]').val(rowData.ggSort);
                                                    parent.find('textarea[name=remark]').val(rowData.remark);
                                                    form.render();
                                                },
                                                yes: function () {
                                                    $("[lay-filter='formAttendanceAdd']").click();
                                                    layer.close(index_edit);
                                                    return false;
                                                },
                                                btn2: function () {
                                                    layer.close(index_edit);
                                                    return false;
                                                },
                                            });
                                    }
                                });
                                //监听性别操作
                                form.on('switch(sexDemo)', function (obj) {
                                    if (obj.elem.checked) {
                                        reportIds.push(this.value);
                                        reportNames.push(this.name);
                                    } else {
                                        var index = reportIds.indexOf(this.value);
                                        reportIds.splice(index, 1);
                                        reportNames.splice(index, 1);
                                    }
                                });
                            }
                        });
                        return false;
                    });
                    // 选择
                    $('#hbPersonChooseBtn_new').off('click').on('click', function () {
                        // layer.msg('演示 选择');
                        // return false
                        var attendLayer = layer.open({
                            offset: '10px',
                            title: '选择汇报人员分组',
                            // maxmin: false,
                            area: ['80%', '80%'],//高度自适应
                            type: 1,//页面层
                            shadeClose: false,
                            btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消'],
                            btnAlign: 'c',
                            content: '<div class="moduleBox"><table lay-filter="attendGroupTable" id="attendGroupTable"></table></div>',
                            success: function (obj) {
                                table.render(common.tableInitParams({
                                    elem: '#attendGroupTable',
                                    url: baseUrl + 'meetingmgr/tiolCompanyGroup/pageQueryEnableTiolSubjectMemberGroup',
                                    /* data:[
                                        {
                                            q1:'会议成员',
                                            q2:'张三，李四，六五',
                                            q3:'2019-08-01',
                                            LAY_CHECKED:true
                                        },
                                        {
                                            q1:'会议成员',
                                            q2:'张三，李四，六五',
                                            q3:'2019-08-02'
                                        }
                                    ], */
                                    method: 'post',
                                    height: 'full-290',
                                    limit: 100000,
                                    cols: [
                                        [
                                            { type: 'radio' },
                                            { "type": "numbers", "title": "序号" },
                                            { field: 'tcgName', title: '分组名称', sort: true },
                                            { field: 'observerNames', title: '人员信息' },
                                            { field: 'tcgStartDate', title: '适用开始日期', width: 150, sort: true }
                                        ]
                                    ],
                                    page: false,
                                    done: function () {
                                        common.buttonLimit();

                                        // 默认第一列选中

                                    }
                                }));
                            },
                            yes: function () {
                                //获取选中组
                                var checkStatus = table.checkStatus('attendGroupTable');

                                if (!checkStatus.data) {
                                    layer.msg('请选择列席人员分组');
                                    return false;
                                }
                                var list = checkStatus.data[0].observerList;
                                var absentNames = "";
                                for (var i = 0; i < list.length; i++) {
                                    absentNames += "," + list[i].tcgmMemberName;
                                }

                                $('[name=msSpeaker]').val(list[0].tcgmMemberName);
                                $('[name=attendanceListStr]').val(absentNames.substring(1));
                                eventHandle.chooseTiolAttendances(list);
                                layer.close(attendLayer);
                                return false;
                            }
                        });
                        return false;
                    });
                    // 列席人员
                    // 编辑
                    $('#lxPersonEditBtn_new').off('click').on('click', function () {
                        var motionId = $("[name='motionId']").val();
                        var reportIds = [];
                        var reportNames = [];
                        var index_qx = layer.open({
                            offset: '10px',
                            title: '编辑列席人员',
                            area: ['80%', '90%'],//高度自适应
                            type: 1,//页面层
                            shadeClose: false,
                            btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭'],
                            btnAlign: 'c',
                            yes: function () {
                                eventHandle.setReport(reportIds, reportNames, motionId);
                                var list = layui.table.cache['attendee-edit-table'];
                                var attendanceListStr = "";
                                for (var i = 0; i < list.length; i++) {
                                    attendanceListStr += "," + list[i]['attendanceName'];
                                }
                                $("[name='attendanceListStr']").val(attendanceListStr.slice(1));
                                layer.close(index_qx);
                                return false;
                            },
                            content: $('.attendee-edit-layer').html(),
                            success: function (obj) {
                                table.render(common.tableInitParams({
                                    elem: $(obj.selector).find('#attendee-edit-table'),
                                    id: "attendee-edit-table",
                                    url: baseUrl + 'motionmgr/tiolAttendance/selectTiolAttendanceList',
                                    where: {
                                        subjectId: motionId
                                    },
                                    method: 'post',
                                    page: false,
                                    toolbar: '#attendee-edit-table-tool-bar',
                                    height: 'full-200',
                                    /* data:[{
                                        q1:'张三',
                                        q2:'党委书记',
                                        q3:'1',
                                        q8:''
                                    },
                                        {
                                            q1:'张三',
                                            q2:'党委书记',
                                            q3:'0',
                                            q8:''
                                        }], */
                                    defaultToolbar: [],
                                    cols: [
                                        [
                                            { type: 'checkbox' },
                                            { type: 'numbers', title: '序号' },
                                            { field: 'attendanceName', title: '汇报人员', minWidth: 120 },
                                            { field: 'positionName', title: '职位', minWidth: 120 },
                                            { field: 'isReport', title: '汇报人', width: 80, templet: '#switchTpl', unresize: true },
                                            { field: 'remark', title: '备注', minWidth: 120 },
                                            { field: '', title: '操作', width: 80, toolbar: '#attendee-edit-table-oper', fixed: 'right' }
                                        ]
                                    ],
                                    done: function (res, curr, count) {
                                        var list = res.data;
                                        attendanceSortData = common.arraySort(list ? list : [], 'ggSort');
                                        reportIds = [];
                                        reportNames = [];
                                        for (var i = 0; i < list.length; i++) {
                                            if (list[i].isReport == '1') {
                                                reportIds.push(list[i]['attendanceId']);
                                                reportNames.push(list[i]['attendanceName']);
                                            }
                                        }
                                    }
                                }));
                                form.on('submit(formAttendanceAdd)', function (obj) {
                                    var val = obj.field.attendanceName;
                                    if (val) {
                                        obj.field.subjectId = motionId;
                                        common.fetchPost('motionmgr/tiolAttendance/saveTiolAttendanceInfo', obj.field, function (data) {
                                            if (data.success) {
                                                layer.msg('保存列席人信息成功');
                                                attendanceTableReload();
                                            } else {
                                                layer.msg("保存列席人信息失败:" + data.resultMessage);
                                            }

                                        }, function () {
                                            layer.msg('保存列席人信息失败');//失败后提示
                                        });
                                    }
                                    return false;
                                });
                                function attendanceTableReload() {
                                    table.reload('attendee-edit-table', {
                                        where: { subjectId: motionId }
                                    });
                                }
                                table.on('toolbar(attendee-edit-table)', function (obj) {
                                    var checkStatus = table.checkStatus(obj.config.id);
                                    // var data = obj.data;
                                    var data = obj.config;
                                    switch (obj.event) {
                                        case 'add':
                                            var index_add = layer.open({
                                                offset: '10px',
                                                title: '<i class="iconfont icon-SZYD-xitongcaidanguanli"></i>新增人员',
                                                maxmin: false,
                                                area: ['580px'],//高度自适应
                                                type: 1,//页面层
                                                shadeClose: false,
                                                btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭'],
                                                btnAlign: 'c',
                                                yes: function () {
                                                    $("[lay-filter='formAttendanceAdd']").click();
                                                    layer.close(index_add);
                                                    return false;
                                                },
                                                btn2: function () {
                                                    layer.close(index_add);
                                                },
                                                content: $('.setAdd-attendeeForm').html(),//加载该区域的html
                                                success: function (obj) {
                                                    form.render();
                                                }
                                            });
                                            break;
                                        case 'del':
                                            //点击删除按钮
                                            if (checkStatus.data.length > 0) {
                                                layer.confirm('确定删除选中列?', { icon: 3, title: '提示', offset: '150px' }, function (index) {
                                                    // layer.msg('已删除');
                                                    // return false;
                                                    var attendanceIdArr = [];

                                                    for (var i = 0; i < checkStatus.data.length; i++) {
                                                        attendanceIdArr.push(checkStatus.data[i]['attendanceId'])
                                                    }
                                                    var layerLoader = common.layerLoader();
                                                    common.fetchDelete('motionmgr/tiolAttendance/deleteTiolAttendanceByIds?attendanceIds=' + attendanceIdArr.join(','), function () {
                                                        layer.close(layerLoader);
                                                        //成功之后刷新tree 以及表格
                                                        attendanceTableReload();
                                                        layer.msg('删除出席人成功');
                                                    }, function () {
                                                        layer.close(layerLoader);
                                                    });

                                                    layer.close(index);
                                                });
                                            } else {
                                                layer.msg('请选择删除列')
                                            }
                                            break;
                                        case 'choose':
                                            var index_add = layer.open({
                                                offset: '10px',
                                                title: '<i class="iconfont icon-SZYD-xitongcaidanguanli"></i>选择出席人员',
                                                maxmin: false,
                                                area: ['580px', '90%'],//高度自适应
                                                type: 1,//页面层
                                                shadeClose: false,
                                                btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消'],
                                                btnAlign: 'c',
                                                yes: function () {
                                                    var seId = $("#curSeId")[0].value;
                                                    var checkStatus = table.checkStatus("memberTableReload");
                                                    var memberTypeIdArr = [];
                                                    for (var i = 0; i < checkStatus.data.length; i++) {
                                                        memberTypeIdArr.push(checkStatus.data[i]['memberTypeId'])
                                                    }
                                                    var meetingId = $("#meetingId")[0].value;
                                                    var layerLoader = common.layerLoader();
                                                    common.fetchPost('meetingmgr/tiolAttendee/saveTiolAttendeeInfoRel', { "memberTypeIds": memberTypeIdArr.join(','), "meetingId": meetingId, participantsType: "ATTENDEE" }, function () {
                                                        layer.close(layerLoader);
                                                        //成功之后刷新tree 以及表格
                                                        table.reload('memberTableReload', {
                                                            page: {}
                                                            , where: {
                                                                meetingId: meetingIdForm,
                                                                meetingTypeId: meetingTypeId,
                                                                seId: seId,
                                                                memberAttendeeType: 'attendee'
                                                            }
                                                        });
                                                        //成功之后刷新tree 以及表格
                                                        table.reload('attendeeTableReload', {
                                                            page: {}
                                                            , where: {
                                                                meetingId: meetingIdForm,
                                                                participantsType: "ATTENDEE"
                                                            }
                                                        });
                                                        layer.msg('关联成功');
                                                    }, function () {
                                                        layer.close(layerLoader);
                                                    });

                                                    layer.close(index_add);
                                                    return false;
                                                },
                                                btn2: function () {
                                                    layer.close(index_add);
                                                },
                                                content: $('.memberTable').html(),//加载该区域的html
                                                success: function (obj) {
                                                    var seId = $("#curSeId")[0].value;
                                                    table.render(common.tableInitParams({
                                                        elem: $(obj.selector).find('#memberTable'),
                                                        url: baseUrl + 'meetingmgr/tiolCompanyMember/selectTiolCompanyMemberPageSelect',
                                                        // contentType:'text/plain',
                                                        id: 'memberTableReload',
                                                        method: 'post',
                                                        where: { "meetingTypeId": meetingTypeId, "seId": seId, memberAttendeeType: 'attendee', meetingId: meetingIdForm, },
                                                        // request:null,
                                                        // toolbar:'#memberToolBar',
                                                        // data:resAdd,
                                                        height: 'full-200',
                                                        defaultToolbar: [],
                                                        cols: [
                                                            [
                                                                { type: 'checkbox' },
                                                                { type: 'numbers', title: '序号' },
                                                                { field: 'memberName', title: '姓名' },
                                                                { field: 'jobName', title: '职位' },
                                                                { field: 'startDate', title: '开始时间' },
                                                                { field: 'endDate', title: '结束时间' }
                                                            ]
                                                        ],
                                                        done: function () {

                                                        }
                                                    }));
                                                }
                                            });
                                            break;
                                        case 'up':
                                            var checkStatus = table.checkStatus(obj.config.id);
                                            if (checkStatus.data.length == 1) {
                                                if (!attendanceSortData[common.arrayIndexOf(attendanceSortData, 'attendanceId', checkStatus.data[0].attendanceId) - 1]) {
                                                    layer.msg('无法上移');
                                                    return false;
                                                }

                                                var upAttendanceLayer = layer.confirm("确定上移人员?", {
                                                    btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                                }, function (index, layero) {
                                                    common.fetchPost('motionmgr/tiolAttendance/upAttendances', checkStatus.data[0], function (res) {
                                                        if (res.success) {
                                                            layer.msg("上移成功");
                                                            attendanceTableReload();
                                                        } else {
                                                            layer.alert(res.resultMessage);
                                                        }
                                                    }, function () {
                                                    });
                                                });
                                            } else {
                                                layer.msg("请选择一行");
                                            }
                                            break;
                                        case 'down':
                                            var checkStatus = table.checkStatus(obj.config.id);
                                            if (checkStatus.data.length == 1) {
                                                if (!attendanceSortData[common.arrayIndexOf(attendanceSortData, 'attendanceId', checkStatus.data[0].attendanceId) + 1]) {
                                                    layer.msg('无法下移');
                                                    return false;
                                                }

                                                var downAttendanceLayer = layer.confirm("确定下移人员?", {
                                                    btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                                }, function (index, layero) {
                                                    common.fetchPost('motionmgr/tiolAttendance/downAttendances', checkStatus.data[0], function (res) {
                                                        if (res.success) {
                                                            layer.msg("下移成功");
                                                            attendanceTableReload();
                                                        } else {
                                                            layer.alert(res.resultMessage);
                                                        }
                                                    }, function () {
                                                    });
                                                });
                                            } else {
                                                layer.msg("请选择一行");
                                            }
                                            break;
                                    }
                                });
                                table.on('tool(attendee-edit-table)', function (obj) {
                                    var rowData = obj.data;
                                    switch (obj.event) {
                                        case 'edit'://编辑
                                            var index_edit = layer.open({
                                                title: '编辑人员',
                                                type: 1,//页面层
                                                area: ['580px'],
                                                shadeClose: false,
                                                btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>关闭'],
                                                btnAlign: 'c',
                                                content: $('.setAdd-attendeeForm').html(),//加载该区域的html
                                                success: function (obj) {
                                                    var parent = $(obj.selector);
                                                    parent.find('input[name=attendanceId]').val(rowData.attendanceId);
                                                    parent.find('input[name=subjectId]').val(rowData.subjectId);
                                                    parent.find('input[name=attendanceName]').val(rowData.attendanceName);
                                                    parent.find('input[name=positionName]').val(rowData.positionName);
                                                    parent.find('input[name=ggSort]').val(rowData.ggSort);
                                                    parent.find('textarea[name=remark]').val(rowData.remark);
                                                    form.render();

                                                },
                                                yes: function () {
                                                    $("[lay-filter='formAttendanceAdd']").click();
                                                    layer.close(index_edit);
                                                    return false;
                                                },
                                                btn2: function () {
                                                    layer.close(index_edit);
                                                    return false;
                                                },
                                            });
                                    }
                                });
                                //监听性别操作
                                form.on('switch(sexDemo)', function (obj) {
                                    if (obj.elem.checked) {
                                        reportIds.push(this.value);
                                        reportNames.push(this.name);
                                    } else {
                                        var index = reportIds.indexOf(this.value);
                                        reportIds.splice(index, 1);
                                        reportNames.splice(index, 1);
                                    }
                                });
                            }
                        });
                        return false;
                    });
                    // 选择
                    $('#lxPersonChooseBtn_new').off('click').on('click', function () {
                        // layer.msg('演示 选择');
                        // return false
                        //参会人选择
                        var attendLayer = layer.open({
                            offset: '10px',
                            title: '选择议案列席人员分组',
                            // maxmin: false,
                            area: ['80%', '80%'],//高度自适应
                            type: 1,//页面层
                            shadeClose: false,
                            btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消'],
                            btnAlign: 'c',
                            content: '<div class="moduleBox"><table lay-filter="attendGroupTable" id="attendGroupTable"></table></div>',
                            success: function (obj) {
                                table.render(common.tableInitParams({
                                    elem: '#attendGroupTable',
                                    url: baseUrl + 'meetingmgr/tiolCompanyGroup/pageQueryEnableTiolSubjectMemberGroup',
                                    /* data:[
                                        {
                                            q1:'会议成员',
                                            q2:'张三，李四，六五',
                                            q3:'2019-08-01',
                                            LAY_CHECKED:true
                                        },
                                        {
                                            q1:'会议成员',
                                            q2:'张三，李四，六五',
                                            q3:'2019-08-02'
                                        }
                                    ], */
                                    method: 'post',
                                    height: 'full-290',
                                    limit: 100000,
                                    cols: [
                                        [
                                            { type: 'radio' },
                                            { "type": "numbers", "title": "序号" },
                                            { field: 'tcgName', title: '分组名称', sort: true },
                                            { field: 'observerNames', title: '人员信息' },
                                            { field: 'tcgStartDate', title: '适用开始日期', width: 150, sort: true }
                                        ]
                                    ],
                                    page: false,
                                    done: function () {
                                        common.buttonLimit();

                                        // 默认第一列选中

                                    }
                                }));
                            },
                            yes: function () {
                                //获取选中组
                                var checkStatus = table.checkStatus('attendGroupTable');

                                if (!checkStatus.data) {
                                    layer.msg('请选择列席人员分组');
                                    return false;
                                }
                                var list = checkStatus.data[0].observerList;
                                var absentNames = "";
                                for (var i = 0; i < list.length; i++) {
                                    absentNames += "," + list[i].tcgmMemberName;
                                }

                                $('[name=msSpeaker]').val(list[0].tcgmMemberName);
                                $('[name=attendanceListStr]').val(absentNames.substring(1));
                                eventHandle.chooseTiolAttendances(list);
                                layer.close(attendLayer);
                                return false;
                            }
                        });
                        return false;

                    });
                    // 前置审核 新增/编辑
                    form.on('submit(addMotionAudit)', function (obj) {
                        obj.field.motionId = $("[name='motionId']").val();
                        if (obj.field.motionAuditId) {
                            common.fetchPost('motionmgr/motiona/modifyMotionAudit', obj.field, function (data) {
                                if (data.success) {
                                    layer.msg("修改前置审核信息成功");
                                    layer.close(addMotionAuditIndex);

                                    motionAudit_info = data.object;
                                    //重新设置资源ID 待用变了
                                    motionAuditUpload.config.data = {
                                        "resId": motionAudit_info.motionAuditId,
                                        "fname": obj.field.fileName,
                                        "memo": obj.field.maRemarks
                                    };
                                    //执行上传
                                    motionAuditUpload.upload();
                                    // table.reload("addMotionAuditList",{});
                                    eventHandle.qzshTableReload();
                                } else {
                                    layer.msg("修改前置审核信息成功:" + data.resultMessage);
                                }
                            }, function () {
                                layer.msg('修改前置审核信息成功');//失败后提示

                            });
                        }
                        else {
                            common.fetchPost('motionmgr/motiona/addMotionAudit', obj.field, function (data) {
                                if (data.success) {
                                    layer.msg("添加前置审核信息成功");
                                    motionAudit_info = data.object;
                                    //重新设置资源ID
                                    motionAuditUpload.config.data = { "resId": motionAudit_info.motionAuditId };
                                    //执行上传
                                    motionAuditUpload.upload();

                                    layer.close(addMotionAuditIndex);
                                    eventHandle.qzshTableReload();
                                    // table.reload("addMotionAuditList", {});
                                } else {
                                    layer.msg("添加前置审核信息错误:" + data.resultMessage);
                                }
                            }, function () {
                                layer.msg('添加前置审核信息失败');//失败后提示
                            });
                        }
                        return false;
                    });
                    //前置审核 表格监听
                    table.on('toolbar(addMotionAuditList)', function (obj) {
                        var checkStatus = table.checkStatus(obj.config.id);
                        var data = obj.config;
                        switch (obj.event) {
                            case 'add':
                                var index_add = layer.open({
                                    offset: '10px',
                                    title: '<i class="iconfont icon-SZYD-xitongcaidanguanli"></i>新增',
                                    maxmin: false,
                                    area: ['580px'],//高度自适应
                                    type: 1,//页面层
                                    shadeClose: false,
                                    btnAlign: 'c',
                                    content: $('#hyzl-add').html(),//加载该区域的html
                                    success: function (obj) {
                                        var parent = $(obj.selector);
                                        addMotionAuditIndex = layer.index;
                                        //关闭
                                        $("#closeAddMotionAudit").unbind("click").bind("click", function (e) {
                                            layer.close(addMotionAuditIndex);
                                            return false;
                                        });

                                        common.selectDataSet({
                                            elem: $('#auditType'),
                                            url: 'sysmgr/dicts/selectDictListByPcode?dictPCode=auditType',
                                            responseList: 'list',
                                            optionText: 'sdName',
                                            optionValue: 'sdCode',
                                            success: function () {
                                                form.render("select");
                                            }
                                        });


                                        // 文件上传
                                        motionAuditUpload = upload.render({
                                            // elem: '#motionAuditUpload',
                                            elem: '#motionAuditUploadLayer',
                                            url: baseUrl + 'zuul/dfsmgr/file/fileUpload',
                                            auto: false,
                                            bindAction: "#addMotionAudit2323",
                                            data: {
                                                // resId: $("[name='motionId']").val(),
                                                fiFileType: "OPINION",
                                                fname: function () {
                                                    return parent.find("input[name=fileName]").val()
                                                },
                                                memo: function () {
                                                    return parent.find('[name=maRemarks]').val()
                                                }
                                            },
                                            accept: 'file',
                                            choose: function (obj) {
                                                obj.preview(function (index, file, result) {
                                                    // parent.find("#fileNameArea").show();
                                                    var arr = file.name.split('.');

                                                    if (file.name.split('.').length > 2) {
                                                        var fileName = '';
                                                        $.map(arr, function (item, index) {
                                                            if (index !== (arr.length - 1)) {
                                                                fileName += item;
                                                            }
                                                        });
                                                        parent.find("input[name=fileName]").val(fileName);
                                                    } else {
                                                        parent.find("input[name=fileName]").val(file.name.split('.')[0]);
                                                    }

                                                    parent.find("input[name=fileType]").val('.' + arr[arr.length - 1]);
                                                });
                                            },
                                            done: function (res, index, upload) {
                                                if (motionAudit_info.maFile) {
                                                    common.fetchDelete("/dfsmgr/file/deleteById?id=" + motionAudit_info.maFile, function (res) {
                                                        console.log("删除文件" + motionAudit_info.maFile);
                                                    });
                                                }
                                                var data = {};
                                                motionAudit_info.maFile = res.list[0].fiId;
                                                motionAudit_info.mafiSuffix = res.list[0].fiSuffix;
                                                motionAudit_info.maFileName = res.list[0].fiName + '.' + res.list[0].fiSuffix;
                                                motionAudit_info.maFileTime = new Date();
                                                common.fetchPost("motionmgr/motiona/modifyMotionAudit", motionAudit_info, function (res) {
                                                    // table.reload("addMotionAuditList", {});
                                                    eventHandle.qzshTableReload();
                                                });
                                            }
                                        });

                                        form.render();
                                    }
                                });
                                break;
                            case 'del':
                                //点击删除按钮
                                if (checkStatus.data.length > 0) {
                                    layer.confirm('确定删除选中列?', { icon: 3, title: '提示', offset: '150px' }, function (index) {
                                        var motionAuditIds = [];

                                        for (var i = 0; i < checkStatus.data.length; i++) {
                                            motionAuditIds.push(checkStatus.data[i].motionAuditId)
                                        }
                                        common.fetchPost('motionmgr/motiona/delMotionAudit', { motionAuditIds: motionAuditIds }, function (res) {
                                            if (res.success) {
                                                eventHandle.qzshTableReload();
                                                table.reload("addMotionAuditList", {});
                                                layer.msg('删除前置审核成功')
                                            } else {
                                                layer.msg('删除前置审核失败' + data.resultMessage)
                                            }
                                        }, function () {
                                            layer.msg('删除前置审核错误')
                                        });
                                    });
                                } else {
                                    layer.msg('请选择删除列')
                                }
                                break;
                            case "upFile":
                                var checkStatus = table.checkStatus(obj.config.id);
                                if (checkStatus.data.length == 1) {
                                    if (!fileSortData1[common.arrayIndexOf(fileSortData1, 'maFile', checkStatus.data[0].maFile) - 1]) {
                                        layer.msg('无法上移');
                                        return false;
                                    }

                                    var upFileLayer = layer.confirm("确定上移文件?", {
                                        btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                    }, function (index, layero) {
                                        common.fetchPost('motionmgr/motiona/upMotionAudit', checkStatus.data[0], function (res) {
                                            if (res.success) {
                                                layer.msg("上移成功");
                                                eventHandle.qzshTableReload();
                                                // table.reload("addMotionAuditList", {});
                                            } else {
                                                layer.alert(res.resultMessage);
                                            }
                                        }, function () {
                                        });
                                    });
                                } else {
                                    layer.msg("请选择一行");
                                }
                                break;
                            case 'downFile':
                                var checkStatus = table.checkStatus(obj.config.id);
                                if (checkStatus.data.length == 1) {
                                    if (!fileSortData1[common.arrayIndexOf(fileSortData1, 'maFile', checkStatus.data[0].maFile) + 1]) {
                                        layer.msg('无法下移');
                                        return false;
                                    }
                                    var downFileLayer = layer.confirm("确定下移文件?", {
                                        btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                    }, function (index, layero) {
                                        common.fetchPost('motionmgr/motiona/downMotionAudit', checkStatus.data[0], function (res) {
                                            if (res.success) {
                                                layer.msg("下移成功");
                                                eventHandle.qzshTableReload();
                                                // table.reload("addMotionAuditList", {});
                                            } else {
                                                layer.alert(res.resultMessage);
                                            }
                                        }, function () {
                                        });
                                    });
                                } else {
                                    layer.msg("请选择一行");
                                }
                                break;
                        }
                    });
                    table.on('tool(addMotionAuditList)', function (obj) {
                        var data = obj.data;
                        switch (obj.event) {
                            case "preview":// 预览
                                common.pdfPreview(data.maFile, data.maFiSuffix ? data.maFiSuffix : 'pdf');
                                break;
                            case 'load':
                                if (data.maFile) {
                                    uploadHandle.fileDownloadUrl(data.maFile);
                                } else {
                                    layer.msg('未上传文件');
                                }
                                // fileDownloadUrl(val);
                                break;
                            case 'edit'://编辑
                                var index_edit = layer.open({
                                    offset: '10px',
                                    title: '<i class="iconfont icon-SZYD-xitongcaidanguanli"></i>编辑',
                                    maxmin: false,
                                    type: 1,//页面层
                                    area: ['580px', '90%'],//高度自适应
                                    shadeClose: false,
                                    btnAlign: 'c',
                                    content: $('#hyzl-add').html(),//加载该区域的html
                                    success: function (obj) {
                                        addMotionAuditIndex = layer.index;
                                        //关闭
                                        $("#closeAddMotionAudit").unbind("click").bind("click", function (e) {
                                            layer.close(addMotionAuditIndex);
                                            return false;
                                        });
                                        common.selectDataSet({
                                            elem: $('#auditType'),
                                            url: 'sysmgr/dicts/selectDictListByPcode?dictPCode=auditType',
                                            responseList: 'list',
                                            optionText: 'sdName',
                                            optionValue: 'sdCode',
                                            success: function () {
                                                form.render("select");
                                            }
                                        });


                                        form.val("motionAuditFrom", data);

                                        // 文件上传
                                        motionAuditUpload = upload.render({
                                            // elem: '#motionAuditUpload',
                                            elem: '#motionAuditUploadLayer',
                                            url: baseUrl + 'zuul/dfsmgr/file/fileUpload',
                                            auto: false,
                                            bindAction: "#savemotionAuditUpload",
                                            data: {},
                                            accept: 'file',
                                            choose: function (obj) {
                                                obj.preview(function (index, file, result) {
                                                    $("input[name='maFileName']").val(file.name);
                                                });
                                            },
                                            done: function (res, index, upload) {
                                                if (motionAudit_info.maFile) {
                                                    common.fetchDelete("/dfsmgr/file/deleteById?id=" + motionAudit_info.maFile, function (res) {
                                                        console.log("删除文件" + motionAudit_info.maFile);
                                                    });
                                                }
                                                var data = {};
                                                motionAudit_info.maFile = res.list[0].fiId;
                                                motionAudit_info.maFileName = res.list[0].fiName + '.' + res.list[0].fiSuffix;
                                                motionAudit_info.maFiSuffix = res.list[0].fiSuffix;
                                                motionAudit_info.maFileTime = new Date();
                                                common.fetchPost("motionmgr/motiona/modifyMotionAudit", motionAudit_info, function (res) {
                                                    // table.reload("addMotionAuditList", {});
                                                    eventHandle.qzshTableReload();
                                                });
                                            }
                                        });

                                        form.render();
                                    }
                                });
                                break;
                            case "upFile":

                                var upFileLayer = layer.confirm("确定上移?", {
                                    btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                }, function (index, layero) {
                                    common.fetchPost('motionmgr/motiona/upMotionAudit', data, function (res) {
                                        if (res.success) {
                                            layer.msg("上移成功");
                                            eventHandle.qzshTableReload();
                                            // table.reload("addMotionAuditList", {});
                                        } else {
                                            layer.alert(res.resultMessage);
                                        }
                                    }, function () {
                                    });
                                });
                                break;
                            case "downFile":
                                if (!fileSortData1[common.arrayIndexOf(fileSortData1, 'fiId', obj.data.fiId) + 1]) {
                                    layer.msg('无法下移');
                                    return false;
                                }
                                var downFileLayer = layer.confirm("确定下移文件?", {
                                    btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                }, function (index, layero) {
                                    common.fetchPost('motionmgr/motiona/downMotionAudit', data, function (res) {
                                        if (res.success) {
                                            layer.msg("下移成功");
                                            eventHandle.qzshTableReload();
                                            // table.reload("addMotionAuditList", {});
                                        } else {
                                            layer.alert(res.resultMessage);
                                        }
                                    }, function () {
                                    });
                                });
                                break;
                        }
                    });
                    //关联议案列表 表格监听
                    table.on('toolbar(glyaList)', function (obj) {
                        var data = obj.data;
                        var checkStatus = table.checkStatus(obj.config.id);
                        switch (obj.event) {
                            case 'check':
                                var iframe = null;
                                var glyaList = layer.open({
                                    title: ['关联'],
                                    type: 2,
                                    content: baseUrl + 'src/page/ys/yagl/yaRelated.html?notInMotionId=' + $("[name='motionId']").val(),
                                    offset: 't',
                                    btnAlign: 'c',
                                    btn: ['<i class="layui-icon">&#xe608;</i> 添加', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消'],
                                    area: ["100%", "99%"],
                                    yes: function (e, s) {
                                        if (iframe) {
                                            var checkList = iframe.ftable.checkStatus('table1').data;
                                            var motionIds = [];
                                            for (var i = 0; i < checkList.length; i++) {
                                                motionIds.push(checkList[i].motionId);
                                            }
                                            var motionId = $("[name='motionId']").val();
                                            common.fetchPost('motionmgr/motiona/addMotionaRelateds', {
                                                motionId: motionId,
                                                motionIds: motionIds
                                            }, function (data) {
                                                if (data.success) {
                                                    // data.object;
                                                    form.val("motionaForm", data.object);
                                                    layer.close(glyaList);
                                                    layer.msg('关联议案成功');
                                                    eventHandle.reloadGlyaTable();
                                                    return true;
                                                } else {
                                                    layer.msg("关联议案失败:" + data.resultMessage);
                                                }

                                            }, function () {
                                                layer.msg('关联议案错误');//失败后提示
                                            });

                                        }
                                        return false;
                                    },
                                    btn2: function () {
                                        layer.close(glyaList);
                                    },
                                    success: function (layero, index) {
                                        iframe = layero.find("iframe")[0].contentWindow;
                                        // $("#compId", layero.find("iframe")[0].contentWindow.document).text(data['compId']);

                                    }
                                });
                                break;
                            case 'del':
                                //点击删除按钮
                                if (checkStatus.data.length > 0) {
                                    layer.confirm('确定删除选中列?', { icon: 3, title: '提示', offset: '150px' }, function (index) {
                                        var motionRelatedIds = [];

                                        for (var i = 0; i < checkStatus.data.length; i++) {
                                            motionRelatedIds.push(checkStatus.data[i].motionId);
                                        }
                                        var motionId = $("[name='motionId']").val();
                                        common.fetchPost('motionmgr/motiona/removeMotionaRelated', {
                                            motionId: motionId,
                                            motionRelatedIds: motionRelatedIds
                                        }, function (data) {
                                            if (data.success) {
                                                eventHandle.reloadGlyaTable(data);
                                                layer.msg("删除关联议案成功");
                                            } else {
                                                layer.msg("删除关联议案失败" + data.resultMessage);
                                            }


                                        }, function () {
                                            layer.msg('删除关联议案失败');//失败后提示
                                        });
                                    });
                                } else {
                                    layer.msg('无选中项')
                                }
                                break;
                        }
                    });
                    table.on('tool(glyaList)', function (obj) {
                        var data = obj.data;
                        switch (obj.event) {
                            case 'check'://编辑
                                var editLayer = layer.open({
                                    title: ['查看'],
                                    type: 2,
                                    //   content: './yaAdd.html?motionId='+data.motionId,
                                    content: baseUrl + 'src/page/ys/yagl/yaListReportedView.html?motionId='
                                        + data.motionId + "&meetingTypeName=" + data.meetingTypeName +
                                        '&statusType=' + data.statusType,
                                    maxmin: true,
                                    offset: 't',
                                    btnAlign: 'lc',
                                    success: function (layero, index) {
                                    }
                                });
                                layer.full(editLayer);
                                break;
                            default:
                                break;
                        }
                    });
                    //议案材料 表格监听
                    table.on('toolbar(motionDatumList)', function (obj) {
                        var checkStatus = table.checkStatus(obj.config.id);
                        // var data = obj.data;
                        var data = obj.config;
                        //上传
                        switch (obj.event) {
                            case 'motionDatumupload':
                                var index_add = layer.open({
                                    offset: '10px',
                                    title: '新增',
                                    maxmin: false,
                                    area: ['580px', '178px'],//高度自适应
                                    type: 1,//页面层
                                    shadeClose: false,
                                    btnAlign: 'c',
                                    content: $('#hyzl-add1').html(),//加载该区域的html
                                    success: function (obj) {

                                        var parent = $(obj.selector);
                                        parent.find('#auditTypeArea').remove();

                                        addMotionAuditIndex = layer.index;
                                        //关闭
                                        $("#closeAddMotionAudit").unbind("click").bind("click", function (e) {
                                            layer.close(addMotionAuditIndex);
                                            return false;
                                        });

                                        // 文件上传
                                        upload.render({
                                            // elem: '#motionAuditUpload',
                                            elem: '#yacl_motionAuditUploadLayer',
                                            url: baseUrl + 'zuul/dfsmgr/file/fileUpload',
                                            auto: false,
                                            shade: [0.8, 'rgba(0, 0, 0, 0.8)'],
                                            data: {
                                                fiFileType: "SUBJECT",
                                                resId: $("[name='motionId']").val(),
                                                // fname:parent.find("input[name=fileName]").val(),
                                                // memo:parent.find('[name=maRemarks]').val(),
                                                fname: function () {
                                                    return parent.find("input[name=fileName]").val()
                                                },
                                                memo: function () {
                                                    return parent.find('[name=maRemarks]').val()
                                                }
                                            },
                                            bindAction: "#addMotionAudit1",
                                            accept: 'file',
                                            choose: function (obj) {
                                                obj.preview(function (index, file, result) {
                                                    // parent.find("#fileNameArea").show();
                                                    var arr = file.name.split('.');

                                                    if (file.name.split('.').length > 2) {
                                                        var fileName = '';
                                                        $.map(arr, function (item, index) {
                                                            if (index !== (arr.length - 1)) {
                                                                fileName += item;
                                                            }
                                                        });
                                                        parent.find("input[name=fileName]").val(fileName);
                                                    } else {
                                                        parent.find("input[name=fileName]").val(file.name.split('.')[0]);
                                                    }

                                                    parent.find("input[name=fileType]").val('.' + arr[arr.length - 1]);
                                                });
                                            },
                                            done: function (res, index, upload) {
                                                layer.msg('上传议案文件成功');
                                                eventHandle.motionAboutTableFlush(motionId);
                                                // table.reload("motionDatumList", {});
                                            }
                                        });

                                        form.render();

                                        parent.find('#addMotionAudit1').on('click', function () {
                                            layer.close(index_add);
                                            return false
                                        });
                                        parent.find('#closeAddMotionAudit1').on('click', function () {
                                            layer.close(index_add);
                                            return false
                                        });

                                    }
                                });
                                break;
                            case 'delete':
                                if (checkStatus.data.length > 0) {
                                    layer.confirm('确定删除选中列?', { icon: 3, title: '提示', offset: '150px' }, function (index) {
                                        var fiIdArr = [];
                                        for (var i = 0; i < checkStatus.data.length; i++) {
                                            fiIdArr.push(checkStatus.data[i]['fiId'])
                                        }
                                        var layerLoader = common.layerLoader();
                                        common.fetchDelete("/dfsmgr/file/deleteById?id=" + fiIdArr.join(','), function (res) {
                                            if (res.success) {
                                                layer.msg('删除成功');
                                                layer.close(layerLoader);
                                                eventHandle.motionAboutTableFlush(motionId);
                                            } else {
                                                layer.msg('删除失败');
                                                layer.close(layerLoader);
                                            }
                                        });
                                        layer.close(index);
                                    });
                                } else {
                                    layer.msg('请选择删除列')
                                }
                                break;
                            case "upFile":
                                var checkStatus = table.checkStatus(obj.config.id);
                                if (checkStatus.data.length == 1) {
                                    if (!fileSortData[common.arrayIndexOf(fileSortData, 'fiId', checkStatus.data[0].fiId) - 1]) {
                                        layer.msg('无法上移');
                                        return false;
                                    }

                                    var upFileLayer = layer.confirm("确定上移文件?", {
                                        btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                    }, function (index, layero) {
                                        $.when(
                                            common.fetchPost("dfsmgr/file/updateFileInfo", {
                                                fiId: checkStatus.data[0].fiId,
                                                ggSort: checkStatus.data[0].ggSort - 1
                                            }),//当前条
                                            common.fetchPost("dfsmgr/file/updateFileInfo", {
                                                fiId: fileSortData[common.arrayIndexOf(fileSortData, 'fiId', checkStatus.data[0].fiId) - 1].fiId,
                                                ggSort: fileSortData[common.arrayIndexOf(fileSortData, 'fiId', checkStatus.data[0].fiId) - 1].ggSort + 1
                                            })//上一条
                                        ).done(function (res1, res2) {
                                            if (res1.success && res2.success) {
                                                eventHandle.motionAboutTableFlush(motionId);
                                                layer.msg("上移成功");
                                                layer.close(upFileLayer);
                                            } else {
                                                layer.msg('上移失败');
                                            }
                                        });
                                    });
                                } else {
                                    layer.msg("请选择一行");
                                }
                                break;
                            case 'downFile':
                                var checkStatus = table.checkStatus(obj.config.id);
                                if (checkStatus.data.length == 1) {
                                    if (!fileSortData[common.arrayIndexOf(fileSortData, 'fiId', checkStatus.data[0].fiId) + 1]) {
                                        layer.msg('无法下移');
                                        return false;
                                    }
                                    var downFileLayer = layer.confirm("确定下移文件?", {
                                        btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                    }, function (index, layero) {
                                        $.when(
                                            common.fetchPost("dfsmgr/file/updateFileInfo", {
                                                fiId: checkStatus.data[0].fiId,
                                                ggSort: checkStatus.data[0].ggSort + 1
                                            }),//当前条
                                            common.fetchPost("dfsmgr/file/updateFileInfo", {
                                                fiId: fileSortData[common.arrayIndexOf(fileSortData, 'fiId', checkStatus.data[0].fiId) + 1].fiId,
                                                ggSort: fileSortData[common.arrayIndexOf(fileSortData, 'fiId', checkStatus.data[0].fiId) + 1].ggSort - 1
                                            })//下一条
                                        ).done(function (res1, res2) {
                                            if (res1.success && res2.success) {
                                                eventHandle.motionAboutTableFlush(motionId);
                                                layer.msg("下移成功");
                                                layer.close(downFileLayer);
                                            } else {
                                                layer.msg('下移失败');
                                            }
                                        });
                                    });
                                } else {
                                    layer.msg("请选择一行");
                                }
                                break;
                            default: break
                        }
                    });

                    table.on('tool(motionDatumList)', function (obj) {
                        var data = obj.data;
                        switch (obj.event) {
                            case "preview":// 预览
                                common.pdfPreview(obj.data.fiId, obj.data.fiSuffix);
                                break;
                            case 'load':
                                uploadHandle.fileDownloadUrl(data.fiId);
                                break;
                            case 'del'://删除
                                layer.confirm('确定删除材料?', { icon: 3, title: '提示', offset: '150px' }, function (index) {
                                    uploadHandle.fileDelUrl(data.fiId, function () {
                                        eventHandle.motionAboutTableFlush(motionId);
                                    });
                                });
                                break;
                            case "upFile":

                                if (!fileSortData[common.arrayIndexOf(fileSortData, 'fiId', obj.data.fiId) - 1]) {
                                    layer.msg('无法上移');
                                    return false;
                                }


                                var upFileLayer = layer.confirm("确定上移文件?", {
                                    btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                }, function (index, layero) {
                                    $.when(
                                        common.fetchPost("dfsmgr/file/updateFileInfo", {
                                            fiId: obj.data.fiId,
                                            ggSort: obj.data.ggSort - 1
                                        }),//当前条
                                        common.fetchPost("dfsmgr/file/updateFileInfo", {
                                            fiId: fileSortData[common.arrayIndexOf(fileSortData, 'fiId', obj.data.fiId) - 1].fiId,
                                            ggSort: fileSortData[common.arrayIndexOf(fileSortData, 'fiId', obj.data.fiId) - 1].ggSort + 1
                                        })//上一条
                                    ).done(function (res1, res2) {
                                        if (res1.success && res2.success) {
                                            eventHandle.motionAboutTableFlush(motionId);
                                            layer.msg("上移成功");
                                            layer.close(upFileLayer);
                                        } else {
                                            layer.msg('上移失败');
                                        }
                                    });
                                });
                                break;

                            case "downFile":
                                if (!fileSortData[common.arrayIndexOf(fileSortData, 'fiId', obj.data.fiId) + 1]) {
                                    layer.msg('无法下移');
                                    return false;
                                }
                                var downFileLayer = layer.confirm("确定下移文件?", {
                                    btn: ['<i class="layui-icon">&#xe605;</i>确定', '<i class="icon iconfont icon-button-cha-2" style="margin-right: 3px"></i>取消']
                                }, function (index, layero) {
                                    $.when(
                                        common.fetchPost("dfsmgr/file/updateFileInfo", {
                                            fiId: obj.data.fiId,
                                            ggSort: obj.data.ggSort + 1
                                        }),//当前条
                                        common.fetchPost("dfsmgr/file/updateFileInfo", {
                                            fiId: fileSortData[common.arrayIndexOf(fileSortData, 'fiId', obj.data.fiId) + 1].fiId,
                                            ggSort: fileSortData[common.arrayIndexOf(fileSortData, 'fiId', obj.data.fiId) + 1].ggSort - 1
                                        })//下一条
                                    ).done(function (res1, res2) {
                                        if (res1.success && res2.success) {
                                            eventHandle.motionAboutTableFlush(motionId);
                                            layer.msg("下移成功");
                                            layer.close(downFileLayer);
                                        } else {
                                            layer.msg('下移失败');
                                        }
                                    });
                                });
                                break;
                        }
                    });
                },
                initRel: function (obj) {
                    var motionType = obj.motionType;
                    common.fetchPost('catalog/tiolBillType/selectTiolBillTypePage', { billId: obj.motionType }, function (data) {
                        if (data.success && data.page.list.length > 0) {
                            if (data.page && data.page.list && data.page.list[0].tails && data.page.list[0].tails.catalogName) {
                                $(".isRel").show();
                            }
                        }
                    });
                },
                output: function () {
                    //获取字典类型,日期控件
                    eventHandle.initRender();
                    // --------------------------------初始化--------------------------------
                    if (motionId) {
                        if (newMotionReadyId) {//如果是已提交编辑 ,隐藏提交按钮,显示退回按钮
                            $('#submitYa').hide();
                            $('#returnBtn').show();
                        }
                        else {
                            $('#submitYa').show();
                            $('#returnBtn').hide();
                        }
                        //获取所有会议类型议案
                        eventHandle.getMeetingTypeFlow(motionId);
                        meetingTypeId = common.getQueryVariable('meetingTypeId');
                        meetingTypeCode = common.getQueryVariable('meetingTypeCode');
                        meetingTypeName = common.getQueryVariable('meetingTypeName');

                        meetingIdForm = common.getQueryVariable('meetingId') || common.uuid('', 32);
                        $("#meetingTypeId").val(meetingTypeId);
                        $("#meetingTypeCode").val(meetingTypeCode);
                        $("#meetingTypeName").val(meetingTypeName);
                        $("#meetingId").val(meetingIdForm);
                        $("#formOperType").val(formOperType);
                        $('#mainTitle').text(meetingTypeName + '议案').show();
                        //隐藏新建按钮
                        $('#addNewYa').hide();
                        motionIdFlag = true;
                    } else {
                        $('#closeBtn').hide();
                        motionId = common.uuid(null, 32);
                        $("[name='motionId']").val(motionId);
                        //议案材料
                        eventHandle.motionAboutTableFlush(motionId);
                        //前置审核
                        eventHandle.qzshTableInit();
                        //关联议案
                        eventHandle.glyaTableInit();
                        //退回情况
                        eventHandle.returnTableInit();
                        //会议类型选择
                        eventHandle.meetingTypeSelectLayer();
                    }
                    // 事件监听
                    eventHandle.domEvent();
                }
            };
            eventHandle.output();
        });

    </script>

    <!--[if lt IE 9]>
<script src="https://cdn.staticfile.or
<script src=" ../../js/lib/html5.min.js"></script>
<
script
src = "../../js/lib/respond.js" ></script>
<![endif]-->
</body>

</html>